<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>LightUnfold • UltraHub v3.1.1</title>
<meta name="description" content="Web3 AI tự động 24/7: cơ hội nổi bật, thanh toán QR (on/off-chain), nội dung cao cấp (mã), affiliate. Tối ưu di động & desktop.">
<meta property="og:title" content="LightUnfold • UltraHub v3.1.1">
<meta property="og:description" content="Nền tảng Web3 AI tự vận hành 24/7: quét đa nguồn, cơ hội, thanh toán, paywall, affiliate.">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0b0f13">
<!--
  UltraHub v3.1.1 — FINAL
  🔒 Khi nâng cấp, hãy tạo file mới, ví dụ:
      index_ultrahub_v3.2.html  → cập nhật routing sang file mới.
-->
<style>
:root{--bg:#0b0f13;--card:#10161d;--line:#1c2836;--txt:#e9eef4;--mut:#9fb3c8;--brand:#7dc1ff;--accent:#ffb000;--ok:#20c997;--bad:#ff4d4f;--pill:#0f141c}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:var(--pill);color:var(--mut)}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-top:12px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.out{background:transparent;border:1px solid var(--line);color:#fff}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
.list .item{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px dashed var(--line)}
.score{min-width:60px;text-align:center;border:1px solid var(--line);border-radius:8px;padding:4px 6px;color:#ffdca8;background:#241a00}
.tag{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:2px 8px;margin:2px 4px 0 0;color:#bcd;font-size:12px}
.pay{display:flex;gap:14px}.pay img{width:160px;height:160px;border-radius:12px;border:1px solid var(--line);background:#000}
.pay .meta{flex:1;min-width:0}.mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;word-break:break-all}
.hidden{display:none}
.footer{padding:28px 0;text-align:center;color:#9fb3c8}
.sharebar{position:fixed;right:12px;bottom:12px;display:flex;gap:8px;background:#10161d;border:1px solid #1c2836;border-radius:12px;padding:8px;z-index:9999}
.sharebar a{font-size:18px;text-decoration:none}
.ok{color:var(--ok)}.err{color:var(--bad)}
.marquee{white-space:nowrap;overflow:hidden}.marquee>div{display:inline-block;animation:mar 25s linear infinite}
@keyframes mar{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.tabbar{display:flex;gap:8px;flex-wrap:wrap}.tab{padding:6px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer}
.tab.act{background:var(--accent);color:#1a1300;border-color:transparent}
.appgrid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
.appgrid a{display:block;padding:10px;border:1px solid var(--line);border-radius:12px;background:var(--pill);text-align:center}
.light{--bg:#f7fafc;--card:#ffffff;--line:#e2e8f0;--txt:#0b0f13;--mut:#4a5568;--brand:#2563eb;--pill:#f3f6fb}
.alert{background:#2a2e12;border:1px solid #606c38;color:#e9f5c7;border-radius:12px;padding:10px 12px}
.topbtn{position:fixed;left:12px;bottom:80px;z-index:9998}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:99999}
.modal .box{width:min(92vw,900px);height:min(80vh,700px);background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
.modal header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
.modal iframe{border:0;flex:1;background:#0a0f14}
.cta{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin-top:12px}
.cta .item{padding:12px;border:1px dashed var(--line);border-radius:12px}
.affgrid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.affcard{padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--pill);display:flex;flex-direction:column;gap:8px}
.affcard .actions{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <a class="pill" href="javascript:history.length>1?history.back():location.href">◀ Back</a>
    <span class="pill">ENS: <b id="ens">lightunfold.eth</b></span>
    <span class="pill">Heartbeat: <b id="hb">—</b></span>
    <button class="pill" id="openCfg">config</button>
    <button class="pill" id="openData">data</button>
    <span class="pill" id="lang">VI/EN</span>
    <span class="pill" id="theme">🌗 Theme</span>
  </div>

  <h1 id="brand">LightUnfold • UltraHub v3.1.1</h1>
  <div id="tagline" style="color:#9fb3c8">20,000+ AI • 200+ quốc gia • 200+ ngôn ngữ • Tự động 24/7 • Chuyển đổi X1000</div>

  <section class="card" id="about">
    <div class="row" style="justify-content:space-between;align-items:flex-start">
      <div>
        <div id="slogan">Nền tảng Web3 AI tự vận hành 24/7: quét đa nguồn, chấm điểm cơ hội, nhắc biến động lớn.</div>
        <div id="pulse" class="tag" style="margin-top:8px">Cập nhật: —</div>
      </div>
      <div class="row">
        <a class="btn out" target="_blank" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" rel="noopener">Đăng ký Binance</a>
        <a class="btn out" target="_blank" href="https://algosone.page.link/MbtR" rel="noopener">AlgosOne (AI Trading)</a>
      </div>
    </div>
    <div id="alertBox" class="alert hidden" style="margin-top:10px"></div>
    <div class="cta">
      <div class="item"><b id="whyH1">Vì sao UltraHub?</b><br><span id="why1">Quét dữ liệu đa nguồn, xếp hạng cơ hội theo điểm – cập nhật từng phút.</span></div>
      <div class="item"><b id="whyH2">Giá trị mở khóa</b><br><span id="why2">Alpha/private feed, heatmap, vesting, tín hiệu chu kỳ – sẵn sàng hành động.</span></div>
      <div class="item"><b id="whyH3">Cách tham gia</b><br><span id="why3">Thanh toán on/off‑chain → nhận mã → mở khóa nội dung.</span></div>
    </div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 id="hotTitle" style="margin:0">🔥 Cơ hội nổi bật</h3>
      <div class="row">
        <span class="badge" id="scanMode">quét: data</span>
        <button class="btn out" id="refreshNow">↻ Làm mới</button>
      </div>
    </div>
    <div class="marquee" style="margin:4px 0 8px;color:#bcd"><div id="ticker">—</div></div>
    <div id="opps" class="list"></div>
  </section>

  <section class="card">
    <h3 id="payTitle" style="margin:0 0 8px">💳 Thanh toán</h3>
    <div id="pays" class="grid"></div>
    <div style="color:#9fb3c8;margin-top:6px"><span id="minLbl">Tối thiểu</span>: <span id="mins"></span> · <span id="contactLbl">Liên hệ</span>: <span id="pp"></span></div>
  </section>

  <section class="card">
    <h3 id="lockTitle" style="margin:0 0 8px">🔓 Nội dung cao cấp</h3>
    <div id="locked">
      <div class="grid">
        <div>
          <input id="unlockCode" placeholder="Nhập mã mở khóa…" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)">
          <input id="txhash" style="margin-top:8px;width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)" placeholder="(Tuỳ chọn) Dán mã giao dịch/bằng chứng">
          <div class="row" style="margin-top:8px">
            <button class="btn" id="doUnlock">Mở khóa</button>
            <button class="btn out" id="remember">Nhớ trên thiết bị</button>
          </div>
          <div id="uMsg" style="margin-top:6px;color:#9fb3c8"></div>
        </div>
        <div style="color:#9fb3c8">
          <b id="howTitle">Cách hoạt động</b>
          <ul id="howList">
            <li>Thanh toán (ETH/USDT/MoMo/VCB/PayPal…)</li>
            <li>Nhận mã → nhập để mở khóa nội dung</li>
            <li>Lưu mã & TX hash ngay trên thiết bị của bạn</li>
          </ul>
        </div>
      </div>
    </div>
    <div id="opened" class="hidden">
      <div class="row"><span class="pill ok" id="unlockedLbl">✔ Đã mở khóa</span><button class="btn out" id="relock">Khoá lại</button></div>
      <div id="premium" class="grid" style="margin-top:10px"></div>
    </div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 id="packTitle" style="margin:0">🧰 Gói sản phẩm / Báo cáo</h3>
      <div class="tabbar" id="timeTabs">
        <div class="tab act" data-t="day">Ngày</div>
        <div class="tab" data-t="month">Tháng</div>
        <div class="tab" data-t="quarter">Quý</div>
        <div class="tab" data-t="year">Năm</div>
      </div>
    </div>
    <div id="bundles" class="grid"></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px">🤝 Affiliate</h3>
    <div id="affs" class="affgrid"></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px">🧭 Command Center</h3>
    <div id="apps" class="appgrid"></div>
    <div style="color:#9fb3c8;margin-top:6px" id="hubHint">Hub tự phát hiện & liên kết tới công cụ cũ (dex, hyper_v2, pro, super_auto, super_share, xportal…).</div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px" id="ctaTitle">🚀 Bắt đầu ngay</h3>
    <div class="cta">
      <div class="item"><b id="cta1H">Tạo lợi thế thông tin</b><br><span id="cta1">Theo dõi biến động lớn & tín hiệu sớm – trước đám đông.</span></div>
      <div class="item"><b id="cta2H">Tối ưu chi phí</b><br><span id="cta2">Gói ngày/tháng/quý – trả cho thứ bạn dùng.</span></div>
      <div class="item"><b id="cta3H">Lan tỏa tự động</b><br><span id="cta3">Chia sẻ 1 chạm (Telegram/X/Facebook/LinkedIn) + Affiliate.</span></div>
    </div>
  </section>

  <button class="pill topbtn" id="goTop">↑ Top</button>
  <div class="footer">© <span id="year"></span> LightUnfold • <span id="autoLbl">Tự động 24/7</span></div>
</div>

<!-- Share floating -->
<div class="sharebar" id="sharebar">
  <a id="sh_tg" target="_blank">📣</a>
  <a id="sh_x"  target="_blank">𝕏</a>
  <a id="sh_fb" target="_blank">f</a>
  <a id="sh_in" target="_blank">in</a>
</div>

<!-- Modal (config/data preview) -->
<div class="modal" id="modal">
  <div class="box">
    <header>
      <b id="modalTitle">Xem tài liệu</b>
      <div class="row">
        <a id="openNew" class="btn out" target="_blank" rel="noopener">Mở tab mới ↗</a>
        <button id="closeModal" class="btn">Đóng</button>
      </div>
    </header>
    <iframe id="frame" src="about:blank"></iframe>
  </div>
</div>

<script>
/* =============== Theme + i18n =============== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
function setTheme(m){document.documentElement.classList.toggle('light',m==='light');localStorage.setItem('theme',m)}
setTheme(localStorage.getItem('theme')||'dark'); $('#theme').onclick=()=>setTheme(document.documentElement.classList.contains('light')?'dark':'light');

const i18n={
  vi:{hot:"🔥 Cơ hội nổi bật",pay:"💳 Thanh toán",minLbl:"Tối thiểu",contactLbl:"Liên hệ",lock:"🔓 Nội dung cao cấp",
      how:"Cách hoạt động",unlocked:"✔ Đã mở khóa",packs:"🧰 Gói sản phẩm / Báo cáo",hub:"Hub tự phát hiện & liên kết tới công cụ cũ (dex, hyper_v2, pro, super_auto, super_share, xportal…).",
      cta:"🚀 Bắt đầu ngay",cta1H:"Tạo lợi thế thông tin",cta1:"Theo dõi biến động lớn & tín hiệu sớm – trước đám đông.",
      cta2H:"Tối ưu chi phí",cta2:"Gói ngày/tháng/quý – trả cho thứ bạn dùng.",
      cta3H:"Lan tỏa tự động",cta3:"Chia sẻ 1 chạm (Telegram/X/Facebook/LinkedIn) + Affiliate.",
      auto:"Tự động 24/7",
      whyH1:"Vì sao UltraHub?",whyH2:"Giá trị mở khóa",whyH3:"Cách tham gia",
      why1:"Quét dữ liệu đa nguồn, xếp hạng cơ hội theo điểm – cập nhật từng phút.",
      why2:"Alpha/private feed, heatmap, vesting, tín hiệu chu kỳ – sẵn sàng hành động.",
      why3:"Thanh toán on/off‑chain → nhận mã → mở khóa nội dung.",
      refresh:"↻ Làm mới", theme:"🌗 Giao diện", scan_data:"quét: data", scan_fallback:"quét: fallback",
      unlock_ph:"Nhập mã mở khóa…", tx_ph:"(Tuỳ chọn) Dán mã giao dịch/bằng chứng",
      unlock_btn:"Mở khóa", remember_btn:"Nhớ trên thiết bị", relock_btn:"Khoá lại", buy_enter:"Mua & nhập mã", details:"Chi tiết", price:"Giá", volume:"Khối lượng", open_data:"Xem dữ liệu"
  },
  en:{hot:"🔥 Hot opportunities",pay:"💳 Payments",minLbl:"Minimum",contactLbl:"Contact",lock:"🔓 Premium content",
      how:"How it works",unlocked:"✔ Unlocked",packs:"🧰 Products / Reports",hub:"Hub auto-detects & links to legacy tools (dex, hyper_v2, pro, super_auto, super_share, xportal…).",
      cta:"🚀 Get started now",cta1H:"Information edge",cta1:"Track outsized moves & early signals — ahead of the crowd.",
      cta2H:"Cost‑efficient",cta2:"Day/Month/Quarter plans — pay only for what you use.",
      cta3H:"Auto‑viral growth",cta3:"One‑tap share (Telegram/X/Facebook/LinkedIn) + Affiliate.",
      auto:"Always‑on 24/7",
      whyH1:"Why UltraHub?",whyH2:"Unlock value",whyH3:"How to join",
      why1:"Multi‑source scanning, scored opportunities — refreshed every minute.",
      why2:"Alpha/private feeds, heatmaps, vesting calendars, cycle signals.",
      why3:"Pay on/off‑chain → receive code → unlock premium.",
      refresh:"↻ Refresh", theme:"🌗 Theme", scan_data:"scan: data", scan_fallback:"scan: fallback",
      unlock_ph:"Enter unlock code…", tx_ph:"(Optional) Paste TX hash / proof",
      unlock_btn:"Unlock", remember_btn:"Remember on device", relock_btn:"Lock again", buy_enter:"Buy & enter code", details:"Details", price:"Price", volume:"Volume", open_data:"Open data"
  }
};
let LANG=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';

/* =============== Utils =============== */
const fmt=n=>Number(n||0).toLocaleString(undefined,{maximumFractionDigits:8});
const agoSec=(from)=>{const s=((Date.now()-from)/1000)|0;return s+"s";}
const qrlink=t=>`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(t)}`;
async function j(url){try{const r=await fetch(url,{cache:'no-store'});if(!r.ok) throw 0;return await r.json()}catch(_){return null}}

/* =============== Defaults (fallback) =============== */
const DEF={
  site:{brand:"LightUnfold • UltraHub",ens:"lightunfold.eth",
        contact:{email:"vumumabada@gmail.com"},
        payments:{qr_auto:true,chains:[
          {name:"ETH (EVM)",address:"0x54E15A7b6d4213beE87800432A151d794638E3C2",explorer:"https://etherscan.io/address/0x54E15A7b6d4213beE87800432A151d794638E3C2",min:0.0005},
          {name:"USDT (ERC20)",address:"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",explorer:"https://etherscan.io/token/USDT?a=0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",min:5}
        ],offchain:{momo:"0567892030",vietcombank:"9567892030",paypal:"vumumabada@gmail.com"}},
        affiliates:[
          {name:"Binance",url:"https://www.binance.com/vi/register?ref=GRO_20338_9V44N",tag:"Top CEX"},
          {name:"AlgosOne",url:"https://algosone.page.link/MbtR",tag:"AI Trading"},
          {name:"OKX",url:"https://www.okx.com/join/your-code",tag:"CEX"},
          {name:"Bybit",url:"https://www.bybit.com/invite?ref=your-code",tag:"Derivatives"}]},
  feeds:{top_n:12}, schedule:{refresh_minutes:10},
  secrets:{unlock_code:"23061988"},
  store:{bundles:[
      {title:"Alpha Signals X",price:99,desc:"Tín hiệu ngắn hạn xác suất cao.",tags:["Scalping","DeFi","Spot"]},
      {title:"ETF & BTC Flow",price:79,desc:"Dòng vốn ETF/BTC – quỹ & miner.",tags:["BTC","ETF","Flow"]},
      {title:"Altseason Radar",price:69,desc:"Chu kỳ vốn hóa & leader/laggard.",tags:["Cycle","Momentum"]},
      {title:"Whale Watcher Pro",price:89,desc:"Theo dõi ví cá voi & giao dịch lớn.",tags:["Onchain","Whales"]},
      {title:"Airdrop Hunter",price:59,desc:"Lịch farming & điểm tích lũy.",tags:["Quest","Points"]}
    ],
    premium:[
      {title:"Alpha Feed Pro",desc:"Dòng tin alpha siêu nhanh (độ trễ ms).",bullets:["Bất thường dòng tiền","Nguồn đa kênh","Bộ lọc nhiễu"],link:"data/latest.json"},
      {title:"Deal Flow Private",desc:"Tổng hợp deal/seed đang mở private.",bullets:["Điều kiện","Ưu tiên thời gian"]}
    ]
  }
};

let CFG=DEF, lastRefreshTS=Date.now();

/* =============== V5 SWITCH – nạp 6 tệp V5 và ghi đè =============== */
const V5_ON = true;
const V5_PATHS = {
  vi:   'lang/vi.v5.json',
  en:   'lang/en.v5.json',
  site: 'site.v5.json',
  ui:   'ui.v5.json',
  feeds:'feeds.v5.json',
  min:  'v5min.json'   // bạn đã đổi từ v5.min.json -> v5min.json
};
async function getJSONNoCache(p){ try{const r=await fetch(p,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json();}catch(_){return null} }
function applyLangV5Dict(dict){
  if(!dict) return;
  if(dict.hero){
    if(dict.hero.tagline)   {const el=document.getElementById('tagline'); if(el) el.textContent=dict.hero.tagline;}
    if(dict.hero.slogan)    {const el=document.getElementById('slogan');  if(el) el.textContent=dict.hero.slogan;}
  }
  if(dict.sections){
    const S=dict.sections;
    if(S.hot)      {const el=document.getElementById('hotTitle'); if(el) el.textContent=S.hot;}
    if(S.pay)      {const el=document.getElementById('payTitle'); if(el) el.textContent=S.pay;}
    if(S.lock)     {const el=document.getElementById('lockTitle'); if(el) el.textContent=S.lock;}
    if(S.packs)    {const el=document.getElementById('packTitle'); if(el) el.textContent=S.packs;}
    if(S.cta)      {const el=document.getElementById('ctaTitle'); if(el) el.textContent=S.cta;}
    if(S.unlocked) {const el=document.getElementById('unlockedLbl'); if(el) el.textContent=S.unlocked;}
  }
  if(dict.footer?.auto){ const el=document.getElementById('autoLbl'); if(el) el.textContent=dict.footer.auto; }
  if(dict.labels){
    const L=dict.labels;
    if(L.minLbl){const el=document.getElementById('minLbl'); if(el) el.textContent=L.minLbl;}
    if(L.contactLbl){const el=document.getElementById('contactLbl'); if(el) el.textContent=L.contactLbl;}
    if(L.howTitle){const el=document.getElementById('howTitle'); if(el) el.textContent=L.howTitle;}
  }
}
function mergeCfgV5(parts){
  const next={...CFG};
  if(parts.site){ next.site = parts.site.site ? {...next.site, ...parts.site.site} : {...next.site, ...parts.site}; }
  if(parts.ui){   next.ui   = parts.ui.ui     ? {...next.ui,   ...parts.ui.ui}     : {...next.ui,   ...parts.ui}; }
  if(parts.feeds){next.feeds= parts.feeds.feeds?{...next.feeds,...parts.feeds.feeds}:{...next.feeds,...parts.feeds};}
  if(parts.min){
    if(parts.min.secrets?.unlock_code) next.secrets={unlock_code:String(parts.min.secrets.unlock_code)};
    if(parts.min.unlock_code)          next.secrets={unlock_code:String(parts.min.unlock_code)};
  }
  return next;
}
async function loadV5All(){
  if(!V5_ON) return;
  const [viV5,enV5,siteV5,uiV5,feedsV5,minV5] = await Promise.all([
    getJSONNoCache(V5_PATHS.vi),
    getJSONNoCache(V5_PATHS.en),
    getJSONNoCache(V5_PATHS.site),
    getJSONNoCache(V5_PATHS.ui),
    getJSONNoCache(V5_PATHS.feeds),
    getJSONNoCache(V5_PATHS.min)
  ]);
  const current=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';
  if(current==='vi' && viV5) applyLangV5Dict(viV5);
  if(current==='en' && enV5) applyLangV5Dict(enV5);
  CFG = mergeCfgV5({site:siteV5, ui:uiV5, feeds:feedsV5, min:minV5});

  const cfgBtn=document.getElementById('openCfg');
  if(cfgBtn && siteV5){
    cfgBtn.onclick=()=>{const m=document.getElementById('modal');const f=document.getElementById('frame');const a=document.getElementById('openNew');document.getElementById('modalTitle').textContent='site.v5.json';f.src='site.v5.json';a.href='site.v5.json';m.style.display='flex';};
  }

  // Repaint theo CFG mới
  try{renderPays();renderAffs();renderBundles('day');paintPremium();}catch(_){}
}
/* =============== /V5 SWITCH =============== */

/* =============== Boot =============== */
(async function boot(){
  $('#year').textContent=new Date().getFullYear();

  // modal openers
  bindModal('#openCfg','config.json','config.json');
  bindModal('#openData','data/latest.json','data/latest.json');

  // nạp config cũ (nếu có)
  const cfg=await j('config.json'); if(cfg) CFG=Object.assign({},DEF,cfg);

  // >>> GỌI V5: ghi đè CFG + i18n nếu có file V5
  await loadV5All();

  // Header
  $('#brand').textContent=CFG.site.brand||'LightUnfold • UltraHub';
  $('#ens').textContent=CFG.site.ens||'—';

  // Contact
  const contact=(CFG.site?.contact?.email||CFG.site?.contact||CFG.site.ens||'').toString();
  const pp=document.getElementById('pp'); if(pp) pp.innerHTML = contact ? `<a href="mailto:${contact}" target="_blank" rel="noopener">${contact}</a>` : '—';

  // Share links
  const u=encodeURIComponent(location.href), t=encodeURIComponent(document.title);
  $('#sh_tg').href=`https://t.me/share/url?url=${u}`;
  $('#sh_x').href =`https://twitter.com/intent/tweet?text=${t}&url=${u}`;
  $('#sh_fb').href=`https://www.facebook.com/sharer/sharer.php?u=${u}`;
  $('#sh_in').href=`https://www.linkedin.com/sharing/share-offsite/?url=${u}`;

  // Buttons
  $('#refreshNow').onclick=loadDataSmart;
  $('#goTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

  // Render chính
  renderPays();
  renderAffs();
  renderBundles('day');
  $('#timeTabs').onclick=e=>{const t=e.target.closest('.tab'); if(!t) return; $$('#timeTabs .tab').forEach(x=>x.classList.remove('act')); t.classList.add('act'); renderBundles(t.dataset.t)};
  paintPremium(); bindPaywall();

  // Command center
  const names=["dex.html","hyper_v2.html","pro.html","super_auto.html","super_share.html","xpeotl.html","xportal.html"];
  $('#apps').innerHTML=names.map(n=>`<a href="${n}" target="_blank" rel="noopener">${n.replace('.html','').replaceAll('_',' ').toUpperCase()}</a>`).join('');

  // Data loop
  await loadDataSmart();
  const every=Math.max(3, Number(CFG.schedule?.refresh_minutes||10));
  setInterval(loadDataSmart,every*60*1000);

  // Live pulse
  setInterval(()=>$('#pulse').textContent=(LANG==='vi'?'Cập nhật: ':'Updated: ')+agoSec(lastRefreshTS),1000);

  // Áp i18n lần đầu
  applyLang();

  try{registerSW()}catch(_){}
})();

/* =============== Modal helper =============== */
function bindModal(btnSel,url,title){
  const btn=$(btnSel), modal=$('#modal'), frame=$('#frame'), openNew=$('#openNew'), mt=$('#modalTitle');
  btn.onclick=()=>{mt.textContent=title; frame.src=url; openNew.href=url; modal.style.display='flex';}
  $('#closeModal').onclick=()=>{modal.style.display='none'; frame.src='about:blank';}
  modal.addEventListener('click',e=>{if(e.target===modal){modal.style.display='none'; frame.src='about:blank';}})
}

/* =============== Payments (clickable) =============== */
function renderPays(){
  const P=CFG.site?.payments||{}; const chains=P.chains||[]; const off=P.offchain||{};
  const mins=(()=>{const m={}; chains.forEach(c=>{if(/ETH/i.test(c.name)) m.ETH=c.min||0.0005; if(/USDT/i.test(c.name)) m.USDT=c.min||5}); return m})();
  $('#mins').textContent=["ETH ≥ "+(mins.ETH||0.0005),"USDT ≥ "+(mins.USDT||5)].join(", ");

  const items=[];
  chains.forEach(c=>{
    const open = "https://metamask.app.link/";
    items.push(`
      <div class="card"><div class="pay">
        <img alt="QR" src="${qrlink(c.address)}" loading="lazy" title="Quét để thanh toán">
        <div class="meta">
          <div class="row" style="justify-content:space-between"><b>${c.name}</b>
            <a class="btn out" target="_blank" rel="noopener" href="${open}">${LANG==='vi'?'Mở ví/ứng dụng':'Open wallet/app'} ↗</a></div>
          <div class="mono"><a href="${c.explorer||'#'}" target="_blank" rel="noopener">${c.address}</a></div>
          ${c.explorer?`<div style="color:#9fb3c8">Explorer: <a target="_blank" rel="noopener" href="${c.explorer}">On‑chain ↗</a></div>`:""}
          ${c.min?`<div style="color:#9fb3c8">${LANG==='vi'?'Tối thiểu':'Minimum'}: ${c.min}</div>`:""}
          <div class="row" style="margin-top:8px">
            <button class="btn" onclick="navigator.clipboard.writeText('${c.address}')">${LANG==='vi'?'Sao chép':'Copy'}</button>
            <a class="btn out" href="${qrlink(c.address)}" download>⚡ ${LANG==='vi'?'Tải QR':'Download QR'}</a>
          </div>
        </div>
      </div></div>`);
  });
  if(off.momo) items.push(payBox("MoMo",off.momo,LANG==='vi'?"Ví MoMo Việt Nam.":"Vietnam MoMo wallet."));
  if(off.vietcombank) items.push(payBox("Vietcombank",off.vietcombank,LANG==='vi'?"Chuyển khoản VCB.":"VCB bank transfer."));
  if(off.paypal) items.push(payBox("PayPal",off.paypal,`${LANG==='vi'?'Thanh toán PayPal.':'Pay via PayPal.'} <a target="_blank" rel="noopener" href="https://www.paypal.me/${off.paypal.split('@')[0]}">PayPal.me ↗</a>`));
  $('#pays').innerHTML=items.join("");

  function payBox(label,addr,hint){return `
    <div class="card"><div class="pay">
      <img alt="QR" src="${qrlink(addr)}" loading="lazy">
      <div class="meta">
        <div class="row" style="justify-content:space-between"><b>${label}</b><span></span></div>
        <div style="color:#9fb3c8">${hint||""}</div>
        <div class="mono">${addr}</div>
        <div class="row" style="margin-top:8px">
          <button class="btn" onclick="navigator.clipboard.writeText('${addr}')">${LANG==='vi'?'Sao chép':'Copy'}</button>
          <a class="btn out" href="${qrlink(addr)}" download>⚡ ${LANG==='vi'?'Tải QR':'Download QR'}</a>
        </div>
      </div>
    </div></div>`}
}

/* =============== Affiliates (clickable) =============== */
function renderAffs(){
  const A=CFG.site?.affiliates||[];
  $('#affs').innerHTML=A.map(a=>`<div class="affcard">
    <div><b>${a.name}</b> · <span class="tag">${a.tag||'Partner'}</span></div>
    <div class="actions">
      <a class="btn" href="${a.url}" target="_blank" rel="noopener">${LANG==='vi'?'Đăng ký/Truy cập':'Join/Visit'} ↗</a>
      <button class="btn out" onclick="navigator.clipboard.writeText('${a.url}')">${LANG==='vi'?'Sao chép link':'Copy link'}</button>
    </div>
  </div>`).join('');
}

/* =============== Data (ticker + alert) =============== */
window.LAST_ITEMS = [];

async function loadDataSmart(){
  const latest=await j('data/latest.json'); lastRefreshTS=Date.now();
  if(latest && Array.isArray(latest.items)){
    $('#hb').textContent='LIVE'; $('#scanMode').textContent=i18n[LANG].scan_data;
    renderOpps(latest.items); return;
  }
  const items=await scanLive();
  $('#hb').textContent='LIVE'; $('#scanMode').textContent=i18n[LANG].scan_fallback;
  renderOpps(items);
}
async function scanLive(){
  const items=[];
  try{
    const cg=await j('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=40&page=1&price_change_percentage=1h,24h,7d');
    if(Array.isArray(cg)) for(const c of cg){
      items.push({source:"coingecko",symbol:(c.symbol||"").toUpperCase(),name:c.name,
        price:+c.current_price||0,ch24h:+c.price_change_percentage_24h_in_currency||0,vol24h:+c.total_volume||0,
        score:(+c.price_change_percentage_1h_in_currency||0)*0.4+(+c.price_change_percentage_24h_in_currency||0)*0.35+(+c.price_change_percentage_7d_in_currency||0)*0.25+Math.log10((+c.total_volume||1)),
        link:`https://www.coingecko.com/en/coins/${c.id}`});
    }
  }catch(_){}
  try{
    const cl=await j('https://api.coinlore.net/api/tickers/?start=0&limit=40');
    const data=cl?.data||[];
    for(const c of data){
      items.push({source:"coinlore",symbol:(c.symbol||"").toUpperCase(),name:c.name,
        price:+c.price_usd||0,ch24h:+c.percent_change_24h||0,vol24h:+c.volume24||0,
        score:(+c.percent_change_24h||0)*0.7+Math.log10((+c.volume24||1)),
        link:`https://www.coinlore.com/coin/${(c.name||"").toLowerCase().replace(/\s+/g,"-")}`});
    }
  }catch(_){}
  const best={}; for(const it of items){if(!it.symbol) continue; const k=it.symbol; if(!best[k]||it.score>best[k].score) best[k]=it;}
  return Object.values(best).sort((a,b)=>b.score-a.score).slice(0, CFG.feeds?.top_n||12);
}
const __renderOppsOrig=function(items){
  $('#ticker').innerHTML=(items||[]).map(x=>`<span class="tag">${x.symbol}: $${fmt(x.price)} (${(x.ch24h||0).toFixed(2)}%)</span>`).join('')||'—';
  const maxAbs=items?.length?Math.max(...items.map(x=>Math.abs(x.ch24h||0))):0;
  const ALERT_TH=12, alertBox=$('#alertBox');
  if(maxAbs>=ALERT_TH){alertBox.classList.remove('hidden');alertBox.innerHTML=`⚠️ <b>Alert:</b> ${LANG==='vi'?'Biến động lớn':'Large move'} (${maxAbs.toFixed(2)}%) – ${LANG==='vi'?'kiểm tra các cơ hội bên dưới.':'check opportunities below.'}`;}
  else{alertBox.classList.add('hidden');alertBox.textContent='';}
  const L=i18n[LANG];
  $('#opps').innerHTML=(items||[]).map(x=>{
    const ch=x.ch24h||0, pct=`${ch>=0?'+':''}${ch.toFixed(2)}%`;
    return `<div class="item">
      <div class="score">+${(x.score||0).toFixed(2)}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div><b>${x.symbol}</b> · <span style="color:#9fb3c8">${x.name||''}</span></div>
          <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${L.details} ↗</a>
        </div>
        <div class="row" style="gap:8px">
          <span class="tag">${L.price}: $${fmt(x.price||0)}</span>
          <span class="tag ${ch>=0?'':'err'}">24h: ${pct}</span>
          <span class="tag">${L.volume}: $${fmt(x.vol24h||0)}</span>
          <span class="tag">Src: ${x.source}</span>
        </div>
      </div>
    </div>`;
  }).join('')||'<div style="color:#9fb3c8">—</div>';
};
function renderOpps(items){ window.LAST_ITEMS=items||[]; __renderOppsOrig(window.LAST_ITEMS); }

/* =============== Bundles =============== */
function renderBundles(mode='day'){
  const B=CFG.store?.bundles||[];
  const L=i18n[LANG];
  $('#bundles').innerHTML=B.map(b=>{
    const tags=(b.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
    return `<div class="card">
      <div class="row" style="justify-content:space-between"><b>${b.title}</b><span class="badge">$${b.price}</span></div>
      <div style="color:#9fb3c8">${b.desc||''}</div>
      <div style="margin-top:6px">${tags}</div>
      <div class="row" style="margin-top:8px"><button class="btn" onclick="document.getElementById('unlockCode').focus()">${L.buy_enter}</button><span class="badge">${mode}</span></div>
    </div>`;
  }).join('');
}

/* =============== Premium + Paywall (code: 23061988) =============== */
function paintPremium(){
  const P=CFG.store?.premium||[];
  const L=i18n[LANG];
  $('#premium').innerHTML=P.map(p=>`<div class="card"><b>${p.title}</b>
    <div style="color:#9fb3c8">${p.desc||''}</div>
    ${p.bullets?`<ul>${p.bullets.map(x=>`<li>${x}</li>`).join('')}</ul>`:""}
    ${p.link?`<a class="btn out" target="_blank" rel="noopener" href="${p.link}">${L.open_data} ↗</a>`:""}
  </div>`).join('');
}
function bindPaywall(){
  const SECRET=String(CFG.secrets?.unlock_code||'23061988');
  const saved=localStorage.getItem('unlocked_code')||'';
  function gate(open){$('#locked').classList.toggle('hidden',open);$('#opened').classList.toggle('hidden',!open);}
  if(saved===SECRET){gate(true); paintPremium(); const th=localStorage.getItem('tx_hash'); if(th) $('#uMsg').innerHTML='<span class="ok">TX: '+th+'</span>';}
  $('#doUnlock').onclick=()=>{const code=$('#unlockCode').value.trim(),tx=$('#txhash').value.trim();
    if(code===SECRET){gate(true); paintPremium(); $('#uMsg').innerHTML='<span class="ok">'+(LANG==='vi'?'Đã mở khóa!':'Unlocked!')+'</span>'; if(tx) localStorage.setItem('tx_hash',tx); localStorage.setItem('unlocked_code',code);}
    else $('#uMsg').innerHTML='<span class="err">'+(LANG==='vi'?'Mã không đúng.':'Invalid code.')+'</span>';};
  $('#remember').onclick=()=>{const c=$('#unlockCode').value.trim(); if(c){localStorage.setItem('unlocked_code',c); $('#uMsg').textContent=LANG==='vi'?'Đã lưu trên thiết bị.':'Saved on device.'}};
  $('#relock').onclick=()=>{localStorage.removeItem('unlocked_code'); gate(false);};
}

/* =============== i18n apply (toàn trang) =============== */
function applyLang(){
  const L=i18n[LANG];
  $('#hotTitle').textContent=L.hot; $('#payTitle').textContent=L.pay; $('#minLbl').textContent=L.minLbl;
  $('#contactLbl').textContent=L.contactLbl; $('#lockTitle').textContent=L.lock; $('#howTitle').textContent=L.how;
  $('#unlockedLbl').textContent=L.unlocked; $('#packTitle').textContent=L.packs; $('#hubHint').textContent=L.hub;
  $('#ctaTitle').textContent=L.cta; $('#cta1H').textContent=L.cta1H; $('#cta1').textContent=L.cta1;
  $('#cta2H').textContent=L.cta2H; $('#cta2').textContent=L.cta2; $('#cta3H').textContent=L.cta3H; $('#cta3').textContent=L.cta3;
  $('#autoLbl').textContent=L.auto; $('#whyH1').textContent=L.whyH1; $('#whyH2').textContent=L.whyH2; $('#whyH3').textContent=L.whyH3;
  $('#why1').textContent=L.why1; $('#why2').textContent=L.why2; $('#why3').textContent=L.why3;
  $('#lang').textContent=LANG==='vi'?'VI/EN':'EN/VI';
  const uc=$('#unlockCode'), tx=$('#txhash'); if(uc) uc.placeholder=L.unlock_ph; if(tx) tx.placeholder=L.tx_ph;
  const btnUnlock=$('#doUnlock'), btnRemember=$('#remember'), btnRelock=$('#relock');
  if(btnUnlock) btnUnlock.textContent=L.unlock_btn;
  if(btnRemember) btnRemember.textContent=L.remember_btn;
  if(btnRelock) btnRelock.textContent=L.relock_btn;
  const scan=$('#scanMode'); if(scan){const fb=/fallback/i.test(scan.textContent); scan.textContent=fb?L.scan_fallback:L.scan_data;}
  const rn=$('#refreshNow'); if(rn) rn.textContent=L.refresh;

  try{ renderPays(); }catch(e){}
  try{ const act=document.querySelector('#timeTabs .tab.act'); renderBundles(act?act.dataset.t:'day'); }catch(e){}
  try{ paintPremium(); }catch(e){}
  try{ if(window.LAST_ITEMS && window.LAST_ITEMS.length) renderOpps(window.LAST_ITEMS); }catch(e){}
}
// toggle ngôn ngữ
$('#lang').onclick=()=>{LANG=LANG==='vi'?'en':'vi';localStorage.setItem('lang',LANG);applyLang();};

/* =============== PWA mini (cache nội bộ) =============== */
function registerSW(){
  const sw=`
    const CORE=['./','index.html','config.json','data/latest.json'];
    self.addEventListener('install',e=>{e.waitUntil(caches.open('uh-core').then(c=>c.addAll(CORE)).then(()=>self.skipWaiting()))});
    self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim())});
    self.addEventListener('fetch',e=>{
      const u=new URL(e.request.url);
      if(u.origin===location.origin){e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));return;}
      e.respondWith(fetch(e.request).catch(()=>caches.match('./')));
    });
  `;
  const url=URL.createObjectURL(new Blob([sw],{type:'text/javascript'}));
  navigator.serviceWorker.register(url,{scope:'./'});
}
</script>
</body>
</html>
