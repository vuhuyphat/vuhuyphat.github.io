<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>LightUnfold ‚Ä¢ Web3 AI X1000 ‚Äî Ultra Hub</title>
<meta name="description" content="Web3 AI t·ª± ƒë·ªông 24/7: c∆° h·ªôi n·ªïi b·∫≠t realtime, thanh to√°n QR (kh√¥ng l·ªô email), n·ªôi dung premium (m√£), affiliate, Command Center, i18n, PWA nh·∫π.">
<link rel="canonical" href="https://vuhuyphat.github.io/">
<meta property="og:title" content="LightUnfold ‚Ä¢ Web3 AI X1000 ‚Äî Ultra Hub">
<meta property="og:description" content="N·ªÅn t·∫£ng Web3 AI t·ª± v·∫≠n h√†nh 24/7: qu√©t ƒëa ngu·ªìn, c·∫£nh b√°o, thanh to√°n, paywall, affiliate.">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0b0f13">
<style>
:root{--bg:#0b0f13;--card:#10161d;--line:#1c2836;--txt:#e9eef4;--mut:#9fb3c8;--brand:#7dc1ff;--accent:#ffb000;--ok:#20c997;--bad:#ff4d4f;--pill:#0f141c}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
a{color:#8ecbff;text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:var(--pill);color:var(--mut)}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin-top:12px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid var(--line);color:var(--txt)}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
.list .item{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px dashed var(--line)}
.score{min-width:60px;text-align:center;border:1px solid var(--line);border-radius:8px;padding:4px 6px;color:#ffdca8;background:#241a00}
.tag{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:2px 8px;margin:2px 4px 0 0;color:#bcd;font-size:12px}
.mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;word-break:break-all}
.hidden{display:none}
.footer{padding:28px 0;text-align:center;color:#9fb3c8}
.marquee{white-space:nowrap;overflow:hidden}.marquee>div{display:inline-block;animation:mar 25s linear infinite}
@keyframes mar{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.tabbar{display:flex;gap:8px;flex-wrap:wrap}.tab{padding:6px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer}
.tab.act{background:var(--accent);color:#1a1300;border-color:transparent}
.appgrid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
.appgrid a{display:block;padding:10px;border:1px solid var(--line);border-radius:12px;background:var(--pill);text-align:center}
.share{position:fixed;right:12px;bottom:82px;display:flex;gap:8px;background:var(--pill);border:1px solid var(--line);border-radius:12px;padding:8px;z-index:50}
.share a{font-size:18px}
.fab{position:fixed;left:12px;bottom:82px;background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:10px 12px;color:var(--mut);z-index:50;cursor:pointer}
/* modal */
.modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.35);z-index:90}
.modal.open{display:flex}
.sheet{width:100%;max-width:1100px;background:var(--card);border:1px solid var(--line);border-radius:16px 16px 0 0;padding:14px;max-height:87vh;overflow:auto}
.sheet h4{margin:6px 0 10px}
pre.json{white-space:pre-wrap;word-break:break-word;background:#0c1218;border:1px solid var(--line);border-radius:10px;padding:10px}
/* light */
.light{--bg:#f7fafc;--card:#ffffff;--line:#e2e8f0;--txt:#0b0f13;--mut:#4a5568;--brand:#2563eb;--pill:#f3f6fb}
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <button class="pill" id="backBtn">‚¨Ö Back</button>
    <span class="pill">ENS: <b id="ens">‚Äî</b></span>
    <span class="pill">Heartbeat: <b id="hb">‚Äî</b></span>
    <button class="pill" id="viewData">data</button>
    <button class="pill" id="viewCfg">config</button>
    <button class="pill" id="lang">VI/EN</button>
    <button class="pill" id="theme">üåó Theme</button>
  </div>

  <h1 id="brand">LightUnfold ‚Ä¢ Web3 AI X1000</h1>
  <div id="tagline" class="muted">‚Äî</div>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <div class="muted">20,000+ AI ‚Ä¢ 200+ qu·ªëc gia ‚Ä¢ 200+ ng√¥n ng·ªØ ‚Ä¢ T·ª± ƒë·ªông 24/7 ‚Ä¢ Chuy·ªÉn ƒë·ªïi X1000</div>
      <div class="badge">C·∫≠p nh·∫≠t: <span id="updated">‚Äî</span></div>
    </div>
    <div id="alert" class="hidden" style="margin-top:8px;background:#1a2300;border:1px solid #344600;color:#e5ff9a;border-radius:10px;padding:8px">‚ö†Ô∏è <b>Alert:</b> Bi·∫øn ƒë·ªông l·ªõn ‚Äì ki·ªÉm tra c√°c c∆° h·ªôi b√™n d∆∞·ªõi.</div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">üî• C∆° h·ªôi n·ªïi b·∫≠t</h3>
      <div class="row">
        <span class="pill" id="scanMode">qu√©t: ‚Äî</span>
        <button class="pill" id="refreshNow">‚Üª L√†m m·ªõi</button>
      </div>
    </div>
    <div class="marquee" style="margin:4px 0 8px;color:#bcd"><div id="ticker">‚Äî</div></div>
    <div id="opps" class="list"></div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">üí≥ Thanh to√°n</h3>
      <button class="btn" id="openPay">M·ªü ph∆∞∆°ng th·ª©c</button>
    </div>
    <div class="muted">Sau thanh to√°n, b·∫°n nh·∫≠n <b>m√£ m·ªü kh√≥a</b> ƒë·ªÉ xem n·ªôi dung cao c·∫•p. H·ªó tr·ª£: <span id="support"></span></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px">üîì N·ªôi dung cao c·∫•p</h3>
    <div id="locked">
      <input id="unlockCode" placeholder="Nh·∫≠p m√£ m·ªü kh√≥a‚Ä¶" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)">
      <input id="txhash" placeholder="(T√πy ch·ªçn) D√°n m√£ giao d·ªãch/b·∫±ng ch·ª©ng" style="margin-top:8px;width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)">
      <div class="row" style="margin-top:8px">
        <button class="btn" id="doUnlock">M·ªü kh√≥a</button>
        <button class="btn ghost" id="remember">Nh·ªõ tr√™n thi·∫øt b·ªã</button>
      </div>
      <div id="uMsg" class="muted" style="margin-top:6px"></div>
      <div class="muted" style="margin-top:8px">C√°ch ho·∫°t ƒë·ªông: Thanh to√°n ‚ûú nh·∫≠n m√£ ‚ûú nh·∫≠p ƒë·ªÉ m·ªü kh√≥a; c√≥ th·ªÉ l∆∞u m√£ & TX tr√™n thi·∫øt b·ªã.</div>
    </div>
    <div id="opened" class="hidden">
      <div class="row"><span class="pill" style="color:var(--ok)">‚úî ƒê√£ m·ªü kh√≥a</span><button class="btn ghost" id="relock">Kho√° l·∫°i</button></div>
      <div id="premium" class="grid" style="margin-top:10px"></div>
    </div>
  </section>

  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">üß∞ G√≥i s·∫£n ph·∫©m / B√°o c√°o</h3>
      <div class="tabbar" id="timeTabs">
        <div class="tab act" data-t="day">Ng√†y</div>
        <div class="tab" data-t="month">Th√°ng</div>
        <div class="tab" data-t="quarter">Qu√Ω</div>
        <div class="tab" data-t="year">NƒÉm</div>
      </div>
    </div>
    <div id="bundles" class="grid"></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px">ü§ù Affiliate</h3>
    <div id="affs" class="grid"></div>
  </section>

  <section class="card">
    <h3 style="margin:0 0 8px">üß≠ Command Center</h3>
    <div id="apps" class="appgrid"></div>
    <div class="muted" style="margin-top:6px">T·ª± ph√°t hi·ªán & li√™n k·∫øt t·ªõi c√°c c√¥ng c·ª• c≈© (dex, hyper_v2, pro, super_auto, super_share, xpeotl, xportal‚Ä¶).</div>
  </section>

  <div class="footer">¬© <span id="year"></span> LightUnfold ‚Ä¢ T·ª± ƒë·ªông 24/7</div>
</div>

<!-- floating -->
<div class="share" id="shareBar">
  <a id="sh_tg" target="_blank">üì£</a>
  <a id="sh_x" target="_blank">ùïè</a>
  <a id="sh_fb" target="_blank">f</a>
  <a id="sh_in" target="_blank">in</a>
</div>
<div class="fab" id="toTop">‚Üë Top</div>

<!-- modal -->
<div class="modal" id="modal">
  <div class="sheet">
    <div class="row" style="justify-content:space-between">
      <h4 id="modalTitle">Modal</h4>
      <button class="pill" id="closeModal">ƒê√≥ng</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
/* ========= helpers ========= */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const fmt=n=>Number(n||0).toLocaleString(undefined,{maximumFractionDigits:8});
const ago=iso=>{if(!iso)return"‚Äî";const s=(Date.now()-new Date(iso))/1000|0;if(s<60)return s+"s";const m=s/60|0;if(m<60)return m+"m";const h=m/60|0;return h<24?h+"h":(h/24|0)+"d";}
const qrlink=v=>`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(v)}`;
const getJSON=async(u,k)=>{try{const r=await fetch(u,{cache:"no-store"});const j=await r.json();if(k)localStorage.setItem(k,JSON.stringify(j));return j}catch(e){if(k){try{return JSON.parse(localStorage.getItem(k)||"{}")}catch{return{}}}return{}}}
function setTheme(m){document.body.classList.toggle('light',m==='light');localStorage.setItem('theme',m)}
function openModal(t,html){$('#modalTitle').textContent=t;$('#modalBody').innerHTML=html;$('#modal').classList.add('open')}
function closeModal(){ $('#modal').classList.remove('open'); $('#modalBody').innerHTML=''; }
function escapeHTML(s){return String(s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}

/* ========= defaults ========= */
const DEF={
  site:{
    brand:"LightUnfold ‚Ä¢ Web3 AI X1000",ens:"lightunfold.eth",
    tagline:"20,000+ AI ‚Ä¢ 200+ qu·ªëc gia ‚Ä¢ 200+ ng√¥n ng·ªØ ‚Ä¢ t·ª± ƒë·ªông 24/7 ‚Ä¢ chuy·ªÉn ƒë·ªïi X1000",
    contact:{ email:"" },
    payments:{
      eth:"0x54E15A7b6d4213beE87800432A151d794638E3C2",
      usdt_erc20:"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",
      momo:"0567892030",vietcombank:"9567892030",paypal:""
    },
    affiliates:[
      {name:"Binance",url:"https://www.binance.com/vi/register?ref=GRO_20338_9V44N",tag:"Top CEX"},
      {name:"AlgosOne",url:"https://algosone.page.link/MbtR",tag:"AI Trading"},
      {name:"OKX",url:"https://www.okx.com/join/your-code",tag:"CEX"},
      {name:"Bybit",url:"https://www.bybit.com/invite?ref=your-code",tag:"Derivatives"}
    ]
  },
  feeds:{top_n:12},schedule:{refresh_minutes:10},
  secrets:{unlock_code:"X1000VIP"},
  store:{
    bundles:[
      {title:"Alpha Signals X",price:99,desc:"T√≠n hi·ªáu ng·∫Øn h·∫°n x√°c su·∫•t cao.",tags:["Scalping","DeFi","Spot"]},
      {title:"ETF & BTC Flow",price:79,desc:"D√≤ng v·ªën ETF/BTC ‚Äì qu·ªπ & miner.",tags:["BTC","ETF","Flow"]},
      {title:"Altseason Radar",price:69,desc:"Chu k·ª≥ v·ªën h√≥a & leader/laggard.",tags:["Cycle","Momentum"]},
      {title:"Whale Watcher Pro",price:89,desc:"Theo d√µi v√≠ c√° voi & giao d·ªãch l·ªõn.",tags:["Onchain","Whales"]},
      {title:"Airdrop Hunter",price:59,desc:"L·ªãch farming & ƒëi·ªÉm t√≠ch l≈©y.",tags:["Quest","Points"]},
      {title:"Perp Heatmap",price:79,desc:"Funding, OI, liquidation map.",tags:["Futures","Heatmap"]},
      {title:"Narrative Scanner",price:49,desc:"Xu h∆∞·ªõng L2, AI, RWA, GameFi.",tags:["Narrative"]},
      {title:"Risk Guard",price:39,desc:"C·∫£nh b√°o r·ªßi ro smart‚Äëmoney & dev activity.",tags:["Risk","Safety"]},
      {title:"Tokenomics Lens",price:69,desc:"L·ªãch vesting & pha lo√£ng.",tags:["Vesting","FDV"]},
      {title:"Copy‚ÄëTrade Radar",price:59,desc:"Theo d√µi trader m·∫´u & t√≠n hi·ªáu sao ch√©p.",tags:["Copy","Social"]}
    ],
    premium:[
      {title:"Alpha Feed Pro",desc:"D√≤ng tin alpha si√™u nhanh (ƒë·ªô tr·ªÖ ms).",bullets:["B·∫•t th∆∞·ªùng d√≤ng ti·ªÅn","Ngu·ªìn ƒëa k√™nh","B·ªô l·ªçc nhi·ªÖu"],link:"data/latest.json"},
      {title:"Deal Flow Private",desc:"T·ªïng h·ª£p deal/seed m·ªü private.",bullets:["ƒêi·ªÅu ki·ªán","∆Øu ti√™n th·ªùi gian"]}
    ]
  }
};

/* ========= boot ========= */
(async function(){
  // theme / lang / nav
  setTheme(localStorage.getItem('theme')||'dark'); $('#theme').onclick=()=>setTheme(document.body.classList.contains('light')?'dark':'light');
  let LANG=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';
  $('#lang').textContent=LANG==='vi'?'VI/EN':'EN/VI'; $('#lang').onclick=()=>{LANG=LANG==='vi'?'en':'vi';localStorage.setItem('lang',LANG);$('#lang').textContent=LANG==='vi'?'VI/EN':'EN/VI';};
  $('#backBtn').onclick=()=>history.length>1?history.back():window.scrollTo({top:0,behavior:'smooth'});
  $('#toTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
  $('#year').textContent=new Date().getFullYear();

  // config + contact
  const CFG=Object.assign({},DEF, await getJSON('config.json','cfg'));
  $('#brand').textContent=CFG.site.brand; $('#ens').textContent=CFG.site.ens; $('#tagline').textContent=CFG.site.tagline;
  const support = CFG.site.contact?.telegram ? `<a target="_blank" href="${CFG.site.contact.telegram}">Telegram</a>` :
                  CFG.site.contact?.discord  ? `<a target="_blank" href="${CFG.site.contact.discord}">Discord</a>` :
                  CFG.site.contact?.email    ? `<a href="mailto:${CFG.site.contact.email}">Email</a>` : '@lightunfold';
  $('#support').innerHTML=support;

  // JSON viewer (kh√¥ng m·ªü tr·∫Øng)
  $('#viewCfg').onclick=async()=>{const j=await getJSON('config.json');openModal('config.json',`<div class="row"><a class="pill" target="_blank" href="config.json">M·ªü tab m·ªõi ‚Üó</a></div><pre class="json">${escapeHTML(JSON.stringify(j,null,2))}</pre>`);}
  $('#viewData').onclick=async()=>{const j=await getJSON('data/latest.json');openModal('data/latest.json',`<div class="row"><a class="pill" target="_blank" href="data/latest.json">M·ªü tab m·ªõi ‚Üó</a></div><pre class="json">${escapeHTML(JSON.stringify(j,null,2))}</pre>`);}
  $('#closeModal').onclick=closeModal; $('#modal').addEventListener('click',e=>{if(e.target.id==='modal')closeModal();});

  // share
  const u=encodeURIComponent(location.href), t=encodeURIComponent(document.title);
  $('#sh_tg').href=`https://t.me/share/url?url=${u}`; $('#sh_x').href=`https://twitter.com/intent/tweet?text=${t}&url=${u}`; $('#sh_fb').href=`https://www.facebook.com/sharer/sharer.php?u=${u}`; $('#sh_in').href=`https://www.linkedin.com/sharing/share-offsite/?url=${u}`;

  // command center (ph√°t hi·ªán t·ª± ƒë·ªông)
  const tools=["dex.html","hyper_v2.html","pro.html","super_auto.html","super_share.html","xpeotl.html","xportal.html"];
  const exists=await Promise.all(tools.map(p=>fetch(p,{method:'HEAD'}).then(r=>r.ok?p:null).catch(()=>null)));
  const apps=exists.filter(Boolean); $('#apps').innerHTML=apps.length?apps.map(p=>`<a href="${p}" target="_blank">${p.replace('.html','').replaceAll('_',' ').toUpperCase()}</a>`).join(''):'<div class="muted">Ch∆∞a ph√°t hi·ªán c√¥ng c·ª• c≈©.</div>';

  // bundles
  renderBundles(CFG,'day'); $('#timeTabs').onclick=e=>{const tab=e.target.closest('.tab'); if(!tab) return; $$('#timeTabs .tab').forEach(x=>x.classList.remove('act')); tab.classList.add('act'); renderBundles(CFG,tab.dataset.t);};

  // premium + paywall
  paintPremium(CFG); bindPaywall(CFG);

  // affiliates
  $('#affs').innerHTML=(CFG.site.affiliates||[]).map(a=>`<a class="card" target="_blank" href="${a.url}"><b>${a.name}</b><div class="muted">${a.tag||'ƒê·ªëi t√°c'}</div></a>`).join('');

  // payments modal
  $('#openPay').onclick=()=>openPayments(CFG);

  // data & alerts
  async function loadData(){
    const latest=await getJSON('data/latest.json','latest');
    let items, mode='data', ts;
    if(latest && Array.isArray(latest.items)){ items=latest.items; ts=latest.generated_at; }
    else { items=await scanLive(CFG); mode='fallback'; ts=new Date().toISOString(); }
    $('#hb').textContent=mode==='fallback'?'LIVE':'LIVE'; $('#scanMode').textContent='qu√©t: '+mode; $('#updated').textContent=ago(ts);
    const alerting=(items||[]).some(x=>Math.abs(x.ch24h||0)>=12||(x.vol24h||0)>1_000_000_000); $('#alert').classList.toggle('hidden',!alerting);
    renderOpps(items);
  }
  $('#refreshNow').onclick=loadData; await loadData();
  setInterval(loadData, Math.max(3, Number(CFG.schedule?.refresh_minutes||10))*60*1000);

  // PWA mini
  try{registerSW()}catch(_){}
})();

/* ========= renderers ========= */
function renderBundles(CFG,mode){
  const B=CFG.store?.bundles||[];
  $('#bundles').innerHTML=B.map(b=>`
    <div class="card">
      <div class="row" style="justify-content:space-between"><b>${b.title}</b><span class="badge">$${b.price}</span></div>
      <div class="muted">${b.desc||''}</div>
      <div style="margin-top:6px">${(b.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      <div class="row" style="margin-top:8px"><button class="btn" onclick="document.getElementById('unlockCode').focus()">Mua & nh·∫≠p m√£</button><span class="badge">${mode}</span></div>
    </div>`).join('');
}

function paintPremium(CFG){
  const P=CFG.store?.premium||[];
  $('#premium').innerHTML=P.map(p=>`
    <div class="card"><b>${p.title}</b>
      <div class="muted">${p.desc||''}</div>
      ${p.bullets?`<ul>${p.bullets.map(x=>`<li>${x}</li>`).join('')}</ul>`:''}
      ${p.link?`<a class="pill" target="_blank" href="${p.link}">Xem d·ªØ li·ªáu ‚Üó</a>`:''}
    </div>`).join('');
}

function bindPaywall(CFG){
  const SECRET=String(CFG.secrets?.unlock_code||'X1000VIP');
  const keep=localStorage.getItem('unlocked_code')||'';
  function gate(open){$('#locked').classList.toggle('hidden',open);$('#opened').classList.toggle('hidden',!open);}
  if(keep===SECRET){ gate(true); const th=localStorage.getItem('tx_hash'); if(th) $('#uMsg').innerHTML='TX ƒë√£ l∆∞u: '+th; }
  $('#doUnlock').onclick=()=>{ const code=$('#unlockCode').value.trim(), tx=$('#txhash').value.trim();
    if(code===SECRET){ gate(true); if(tx) localStorage.setItem('tx_hash',tx); $('#uMsg').innerHTML='<span style="color:var(--ok)">ƒê√£ m·ªü kh√≥a!</span>'; }
    else $('#uMsg').innerHTML='<span style="color:var(--bad)">M√£ kh√¥ng ƒë√∫ng.</span>'; };
  $('#remember').onclick=()=>{ const c=$('#unlockCode').value.trim(); if(c){ localStorage.setItem('unlocked_code',c); $('#uMsg').textContent='ƒê√£ l∆∞u tr√™n thi·∫øt b·ªã.'; } };
  $('#relock').onclick=()=>{ localStorage.removeItem('unlocked_code'); gate(false); };
}

async function scanLive(CFG){
  const out=[];
  try{
    const cg=await getJSON('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=40&page=1&price_change_percentage=1h,24h,7d');
    if(Array.isArray(cg)) for(const c of cg){
      out.push({source:'coingecko',symbol:(c.symbol||'').toUpperCase(),name:c.name,
        price:+c.current_price||0,ch24h:+c.price_change_percentage_24h_in_currency||0,vol24h:+c.total_volume||0,
        score:(+c.price_change_percentage_1h_in_currency||0)*0.4+(+c.price_change_percentage_24h_in_currency||0)*0.35+(+c.price_change_percentage_7d_in_currency||0)*0.25+Math.log10((+c.total_volume||1)),
        link:`https://www.coingecko.com/en/coins/${c.id}`});
    }
  }catch{}
  try{
    const cl=await getJSON('https://api.coinlore.net/api/tickers/?start=0&limit=40');
    (cl?.data||[]).forEach(c=>{
      out.push({source:'coinlore',symbol:(c.symbol||'').toUpperCase(),name:c.name,
        price:+c.price_usd||0,ch24h:+c.percent_change_24h||0,vol24h:+c.volume24||0,
        score:(+c.percent_change_24h||0)*0.7+Math.log10((+c.volume24||1)),
        link:`https://www.coinlore.com/coin/${(c.name||'').toLowerCase().replace(/\s+/g,'-')}`});
    });
  }catch{}
  const best={}; out.forEach(it=>{if(!it.symbol)return; if(!best[it.symbol]||it.score>best[it.symbol].score) best[it.symbol]=it;});
  return Object.values(best).sort((a,b)=>b.score-a.score).slice(0, CFG.feeds?.top_n||12);
}

function renderOpps(items){
  $('#opps').innerHTML=(items||[]).map(x=>{
    const ch=x.ch24h||0, pct=`${ch>=0?'+':''}${(ch||0).toFixed(2)}%`;
    return `<div class="item">
      <div class="score">${(x.score>=0?'+':'')}${(x.score||0).toFixed(2)}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div><b>${x.symbol}</b> ¬∑ <span class="muted">${x.name||''}</span></div>
          <a class="pill" target="_blank" href="${x.link||'#'}">Chi ti·∫øt ‚Üó</a>
        </div>
        <div class="row" style="gap:8px">
          <span class="tag">Gi√°: $${fmt(x.price||0)}</span>
          <span class="tag ${ch>=0?'':'err'}">24h: ${pct}</span>
          <span class="tag">Kh·ªëi l∆∞·ª£ng: $${fmt(x.vol24h||0)}</span>
          <span class="tag">Ngu·ªìn: ${x.source}</span>
        </div>
      </div>
    </div>`;
  }).join('') || '<div class="muted">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>';
  $('#ticker').innerHTML=(items||[]).slice(0,8).map(x=>`<span class="tag">${x.symbol}: $${fmt(x.price)} (${(x.ch24h||0).toFixed(2)}%)</span>`).join('')||'‚Äî';
}

/* ========= payments modal ========= */
function openPayments(CFG){
  const P=CFG.site?.payments||{}, blocks=[];
  if(P.eth) blocks.push(payBox('ETH (EVM)',P.eth,'N·∫°p ETH/USDT tr√™n EVM.','https://metamask.app.link/'));
  if(P.usdt_erc20) blocks.push(payBox('USDT (ERC20)',P.usdt_erc20,'USDT m·∫°ng ERC20.'));
  if(P.momo) blocks.push(payBox('MoMo',P.momo,'V√≠ MoMo Vi·ªát Nam.'));
  if(P.vietcombank) blocks.push(payBox('Vietcombank',P.vietcombank,'Ng√¢n h√†ng VCB.'));
  if(P.paypal) blocks.push(payBox('PayPal',P.paypal,`Thanh to√°n PayPal. <a target="_blank" href="https://www.paypal.me/${P.paypal.split('@')[0]}">PayPal.me ‚Üó</a>`));
  openModal('Ph∆∞∆°ng th·ª©c thanh to√°n', blocks.join('')||'<div class="muted">Ch∆∞a c·∫•u h√¨nh.</div>');
}
function payBox(label,addr,hint,openUrl){
  const qr=qrlink(addr);
  return `<div class="card">
    <div class="row" style="justify-content:space-between"><b>${label}</b>${openUrl?`<a class="pill" target="_blank" href="${openUrl}">M·ªü v√≠ ‚Üó</a>`:''}</div>
    <div class="row" style="gap:14px;align-items:flex-start">
      <img alt="QR" src="${qr}" style="width:160px;height:160px;border-radius:12px;border:1px solid var(--line);background:#000">
      <div style="flex:1;min-width:0">
        <div class="muted">${hint||''}</div>
        <div class="mono" style="margin-top:6px">${addr}</div>
        <div class="row" style="margin-top:8px">
          <button class="btn" onclick="navigator.clipboard.writeText('${addr}')">Sao ch√©p</button>
          <a class="btn ghost" href="${qr}" download>‚ö° T·∫£i QR</a>
        </div>
      </div>
    </div>
  </div>`;
}

/* ========= PWA mini ========= */
function registerSW(){
  const sw=`const CORE=['./','index.html','config.json','data/latest.json'];
self.addEventListener('install',e=>{e.waitUntil(caches.open('hp-core').then(c=>c.addAll(CORE)).then(()=>self.skipWaiting()))});
self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim())});
self.addEventListener('fetch',e=>{const u=new URL(e.request.url);if(u.origin===location.origin){e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));return}e.respondWith(fetch(e.request).catch(()=>caches.match('./')))});`;
  const url=URL.createObjectURL(new Blob([sw],{type:'text/javascript'}));
  navigator.serviceWorker.register(url,{scope:'./'});
}
</script>
</body>
</html>
