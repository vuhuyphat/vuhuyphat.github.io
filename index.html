<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>UltraMaster V15 ‚Ä¢ Web3 Singularity</title>
<meta name="description" content="V15: AI t√†i ch√≠nh 24/7, kho h·ªçc li·ªáu, c∆° h·ªôi th·ªã tr∆∞·ªùng, 1 QR thanh to√°n, n√¢ng c·∫•p b·∫±ng Quantum Key.">
<meta property="og:title" content="UltraMaster V15 ‚Ä¢ Web3 Singularity">
<meta property="og:description" content="AI 24/7 ‚Ä¢ Kho s√°ch & kh√≥a h·ªçc ‚Ä¢ BTC/ETH/USDT ‚Ä¢ Paywall ‚Ä¢ Binance & AlgosOne.">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0b0f13">
<style>
:root{
  --bg:#0b0f13;--card:#0f141a;--line:#1e2a3a;--txt:#e9eef4;--mut:#a9b8c8;
  --brand:#7dc1ff;--accent:#ffb000;--ok:#22c55e;--bad:#ff4d4f;--pill:#101825;
  --glow:0 0 0px rgba(0,0,0,0);
}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1120px;margin:0 auto;padding:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:var(--pill);color:var(--mut)}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin-top:12px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.out{background:transparent;border:1px solid var(--line);color:var(--txt)}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
.hidden{display:none}.mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;word-break:break-all}
.footer{padding:28px 0;text-align:center;color:var(--mut)}
.light{--bg:#f7fafc;--card:#ffffff;--line:#e2e8f0;--txt:#0b0f13;--mut:#4a5568;--brand:#2563eb;--pill:#eef2f8}
.marquee{white-space:nowrap;overflow:hidden}.marquee>div{display:inline-block;animation:mar 25s linear infinite}
@keyframes mar{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.list .item{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px dashed var(--line)}
.score{min-width:64px;text-align:center;border:1px solid var(--line);border-radius:10px;padding:4px 6px;color:#ffdca8;background:#241a00}
.tag{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:2px 8px;margin:2px 4px 0 0;color:#c9d6e2;font-size:12px}
.pay{display:flex;gap:14px}.pay img{width:160px;height:160px;border-radius:12px;border:1px solid var(--line);background:#000}
.pay .meta{flex:1;min-width:0}
.tabbar{display:flex;gap:8px;flex-wrap:wrap}.tab{padding:6px 10px;border:1px solid var(--line);border-radius:999px;cursor:pointer}
.tab.act{background:var(--accent);color:#1a1300;border-color:transparent}
.appgrid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))}
.appgrid a{display:block;padding:10px;border:1px solid var(--line);border-radius:12px;background:var(--pill);text-align:center}
.alert{background:#2a2e12;border:1px solid #606c38;color:#e9f5c7;border-radius:12px;padding:10px 12px}
.kpi{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.kbox{background:var(--pill);border:1px solid var(--line);border-radius:12px;padding:10px}
.now{font-size:22px;font-weight:800}
.topbtn{position:fixed;left:12px;bottom:80px;z-index:9}
.sharebar{position:fixed;right:12px;bottom:12px;display:flex;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px;z-index:9}
.logo-hero{display:flex;align-items:center;gap:8px}
.logo-dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 0 rgba(255,176,0,0.7);animation:pulse 1.6s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,176,0,0.6)}70%{box-shadow:0 0 0 12px rgba(255,176,0,0)}100%{box-shadow:0 0 0 0 rgba(255,176,0,0)}}
.partner{display:flex;gap:12px;align-items:center}
.partner .glow{padding:10px;border-radius:14px;border:1px solid var(--line);background:var(--pill);box-shadow:var(--glow)}
.partner .name{font-weight:800}
.hero-cta{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.hero-cta .item{padding:12px;border:1px dashed var(--line);border-radius:12px}
.shop-card{padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--pill)}
.shop-card h4{margin:0 0 6px}
.shop-card .note{color:var(--mut);margin:6px 0}
.cmctable{overflow:auto;border:1px solid var(--line);border-radius:12px}
.cmctable table{width:100%;border-collapse:collapse}
.cmctable th, .cmctable td{padding:8px;border-bottom:1px solid var(--line);text-align:left}
.bad{color:var(--bad)}.ok{color:var(--ok)}
/* Globe */
.hero{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;align-items:center}
@media (max-width:900px){.hero{grid-template-columns:1fr}}
.globe{width:100%;aspect-ratio:1;border-radius:50%;position:relative;box-shadow:inset 0 0 30px rgba(0,0,0,.6),0 6px 30px rgba(0,0,0,.25)}
.globe .sphere{position:absolute;inset:0;border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #5bbcff 0%, #2563eb 42%, #0b3a8a 60%, #071a3a 100%)}
.globe .map{position:absolute;inset:0;border-radius:50%;
  background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox=\"0 0 800 400\"><g fill=\"%23a7e5ff\" opacity=\"0.35\"><path d=\"M84 145l18-7 12 5 10 14-5 11-12 4-15-4-10-10z\"/><circle cx=\"500\" cy=\"130\" r=\"50\"/></g></svg>');
  background-size:200% 100%;animation:spin 18s linear infinite;mix-blend-mode:screen;filter:contrast(110%)}
@keyframes spin{from{background-position:0 0}to{background-position:-200% 0}}
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <span class="pill logo-hero"><span class="logo-dot"></span><b>UltraMaster V15</b></span>
    <span class="pill">ENS: <b id="ens">lightunfold.eth</b></span>
    <span class="pill">Heartbeat: <b id="hb">LIVE</b></span>
    <button class="pill" id="openCfg">config</button>
    <button class="pill" id="openData">data</button>
    <span class="pill" id="lang">VI/EN</span>
    <span class="pill" id="theme">üåó Theme</span>
  </div>

  <h1 id="brand">LightUnfold ‚Ä¢ UltraMaster V15</h1>
  <div id="tagline" style="color:#9fb3c8">AI 24/7 ‚Ä¢ 200+ ng√¥n ng·ªØ ‚Ä¢ Web3 t·ª± v·∫≠n h√†nh ‚Ä¢ B·∫•t t·ª≠ IPFS/ENS</div>

  <!-- HERO with Globe + Partners -->
  <section class="card" id="about">
    <div class="hero">
      <div>
        <div id="slogan">Qu√©t ƒëa ngu·ªìn ‚Ä¢ Ch·∫•m ƒëi·ªÉm c∆° h·ªôi ‚Ä¢ Nh·ªãp tim th·ªã tr∆∞·ªùng theo gi√¢y.</div>
        <div id="pulse" class="tag" style="margin-top:8px">C·∫≠p nh·∫≠t: ‚Äî</div>
        <div class="hero-cta" style="margin-top:10px">
          <div class="item"><b id="whyH1">V√¨ sao UltraMaster?</b><br><span id="why1">AI ƒëa ngu·ªìn, x·∫øp h·∫°ng c∆° h·ªôi theo ƒëi·ªÉm ‚Äì l√†m m·ªõi t·ª´ng ph√∫t, t·ª± v·∫≠n h√†nh 24/7.</span></div>
          <div class="item"><b id="whyH2">Gi√° tr·ªã m·ªü kh√≥a</b><br><span id="why2">Alpha feed, heatmap, vesting, t√≠n hi·ªáu chu k·ª≥ ‚Äì s·∫µn s√†ng h√†nh ƒë·ªông.</span></div>
          <div class="item"><b id="whyH3">C√°ch tham gia</b><br><span id="why3">Thanh to√°n on/off-chain ‚Üí nh·∫≠n m√£ ‚Üí m·ªü kh√≥a n·ªôi dung.</span></div>
        </div>
      </div>
      <div>
        <div class="globe"><div class="sphere"></div><div class="map"></div></div>
        <div class="row partner" style="margin-top:12px;justify-content:space-between">
          <div class="glow" style="flex:1">
            <div class="name">Binance</div>
            <div class="muted" id="bn-intro">S√†n s·ªë 1: ph√≠ th·∫•p, thanh kho·∫£n s√¢u, Earn & Futures.</div>
            <a class="btn out" target="_blank" rel="noopener" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" id="bn-btn">ƒêƒÉng k√Ω Binance ‚Üó</a>
          </div>
          <div class="glow" style="flex:1">
            <div class="name">AlgosOne</div>
            <div class="muted" id="ao-intro">AI Trading: thu·∫≠t to√°n, t·ªëi ∆∞u chi·∫øn l∆∞·ª£c, c·∫£nh b√°o real-time.</div>
            <a class="btn out" target="_blank" rel="noopener" href="https://algosone.page.link/MbtR" id="ao-btn">D√πng th·ª≠ AlgosOne ‚Üó</a>
          </div>
        </div>
      </div>
    </div>
    <div id="alertBox" class="alert hidden" style="margin-top:10px"></div>
  </section>

  <!-- DOCS / COURSES ‚Äî moved to 2nd -->
  <section class="card" id="edu">
    <h3 style="margin:0 0 8px">üìö H·ªçc vi·ªán & S√°ch s·ªë</h3>
    <div class="grid" id="ebooks">
      <div class="shop-card">
        <h4>Crypto 101: N·ªÅn t·∫£ng & Qu·∫£n tr·ªã r·ªßi ro</h4>
        <div class="note">V√≠, b·∫£o m·∫≠t, chu k·ª≥, qu·∫£n tr·ªã v·ªën, checklist.</div>
        <div class="row"><button class="btn" onclick="document.getElementById('unlockCode').focus()">Mua & nh·∫≠p m√£</button><span class="badge">$19</span></div>
      </div>
      <div class="shop-card">
        <h4>DeFi Mastery: Yield, Lending, Perp</h4>
        <div class="note">SƒÉn APY, ƒëo risk, perp an to√†n, case study.</div>
        <div class="row"><button class="btn" onclick="document.getElementById('unlockCode').focus()">Mua & nh·∫≠p m√£</button><span class="badge">$29</span></div>
      </div>
    </div>
  </section>

  <!-- PAYMENTS (1 QR chung + danh s√°ch) -->
  <section class="card">
    <h3 id="payTitle" style="margin:0 0 8px">üí≥ Thanh to√°n</h3>
    <div class="grid" id="pays"></div>
    <div class="muted" style="margin-top:6px"><span id="minLbl">T·ªëi thi·ªÉu</span>: <span id="mins"></span> ¬∑ <span id="contactLbl">Li√™n h·ªá</span>: <span id="pp"></span></div>
  </section>

  <!-- UNLOCK -->
  <section class="card">
    <h3 id="lockTitle" style="margin:0 0 8px">üîì N·ªôi dung cao c·∫•p</h3>
    <div id="locked">
      <div class="grid">
        <div>
          <input id="unlockCode" placeholder="Nh·∫≠p m√£ m·ªü kh√≥a‚Ä¶" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)">
          <input id="txhash" style="margin-top:8px;width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)" placeholder="(Tu·ª≥ ch·ªçn) D√°n m√£ giao d·ªãch/b·∫±ng ch·ª©ng">
          <div class="row" style="margin-top:8px">
            <button class="btn" id="doUnlock">M·ªü kh√≥a</button>
            <button class="btn out" id="remember">Nh·ªõ tr√™n thi·∫øt b·ªã</button>
          </div>
          <div id="uMsg" style="margin-top:6px;color:#9fb3c8"></div>
        </div>
        <div style="color:#9fb3c8">
          <b id="howTitle">C√°ch ho·∫°t ƒë·ªông</b>
          <ul id="howList">
            <li>Thanh to√°n on/off-chain.</li>
            <li>Nh·∫≠n m√£ ‚Üí nh·∫≠p ƒë·ªÉ m·ªü kh√≥a n·ªôi dung.</li>
            <li>L∆∞u m√£ & TX hash ngay tr√™n thi·∫øt b·ªã c·ªßa b·∫°n.</li>
          </ul>
        </div>
      </div>
    </div>
    <div id="opened" class="hidden">
      <div class="row"><span class="pill ok" id="unlockedLbl">‚úî ƒê√£ m·ªü kh√≥a</span><button class="btn out" id="relock">Kho√° l·∫°i</button></div>
      <div id="premium" class="grid" style="margin-top:10px"></div>
    </div>
  </section>

  <!-- STORE -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 id="packTitle" style="margin:0">üß∞ G√≥i s·∫£n ph·∫©m / B√°o c√°o</h3>
      <div class="tabbar" id="timeTabs">
        <div class="tab act" data-t="day">Ng√†y</div>
        <div class="tab" data-t="month">Th√°ng</div>
        <div class="tab" data-t="quarter">Qu√Ω</div>
        <div class="tab" data-t="year">NƒÉm</div>
      </div>
    </div>
    <div id="bundles" class="grid"></div>
    <div class="card" style="margin-top:10px">
      <b>H∆∞·ªõng d·∫´n ch·ªçn g√≥i</b>
      <ul class="muted" id="bundleGuide">
        <li><b>Alpha Signals X</b>: ph√π h·ª£p scalping/ng·∫Øn h·∫°n.</li>
        <li><b>ETF & BTC Flow</b>: theo d√µi d√≤ng v·ªën, miner, ETF.</li>
        <li><b>Altseason Radar</b>: sƒÉn leader/laggard theo chu k·ª≥.</li>
      </ul>
    </div>
  </section>

  <!-- AFFILIATES -->
  <section class="card">
    <h3 style="margin:0 0 8px">ü§ù Affiliate ‚Ä¢ Gi·ªõi thi·ªáu chi ti·∫øt</h3>
    <div class="grid" id="affSpot">
      <div class="shop-card">
        <h4>Binance ‚Äî t·∫°i sao n√™n ƒëƒÉng k√Ω?</h4>
        <div class="note">Ph√≠ th·∫•p, thanh kho·∫£n s√¢u ‚Ä¢ Earn/Futures/Options ‚Ä¢ Launchpad/Launchpool ‚Ä¢ B·∫£o m·∫≠t m·∫°nh.</div>
        <a class="btn" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener">ƒêƒÉng k√Ω Binance ‚Üó</a>
      </div>
      <div class="shop-card">
        <h4>AlgosOne ‚Äî l·ª£i √≠ch cho trader</h4>
        <div class="note">AI chi·∫øn l∆∞·ª£c ‚Ä¢ C·∫£nh b√°o theo r·ªßi ro ‚Ä¢ Backtest nhanh ‚Ä¢ K·∫øt n·ªëi nhi·ªÅu s√†n.</div>
        <a class="btn" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener">D√πng th·ª≠ AlgosOne ‚Üó</a>
      </div>
    </div>
    <div id="affs" class="grid" style="margin-top:10px"></div>
  </section>

  <!-- OPPORTUNITIES -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 id="hotTitle" style="margin:0">üî• C∆° h·ªôi n·ªïi b·∫≠t</h3>
      <div class="row">
        <span class="badge" id="scanMode">qu√©t: data</span>
        <button class="btn out" id="refreshNow">‚Üª L√†m m·ªõi</button>
      </div>
    </div>
    <div class="marquee" style="margin:4px 0 8px;color:#bcd"><div id="ticker">‚Äî</div></div>
    <div id="opps" class="list"></div>
  </section>

  <!-- MARKET at bottom -->
  <section class="card">
    <h3 style="margin:0 0 8px">üìä Th·ªã tr∆∞·ªùng (mini)</h3>
    <div class="cmctable" id="mktMini">
      <table>
        <thead><tr><th>Symbol</th><th>Name</th><th>Price</th><th>24h</th><th>Vol 24h</th></tr></thead>
        <tbody id="mktRows"><tr><td colspan="5">‚Äî</td></tr></tbody>
      </table>
    </div>
  </section>

  <!-- COMMANDS -->
  <section class="card">
    <h3 style="margin:0 0 8px">üß≠ Command Center</h3>
    <div id="apps" class="appgrid"></div>
    <div style="color:#9fb3c8;margin-top:6px" id="hubHint">Hub li√™n k·∫øt ƒë·∫øn c√¥ng c·ª• c≈© (dex, hyper_v2, pro, super_auto, super_share, xportal‚Ä¶).</div>
  </section>

  <button class="pill topbtn" id="goTop">‚Üë Top</button>
  <div class="footer">¬© <span id="year"></span> LightUnfold ‚Ä¢ <span id="autoLbl">T·ª± ƒë·ªông 24/7</span></div>
</div>

<!-- Share floating -->
<div class="sharebar" id="sharebar">
  <a id="sh_tg" target="_blank" title="Share Telegram">üì£</a>
  <a id="sh_x"  target="_blank" title="Share X/Twitter">ùïè</a>
  <a id="sh_fb" target="_blank" title="Share Facebook">f</a>
  <a id="sh_in" target="_blank" title="Share LinkedIn">in</a>
</div>

<!-- ========= AI Chat 24/7 (built-in) ========= -->
<style>
  .um15-fab{position:fixed;right:16px;bottom:88px;width:56px;height:56px;border-radius:50%;
    display:flex;align-items:center;justify-content:center;cursor:pointer;background:var(--accent);color:#1a1300;
    box-shadow:0 10px 30px rgba(3,10,30,.35);font-weight:900;z-index:9998}
  .um15-chat{position:fixed;right:16px;bottom:150px;width:min(92vw,420px);height:min(72vh,640px);display:none;
    flex-direction:column;background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;z-index:9999}
  .um15-chat header{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid var(--line)}
  .um15-chat .msgs{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px;background:linear-gradient(180deg,#0b0f13 0%,#0f141a 100%)}
  .um15-bubble{max-width:86%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#0f1826;color:var(--txt)}
  .um15-bubble.me{align-self:flex-end;background:#192233}
  .um15-chat .inputbar{display:flex;gap:8px;padding:10px;border-top:1px solid var(--line)}
  .um15-chat .inputbar input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--pill);color:var(--txt)}
  .um15-btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .um15-btn.out{background:transparent;border:1px solid var(--line);color:var(--txt)}
  .um15-quick{display:flex;gap:6px;flex-wrap:wrap;padding:8px;border-top:1px dashed var(--line)}
  .um15-quick button{border:1px solid var(--line);background:var(--pill);color:var(--txt);border-radius:999px;padding:6px 10px;cursor:pointer}
  .um15-small{font-size:12px;color:#9fb3c8}
</style>
<div class="um15-fab" id="um15Fab" title="AI Chat 24/7">üí¨</div>
<div class="um15-chat" id="um15Box" role="dialog" aria-label="AI Chat 24/7">
  <header>
    <div style="display:flex;gap:8px;align-items:center">
      <b id="um15Title">AI T√†i ch√≠nh 24/7</b>
      <span class="pill" style="padding:2px 8px" id="um15Mode">demo</span>
    </div>
    <div style="display:flex;gap:8px">
      <button class="um15-btn out" id="um15Min">‚Äî</button>
      <button class="um15-btn" id="um15Close">‚úñ</button>
    </div>
  </header>
  <div class="um15-quick" id="um15Quick">
    <button data-q="C·∫≠p nh·∫≠t BTC/ETH/USDT b√¢y gi·ªù">BTC/ETH/USDT</button>
    <button data-q="C√≥ c∆° h·ªôi coin n√†o ƒë√°ng ch√∫ √Ω kh√¥ng?">C∆° h·ªôi h√¥m nay</button>
    <button data-q="G·ª£i √Ω kh√≥a h·ªçc nhanh cho ng∆∞·ªùi m·ªõi">Kh√≥a h·ªçc nhanh</button>
    <button data-q="H∆∞·ªõng d·∫´n giao d·ªãch an to√†n cho ng∆∞·ªùi m·ªõi">An to√†n giao d·ªãch</button>
  </div>
  <div class="msgs" id="um15Msgs"></div>
  <div class="inputbar">
    <input id="um15Ask" placeholder="H·ªèi v·ªÅ th·ªã tr∆∞·ªùng, kh√≥a h·ªçc, BNB, AlgosOne‚Ä¶">
    <button class="um15-btn" id="um15Send">G·ª≠i</button>
  </div>
</div>
<!-- ========= /AI Chat 24/7 ========= -->

<script>
/* ===== helpers & theme ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
function setTheme(m){document.documentElement.classList.toggle('light',m==='light');localStorage.setItem('theme',m)}
setTheme(localStorage.getItem('theme')||'dark'); $('#theme').onclick=()=>setTheme(document.documentElement.classList.contains('light')?'dark':'light');

const fmt=n=>Number(n||0).toLocaleString(undefined,{maximumFractionDigits:8});
const agoSec=(from)=>{const s=((Date.now()-from)/1000)|0;return s+"s";}
const qrlink=t=>`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(t)}`;
async function j(url){try{const r=await fetch(url,{cache:'no-store'});if(!r.ok) throw 0;return await r.json()}catch(_){return null}}

const i18n={
  vi:{hot:"üî• C∆° h·ªôi n·ªïi b·∫≠t",pay:"üí≥ Thanh to√°n",minLbl:"T·ªëi thi·ªÉu",contactLbl:"Li√™n h·ªá",lock:"üîì N·ªôi dung cao c·∫•p",
      how:"C√°ch ho·∫°t ƒë·ªông",unlocked:"‚úî ƒê√£ m·ªü kh√≥a",packs:"üß∞ G√≥i s·∫£n ph·∫©m / B√°o c√°o",hub:"Hub li√™n k·∫øt t·ªõi c√¥ng c·ª• c≈©.",
      cta:"üöÄ B·∫Øt ƒë·∫ßu ngay",cta1H:"T·∫°o l·ª£i th·∫ø th√¥ng tin",cta1:"Theo d√µi bi·∫øn ƒë·ªông l·ªõn & t√≠n hi·ªáu s·ªõm ‚Äì tr∆∞·ªõc ƒë√°m ƒë√¥ng.",
      cta2H:"T·ªëi ∆∞u chi ph√≠",cta2:"G√≥i ng√†y/th√°ng/qu√Ω ‚Äì tr·∫£ cho th·ª© b·∫°n d√πng.",
      cta3H:"Lan t·ªèa t·ª± ƒë·ªông",cta3:"Chia s·∫ª 1 ch·∫°m (Telegram/X/Facebook/LinkedIn) + Affiliate.",
      auto:"T·ª± ƒë·ªông 24/7",
      whyH1:"V√¨ sao UltraMaster?",whyH2:"Gi√° tr·ªã m·ªü kh√≥a",whyH3:"C√°ch tham gia",
      why1:"AI ƒëa ngu·ªìn, x·∫øp h·∫°ng c∆° h·ªôi ‚Äì l√†m m·ªõi t·ª´ng ph√∫t.",
      why2:"Alpha feed, heatmap, vesting, t√≠n hi·ªáu chu k·ª≥.",
      why3:"Thanh to√°n on/off-chain ‚Üí nh·∫≠n m√£ ‚Üí m·ªü kh√≥a premium.",
      refresh:"‚Üª L√†m m·ªõi", theme:"üåó Giao di·ªán", scan_data:"qu√©t: data", scan_fallback:"qu√©t: fallback",
      unlock_ph:"Nh·∫≠p m√£ m·ªü kh√≥a‚Ä¶", tx_ph:"(Tu·ª≥ ch·ªçn) D√°n TX hash / b·∫±ng ch·ª©ng",
      unlock_btn:"M·ªü kh√≥a", remember_btn:"Nh·ªõ tr√™n thi·∫øt b·ªã", relock_btn:"Kho√° l·∫°i",
      buy_enter:"Mua & nh·∫≠p m√£", details:"Chi ti·∫øt", price:"Gi√°", volume:"Kh·ªëi l∆∞·ª£ng", open_data:"Xem d·ªØ li·ªáu"},
  en:{hot:"üî• Hot opportunities",pay:"üí≥ Payments",minLbl:"Minimum",contactLbl:"Contact",lock:"üîì Premium content",
      how:"How it works",unlocked:"‚úî Unlocked",packs:"üß∞ Products / Reports",hub:"Hub links to legacy tools.",
      cta:"üöÄ Get started now",cta1H:"Information edge",cta1:"Track outsized moves & early signals ‚Äî ahead of the crowd.",
      cta2H:"Cost-efficient",cta2:"Day/Month/Quarter plans ‚Äî pay only for what you use.",
      cta3H:"Auto-viral growth",cta3:"One-tap share (Telegram/X/Facebook/LinkedIn) + Affiliate.",
      auto:"Always-on 24/7",
      whyH1:"Why UltraMaster?",whyH2:"Unlock value",whyH3:"How to join",
      why1:"Multi-source AI scanning, scored opportunities ‚Äî refreshed every minute.",
      why2:"Alpha feeds, heatmaps, vesting calendars, cycle signals.",
      why3:"Pay on/off-chain ‚Üí receive code ‚Üí unlock premium.",
      refresh:"‚Üª Refresh", theme:"üåó Theme", scan_data:"scan: data", scan_fallback:"scan: fallback",
      unlock_ph:"Enter unlock code‚Ä¶", tx_ph:"(Optional) Paste TX hash / proof",
      unlock_btn:"Unlock", remember_btn:"Remember on device", relock_btn:"Lock again",
      buy_enter:"Buy & enter code", details:"Details", price:"Price", volume:"Volume", open_data:"Open data"}
};
let LANG=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';
$('#lang').onclick=()=>{LANG=LANG==='vi'?'en':'vi';localStorage.setItem('lang',LANG);applyLang();};

/* ===== defaults (fallback) & V15 config ===== */
const DEF={
  site:{brand:"LightUnfold ‚Ä¢ UltraMaster V15",ens:"lightunfold.eth",
    contact:{email:"vumumabada@gmail.com"},
    payments:{qr_auto:true,chains:[
      {name:"ETH (EVM)",address:"0x54E15A7b6d4213beE87800432A151d794638E3C2",explorer:"https://etherscan.io/address/0x54E15A7b6d4213beE87800432A151d794638E3C2",min:0.0005},
      {name:"USDT (ERC20)",address:"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",explorer:"https://etherscan.io/token/USDT?a=0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",min:5}
    ],offchain:{momo:"0567892030",vietcombank:"9567892030",paypal:"vumumabada@gmail.com"}},
    affiliates:[
      {name:"Binance",url:"https://www.binance.com/vi/register?ref=GRO_20338_9V44N",tag:"Top CEX"},
      {name:"AlgosOne",url:"https://algosone.page.link/MbtR",tag:"AI Trading"}
    ]},
  feeds:{top_n:12}, schedule:{refresh_minutes:10},
  secrets:{unlock_code:"23061988"},
  store:{bundles:[
    {title:"Alpha Signals X",price:99,desc:"T√≠n hi·ªáu ng·∫Øn h·∫°n x√°c su·∫•t cao.",tags:["Scalping","DeFi","Spot"]},
    {title:"ETF & BTC Flow",price:79,desc:"D√≤ng v·ªën ETF/BTC ‚Äì qu·ªπ & miner.",tags:["BTC","ETF","Flow"]},
    {title:"Altseason Radar",price:69,desc:"Chu k·ª≥ v·ªën h√≥a & leader/laggard.",tags:["Cycle","Momentum"]},
    {title:"Whale Watcher Pro",price:89,desc:"Theo d√µi v√≠ c√° voi & giao d·ªãch l·ªõn.",tags:["Onchain","Whales"]},
    {title:"Airdrop Hunter",price:59,desc:"L·ªãch farming & ƒëi·ªÉm t√≠ch l≈©y.",tags:["Quest","Points"]}
  ],
  premium:[
    {title:"Alpha Feed Pro",desc:"D√≤ng tin alpha si√™u nhanh (ƒë·ªô tr·ªÖ ms).",bullets:["B·∫•t th∆∞·ªùng d√≤ng ti·ªÅn","Ngu·ªìn ƒëa k√™nh","B·ªô l·ªçc nhi·ªÖu"],link:"data/latest.json"},
    {title:"Deal Flow Private",desc:"T·ªïng h·ª£p deal/seed ƒëang m·ªü private.",bullets:["ƒêi·ªÅu ki·ªán","∆Øu ti√™n th·ªùi gian"]}
  ]}};

let CFG=DEF, lastRefreshTS=Date.now();

/* ===== External overlays (t√πy ch·ªçn) ===== */
const V15_ON=true;
const V15_PATHS={
  lang_vi:'lang/vi.v15.json',
  lang_en:'lang/en.v15.json',
  site:'site.v15.json',
  ui:'ui.v15.json',
  feeds:'feeds.v15.json',
  secrets:'secrets.v15.json'
};
async function getNoCache(p){try{const r=await fetch(p,{cache:'no-store'});if(!r.ok) throw 0;return await r.json()}catch(_){return null}}
function mergeDeep(base, patch){return (typeof base==='object'&&base&&typeof patch==='object'&&patch)?Object.assign({},base, ...Object.keys(patch).map(k=>({[k]:mergeDeep(base[k],patch[k])}))) : (patch??base)}
async function loadV15All(){
  if(!V15_ON) return;
  const [vi,en,site,ui,feeds,sec]=await Promise.all([
    getNoCache(V15_PATHS.lang_vi),getNoCache(V15_PATHS.lang_en),
    getNoCache(V15_PATHS.site),getNoCache(V15_PATHS.ui),
    getNoCache(V15_PATHS.feeds),getNoCache(V15_PATHS.secrets)
  ]);
  if(vi||en){ if(LANG==='vi'&&vi) window.i18n.vi = mergeDeep(window.i18n?.vi||{},vi);
              if(LANG==='en'&&en) window.i18n.en = mergeDeep(window.i18n?.en||{},en); }
  CFG = mergeDeep(CFG, mergeDeep(site||{}, mergeDeep(ui||{}, mergeDeep(feeds||{}, sec||{}))));
}

/* ===== Boot ===== */
(async function boot(){
  $('#year').textContent=new Date().getFullYear();

  bindModal('#openCfg','config.json','config.json');
  bindModal('#openData','data/latest.json','data/latest.json');

  // optional legacy config.json
  const cfg=await j('config.json'); if(cfg) CFG=mergeDeep(CFG,cfg);

  await loadV15All();

  // Header + contact
  $('#brand').textContent=CFG.site?.brand||'LightUnfold ‚Ä¢ UltraMaster V15';
  $('#ens').textContent=CFG.site?.ens||'‚Äî';
  const contact=(CFG.site?.contact?.email||CFG.site?.contact||CFG.site?.ens||'').toString();
  const pp=$('#pp'); if(pp) pp.innerHTML = contact?`<a href="mailto:${contact}" target="_blank" rel="noopener">${contact}</a>`:'‚Äî';

  // Share links
  const u=encodeURIComponent(location.href), t=encodeURIComponent(document.title);
  $('#sh_tg').href=`https://t.me/share/url?url=${u}`;
  $('#sh_x').href =`https://twitter.com/intent/tweet?text=${t}&url=${u}`;
  $('#sh_fb').href=`https://www.facebook.com/sharer/sharer.php?u=${u}`;
  $('#sh_in').href=`https://www.linkedin.com/sharing/share-offsite/?url=${u}`;

  // Buttons
  $('#refreshNow').onclick=loadDataSmart;
  $('#goTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

  // Render
  renderPays(); renderAffs(); renderBundles('day'); paintPremium(); bindPaywall();
  $('#timeTabs').onclick=e=>{const t=e.target.closest('.tab'); if(!t) return; $$('#timeTabs .tab').forEach(x=>x.classList.remove('act')); t.classList.add('act'); renderBundles(t.dataset.t)};

  // Apps
  const names=["dex.html","hyper_v2.html","pro.html","super_auto.html","super_share.html","xpeotl.html","xportal.html"];
  $('#apps').innerHTML=names.map(n=>`<a href="${n}" target="_blank" rel="noopener">${n.replace('.html','').replaceAll('_',' ').toUpperCase()}</a>`).join('');

  // Data loop
  await loadDataSmart();
  const every=Math.max(3, Number(CFG.schedule?.refresh_minutes||10));
  setInterval(loadDataSmart,every*60*1000);

  // Live pulse + KPI client-only
  setInterval(()=>$('#pulse').textContent=(LANG==='vi'?'C·∫≠p nh·∫≠t: ':'Updated: ')+agoSec(lastRefreshTS),1000);
  setInterval(liveCounter,4000); liveCounter();
  setInterval(revBoot,7000); revBoot();

  applyLang();
  try{registerSW()}catch(_){}

  // AI Chat init
  initAIChat();

})();

/* ===== Modal helper ===== */
function bindModal(btnSel,url,title){
  const btn=$(btnSel); if(!btn) return;
  const modal = document.createElement('div'); modal.className='modal'; modal.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:9999';
  modal.innerHTML = `<div class="box" style="width:min(92vw,900px);height:min(80vh,700px);background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;display:flex;flex-direction:column">
    <header style="display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)">
      <b>${title}</b>
      <div class="row">
        <a class="btn out" href="${url}" target="_blank" rel="noopener">M·ªü tab m·ªõi ‚Üó</a>
        <button class="btn" id="__close">ƒê√≥ng</button>
      </div>
    </header>
    <iframe src="${url}" style="border:0;flex:1;background:#0a0f14"></iframe>
  </div>`;
  document.body.appendChild(modal);
  btn.onclick=()=>{modal.style.display='flex';};
  modal.addEventListener('click',e=>{if(e.target.id==='__close'||e.target===modal) modal.style.display='none';});
}

/* ===== Payments: 1 QR chung + danh s√°ch ===== */
function renderPays(){
  const P=CFG.site?.payments||{}; const chains=P.chains||[]; const off=P.offchain||{};
  const first=chains[0]; // d√πng 1 QR ƒë·∫°i di·ªán (m·∫∑c ƒë·ªãnh ETH)
  const mins=(()=>{const m={}; chains.forEach(c=>{if(/ETH/i.test(c.name)) m.ETH=c.min||0.0005; if(/USDT/i.test(c.name)) m.USDT=c.min||5}); return m})();
  $('#mins').textContent=["ETH ‚â• "+(mins.ETH||0.0005),"USDT ‚â• "+(mins.USDT||5)].join(", ");

  const items=[];
  // Kh·ªëi QR ƒë·∫°i di·ªán
  if(first){
    items.push(`<div class="card"><div class="pay">
      <img alt="QR" src="${qrlink(first.address)}" loading="lazy" title="Qu√©t ƒë·ªÉ thanh to√°n nhanh">
      <div class="meta">
        <div class="row" style="justify-content:space-between"><b>QR chung (∆∞u ti√™n: ${first.name})</b>
          <a class="btn out" target="_blank" rel="noopener" href="https://metamask.app.link/">${LANG==='vi'?'M·ªü v√≠/·ª©ng d·ª•ng':'Open wallet/app'} ‚Üó</a></div>
        <div class="mono"><a href="${first.explorer||'#'}" target="_blank" rel="noopener">${first.address}</a></div>
        <div class="muted">${LANG==='vi'?'Qu√©t QR n√†y ƒë·ªÉ thanh to√°n nhanh. C√≥ th·ªÉ ch·ªçn ph∆∞∆°ng th·ª©c kh√°c ·ªü danh s√°ch b√™n d∆∞·ªõi.':'Scan this QR to pay fast. Other methods listed below.'}</div>
        <div class="row" style="margin-top:8px">
          <button class="btn" onclick="navigator.clipboard.writeText('${first.address}')">${LANG==='vi'?'Sao ch√©p ƒë·ªãa ch·ªâ':'Copy address'}</button>
          <a class="btn out" href="${qrlink(first.address)}" download>‚ö° ${LANG==='vi'?'T·∫£i QR':'Download QR'}</a>
        </div>
      </div></div></div>`);
  }
  // Danh s√°ch chi ti·∫øt
  const detail = [];
  chains.forEach(c=>{
    detail.push(`<div class="shop-card">
      <h4>${c.name}</h4>
      <div class="mono">${c.address}</div>
      ${c.explorer?`<div class="muted">Explorer: <a target="_blank" rel="noopener" href="${c.explorer}">On-chain ‚Üó</a></div>`:""}
      ${c.min?`<div class="muted">${LANG==='vi'?'T·ªëi thi·ªÉu':'Minimum'}: ${c.min}</div>`:""}
      <div class="row" style="margin-top:8px">
        <button class="btn" onclick="navigator.clipboard.writeText('${c.address}')">${LANG==='vi'?'Sao ch√©p':'Copy'}</button>
      </div>
    </div>`);
  });
  if(off.momo) detail.push(simplePay("MoMo",off.momo,LANG==='vi'?"V√≠ MoMo Vi·ªát Nam.":"Vietnam MoMo wallet."));
  if(off.vietcombank) detail.push(simplePay("Vietcombank",off.vietcombank,LANG==='vi'?"Chuy·ªÉn kho·∫£n VCB.":"VCB bank transfer."));
  if(off.paypal) detail.push(simplePay("PayPal",off.paypal,`${LANG==='vi'?'Thanh to√°n PayPal.':'Pay via PayPal.'}`));

  items.push(`<div class="grid">${detail.join("")}</div>`);
  $('#pays').innerHTML=items.join("");

  function simplePay(label,addr,hint){return `<div class="shop-card">
    <h4>${label}</h4><div class="muted">${hint||""}</div><div class="mono">${addr}</div>
    <div class="row" style="margin-top:8px"><button class="btn" onclick="navigator.clipboard.writeText('${addr}')">${LANG==='vi'?'Sao ch√©p':'Copy'}</button></div>
  </div>`}
}

/* ===== Affiliates ===== */
function renderAffs(){
  const A=CFG.site?.affiliates||[];
  $('#affs').innerHTML=A.map(a=>`<div class="shop-card">
    <h4>${a.name}</h4>
    <div class="note">∆Øu ƒë√£i ƒë·ªëi t√°c: ${a.tag||'Partner'}.</div>
    <div class="row"><a class="btn" href="${a.url}" target="_blank" rel="noopener">${LANG==='vi'?'ƒêƒÉng k√Ω/Truy c·∫≠p':'Join/Visit'} ‚Üó</a>
    <button class="btn out" onclick="navigator.clipboard.writeText('${a.url}')">${LANG==='vi'?'Sao ch√©p link':'Copy link'}</button></div>
  </div>`).join('');
}

/* ===== Market data (opps + mini table) ===== */
let LAST_ITEMS=[];
async function loadDataSmart(){
  const latest=await j('data/latest.json'); lastRefreshTS=Date.now();
  if(latest && Array.isArray(latest.items)){ $('#scanMode').textContent=i18n[LANG].scan_data; renderOpps(latest.items); renderMini(latest.items); return; }
  const items=await scanLive(); $('#scanMode').textContent=i18n[LANG].scan_fallback; renderOpps(items); renderMini(items);
}
async function scanLive(){
  const items=[];
  try{
    const cg=await j('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=40&page=1&price_change_percentage=1h,24h,7d');
    if(Array.isArray(cg)) for(const c of cg){
      items.push({source:"coingecko",symbol:(c.symbol||"").toUpperCase(),name:c.name,
        price:+c.current_price||0,ch24h:+c.price_change_percentage_24h_in_currency||0,vol24h:+c.total_volume||0,
        score:(+c.price_change_percentage_1h_in_currency||0)*0.4+(+c.price_change_percentage_24h_in_currency||0)*0.35+(+c.price_change_percentage_7d_in_currency||0)*0.25+Math.log10((+c.total_volume||1)),
        link:`https://www.coingecko.com/en/coins/${c.id}`});
    }
  }catch(_){}
  try{
    const cl=await j('https://api.coinlore.net/api/tickers/?start=0&limit=40');
    const data=cl?.data||[];
    for(const c of data){
      items.push({source:"coinlore",symbol:(c.symbol||"").toUpperCase(),name:c.name,
        price:+c.price_usd||0,ch24h:+c.percent_change_24h||0,vol24h:+c.volume24||0,
        score:(+c.percent_change_24h||0)*0.7+Math.log10((+c.volume24||1)),
        link:`https://www.coinlore.com/coin/${(c.name||"").toLowerCase().replace(/\s+/g,"-")}`});
    }
  }catch(_){}
  const best={}; for(const it of items){if(!it.symbol) continue; const k=it.symbol; if(!best[k]||it.score>best[k].score) best[k]=it;}
  return Object.values(best).sort((a,b)=>b.score-a.score).slice(0, CFG.feeds?.top_n||12);
}
function renderOpps(items){
  LAST_ITEMS=items||[];
  $('#ticker').innerHTML=(LAST_ITEMS||[]).map(x=>`<span class="tag">${x.symbol}: $${fmt(x.price)} (${(x.ch24h||0).toFixed(2)}%)</span>`).join('')||'‚Äî';
  const maxAbs = LAST_ITEMS?.length ? Math.max(...LAST_ITEMS.map(x=>Math.abs(x.ch24h||0))) : 0;
  const alertBox=$('#alertBox'); if(maxAbs>=12){alertBox.classList.remove('hidden'); alertBox.innerHTML=`‚ö†Ô∏è <b>Alert:</b> ${LANG==='vi'?'Bi·∫øn ƒë·ªông l·ªõn':'Large move'} (${maxAbs.toFixed(2)}%) ‚Äî ${LANG==='vi'?'ki·ªÉm tra c∆° h·ªôi b√™n d∆∞·ªõi.':'check opportunities below.'}`;} else {alertBox.classList.add('hidden'); alertBox.textContent='';}
  const L=i18n[LANG];
  $('#opps').innerHTML=(LAST_ITEMS||[]).map(x=>{
    const ch=x.ch24h||0, pct=`${ch>=0?'+':''}${ch.toFixed(2)}%`;
    return `<div class="item">
      <div class="score">+${(x.score||0).toFixed(2)}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div><b>${x.symbol}</b> ¬∑ <span class="muted">${x.name||''}</span></div>
          <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${L.details} ‚Üó</a>
        </div>
        <div class="row" style="gap:8px">
          <span class="tag">${L.price}: $${fmt(x.price||0)}</span>
          <span class="tag ${ch>=0?'ok':'bad'}">24h: ${pct}</span>
          <span class="tag">${L.volume}: $${fmt(x.vol24h||0)}</span>
          <span class="tag">Src: ${x.source}</span>
        </div>
      </div>
    </div>`;
  }).join('')||'<div class="muted">‚Äî</div>';
}
function renderMini(items){
  const rows=(items||[]).slice(0,10).map(x=>{
    const p=fmt(x.price||0), ch=(x.ch24h||0).toFixed(2);
    return `<tr><td>${x.symbol}</td><td>${x.name||''}</td><td>$${p}</td><td class="${x.ch24h>=0?'ok':'bad'}">${ch}%</td><td>$${fmt(x.vol24h||0)}</td></tr>`;
  }).join('');
  $('#mktRows').innerHTML=rows||'<tr><td colspan="5">‚Äî</td></tr>';
}

/* ===== Bundles ===== */
function renderBundles(mode='day'){
  const B=CFG.store?.bundles||[];
  const L=i18n[LANG];
  $('#bundles').innerHTML=B.map(b=>{
    const tags=(b.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
    return `<div class="shop-card">
      <h4>${b.title}</h4>
      <div class="note">${b.desc||''}</div>
      <div style="margin-top:6px">${tags}</div>
      <div class="note">${LANG==='vi'?'C√°ch nh·∫≠n gi√° tr·ªã:':'How to get value:'} ${LANG==='vi'?'Thanh to√°n ‚Üí nh·∫≠n m√£ ‚Üí m·ªü kh√≥a':'Pay ‚Üí get code ‚Üí unlock'}</div>
      <div class="row" style="margin-top:8px"><button class="btn" onclick="document.getElementById('unlockCode').focus()">${L.buy_enter}</button><span class="badge">${mode}</span><span class="badge">$${b.price}</span></div>
    </div>`;
  }).join('');
}

/* ===== Premium + Paywall ===== */
function paintPremium(){
  const P=CFG.store?.premium||[];
  const L=i18n[LANG];
  $('#premium').innerHTML=P.map(p=>`<div class="shop-card"><h4>${p.title}</h4>
    <div class="note">${p.desc||''}</div>
    ${p.bullets?`<ul>${p.bullets.map(x=>`<li>${x}</li>`).join('')}</ul>`:""}
    ${p.link?`<a class="btn out" target="_blank" rel="noopener" href="${p.link}">${L.open_data} ‚Üó</a>`:""}
  </div>`).join('');
}
function bindPaywall(){
  const SECRET=String(CFG.secrets?.unlock_code||'23061988');
  const saved=localStorage.getItem('unlocked_code')||'';
  function gate(open){$('#locked').classList.toggle('hidden',open);$('#opened').classList.toggle('hidden',!open);}
  if(saved===SECRET){gate(true); paintPremium(); const th=localStorage.getItem('tx_hash'); if(th) $('#uMsg').innerHTML='<span class="ok">TX: '+th+'</span>';}
  $('#doUnlock').onclick=()=>{const code=$('#unlockCode').value.trim(),tx=$('#txhash').value.trim();
    if(code===SECRET){gate(true); paintPremium(); $('#uMsg').innerHTML='<span class="ok">'+(LANG==='vi'?'ƒê√£ m·ªü kh√≥a!':'Unlocked!')+'</span>'; if(tx) localStorage.setItem('tx_hash',tx); localStorage.setItem('unlocked_code',code);}
    else $('#uMsg').innerHTML='<span class="err">'+(LANG==='vi'?'M√£ kh√¥ng ƒë√∫ng.':'Invalid code.')+'</span>';};
  $('#remember').onclick=()=>{const c=$('#unlockCode').value.trim(); if(c){localStorage.setItem('unlocked_code',c); $('#uMsg').textContent=LANG==='vi'?'ƒê√£ l∆∞u tr√™n thi·∫øt b·ªã.':'Saved on device.'}};
  $('#relock').onclick=()=>{localStorage.removeItem('unlocked_code'); gate(false);};
}

/* ===== i18n apply ===== */
function applyLang(){
  const L=i18n[LANG];
  $('#hotTitle').textContent=L.hot; $('#payTitle').textContent=L.pay; $('#minLbl').textContent=L.minLbl;
  $('#contactLbl').textContent=L.contactLbl; $('#lockTitle').textContent=L.lock; $('#howTitle').textContent=L.how;
  $('#unlockedLbl').textContent=L.unlocked; $('#packTitle').textContent=L.packs; $('#hubHint').textContent=L.hub;
  $('#autoLbl').textContent=L.auto; $('#whyH1').textContent=L.whyH1; $('#whyH2').textContent=L.whyH2; $('#whyH3').textContent=L.whyH3;
  $('#why1').textContent=L.why1; $('#why2').textContent=L.why2; $('#why3').textContent=L.why3;
  const uc=$('#unlockCode'), tx=$('#txhash'); if(uc) uc.placeholder=L.unlock_ph; if(tx) tx.placeholder=L.tx_ph;
  const rn=$('#refreshNow'); if(rn) rn.textContent=L.refresh;
  const scan=$('#scanMode'); if(scan){const fb=/fallback|scan/i.test(scan.textContent); scan.textContent=fb?L.scan_fallback:L.scan_data;}
  try{ renderPays(); renderBundles(document.querySelector('#timeTabs .tab.act')?.dataset.t||'day'); paintPremium(); if(LAST_ITEMS.length) renderOpps(LAST_ITEMS);}catch(_){}
}

/* ===== Mini PWA & vanity KPI ===== */
function registerSW(){
  const sw=`
    const CORE=['./','index.html','config.json','data/latest.json'];
    self.addEventListener('install',e=>{e.waitUntil(caches.open('umv15-core').then(c=>c.addAll(CORE)).then(()=>self.skipWaiting()))});
    self.addEventListener('activate',e=>{e.waitUntil(self.clients.claim())});
    self.addEventListener('fetch',e=>{
      const u=new URL(e.request.url);
      if(u.origin===location.origin){e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));return;}
      e.respondWith(fetch(e.request).catch(()=>caches.match('./')));
    });
  `;
  const url=URL.createObjectURL(new Blob([sw],{type:'text/javascript'}));
  navigator.serviceWorker.register(url,{scope:'./'});
}
function liveCounter(){
  const k='umv15_peers'; const now=Date.now(), ttl=25*1000;
  const id=localStorage.getItem('peer_id')||Math.random().toString(36).slice(2);
  localStorage.setItem('peer_id',id);
  const raw=localStorage.getItem(k); let list=raw?JSON.parse(raw):[];
  list=list.filter(x=>now-x.t<ttl); const me=list.find(x=>x.id===id);
  if(me) me.t=now; else list.push({id,t:now});
  localStorage.setItem(k,JSON.stringify(list));
  // KPI hi·ªÉn th·ªã t∆∞·ª£ng tr∆∞ng
  const kLive=$('#kLive'); if(kLive) kLive.textContent=list.length;
}
function revBoot(){
  const k='umv15_rev'; let val=Number(localStorage.getItem(k)||0);
  val += (Math.random()*0.5+0.2);
  localStorage.setItem(k,val);
  const el=$('#kRev'); if(el) el.textContent = fmt(val);
}

/* ====== AI Chat 24/7 (rule-based + price fetch) ====== */
function initAIChat(){
  const L = ( (localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi') ? 'vi' : 'en' );
  const T={
    vi:{title:'AI T√†i ch√≠nh 24/7', hello:'Xin ch√†o! T√¥i l√† AI t√†i ch√≠nh 24/7. T√¥i c√≥ th·ªÉ c·∫≠p nh·∫≠t BTC/ETH/USDT, g·ª£i √Ω c∆° h·ªôi, kh√≥a h·ªçc v√† h∆∞·ªõng d·∫´n an to√†n.',
        typing:'ƒëang nh·∫≠p‚Ä¶', askph:'H·ªèi v·ªÅ th·ªã tr∆∞·ªùng, kh√≥a h·ªçc, BNB, AlgosOne‚Ä¶',
        open:'M·ªü', join:'ƒêƒÉng k√Ω', learn:'Xem kh√≥a h·ªçc', more:'Xem th√™m',
        fallback:'B·∫°n c√≥ th·ªÉ h·ªèi: ‚ÄúBTC/ETH/USDT b√¢y gi·ªù?‚Äù, ‚ÄúC∆° h·ªôi h√¥m nay?‚Äù, ‚ÄúKh√≥a h·ªçc nhanh?‚Äù, ‚ÄúAn to√†n giao d·ªãch?‚Äù'},
    en:{title:'24/7 Finance AI', hello:'Hi! I can update BTC/ETH/USDT, suggest opportunities, courses and safe trading tips.',
        typing:'typing‚Ä¶', askph:'Ask about market, courses, BNB, AlgosOne‚Ä¶',
        open:'Open', join:'Join', learn:'See course', more:'More',
        fallback:'You can ask: ‚ÄúBTC/ETH/USDT now?‚Äù, ‚ÄúToday‚Äôs opportunities?‚Äù, ‚ÄúQuick course?‚Äù, ‚ÄúSafe trading?‚Äù'}
  }[L];

  const box=$('#um15Box'), fab=$('#um15Fab'), msgs=$('#um15Msgs');
  const sendBtn=$('#um15Send'), ask=$('#um15Ask');
  $('#um15Title').textContent=T.title; ask.placeholder=T.askph;

  fab.onclick=()=>{box.style.display='flex'; if(!msgs.dataset.boot){botSay(T.hello); msgs.dataset.boot=1;}};
  $('#um15Close').onclick=()=>box.style.display='none';
  $('#um15Min').onclick=()=>box.style.height = (box.style.height==='54px'?'min(72vh,640px)':'54px');
  $('#um15Quick').addEventListener('click',e=>{
    const b=e.target.closest('button'); if(!b) return; ask.value=b.dataset.q||''; send();
  });
  sendBtn.onclick=send; ask.onkeydown=e=>{if(e.key==='Enter'){send();}};

  function userSay(t){const b=document.createElement('div'); b.className='um15-bubble me'; b.textContent=t; msgs.appendChild(b); scroll();}
  function botSay(t){const b=document.createElement('div'); b.className='um15-bubble'; b.innerHTML=t; msgs.appendChild(b); scroll();}
  function typing(on){if(on){botSay('<span class="um15-small">'+T.typing+'</span>'); msgs.dataset.typing='1'; scroll();}
                     else{ if(msgs.dataset.typing){msgs.removeChild(msgs.lastElementChild); delete msgs.dataset.typing;} }}
  function scroll(){msgs.scrollTop=msgs.scrollHeight;}

  async function send(){
    const q=ask.value.trim(); if(!q) return; userSay(q); ask.value=''; typing(true);
    try{ const ans = await route(q); typing(false); botSay(ans); }
    catch(_){ typing(false); botSay(L==='vi'?'Xin l·ªói, c√≥ l·ªói x·∫£y ra.':'Sorry, something went wrong.'); }
  }

  async function route(q){
    const s=q.toLowerCase();
    if(/btc|eth|usdt/.test(s)) return await pricePanel();
    if(/c∆° h·ªôi|opportunity|coin n√†o|token n√†o/.test(s)) return await oppsPanel();
    if(/kh√≥a h·ªçc|khoa hoc|course|h·ªçc nhanh|hoc nhanh/.test(s)) return coursePanel();
    if(/an to√†n|safe|qu·∫£n tr·ªã r·ªßi ro|risk/.test(s)) return safetyPanel();
    if(/binance|bnb/.test(s)) return binancePanel();
    if(/algosone|algo/i.test(s)) return algosonePanel();
    return (L==='vi'
      ? `${T.fallback}<br>ƒêƒÉng k√Ω <a target="_blank" rel="noopener" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N">Binance</a> ¬∑ <a target="_blank" rel="noopener" href="https://algosone.page.link/MbtR">AlgosOne</a>.`
      : `${T.fallback}<br>Join <a target="_blank" rel="noopener" href="https://www.binance.com/en/register?ref=GRO_20338_9V44N">Binance</a> ¬∑ <a target="_blank" rel="noopener" href="https://algosone.page.link/MbtR">AlgosOne</a>.`);
  }

  async function pricePanel(){
    let data=null;
    try{
      const ids='bitcoin,ethereum,tether';
      const r=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&include_24hr_change=true`,{cache:'no-store'});
      if(r.ok) data=await r.json();
    }catch(_){}
    if(!data) return (L==='vi'?'T·∫°m th·ªùi kh√¥ng l·∫•y ƒë∆∞·ª£c gi√°. Th·ª≠ l·∫°i sau nh√©.':'Unable to fetch prices now. Please try again.');
    const row = (sym,name,obj) => {
      const p=obj?.usd??0, ch=Number(obj?.usd_24h_change||0);
      const arrow = ch>=0?'‚ñ≤':'‚ñº';
      const c = ch>=0?'#22c55e':'#ff4d4f';
      return `<div style="display:flex;justify-content:space-between;gap:8px;margin:4px 0">
        <b>${sym}</b> <span class="um15-small" style="flex:1">${name}</span>
        <span>$${p.toLocaleString(undefined,{maximumFractionDigits:8})}</span>
        <span style="color:${c}">${arrow} ${ch.toFixed(2)}%</span>
      </div>`;
    };
    return `<div><b>${L==='vi'?'Gi√° hi·ªán t·∫°i (USD)':'Live prices (USD)'}:</b>
      <div style="margin-top:6px">${row('BTC','Bitcoin',data.bitcoin)}
      ${row('ETH','Ethereum',data.ethereum)}
      ${row('USDT','Tether',data.tether)}</div>
      <div class="um15-small">${L==='vi'?'Ngu·ªìn: CoinGecko':'Source: CoinGecko'}</div></div>`;
  }

  async function oppsPanel(){
    try{
      const list = Array.from(document.querySelectorAll('#opps .item')).slice(0,5).map(el=>{
        const s=el.querySelector('b')?.textContent||''; const name=el.querySelector('.muted')?.textContent||'';
        const tags=Array.from(el.querySelectorAll('.tag')).map(t=>t.textContent).join(' ¬∑ ');
        return `‚Ä¢ <b>${s}</b> <span class="um15-small">${name}</span> ‚Äî ${tags}`;
      });
      if(list.length){
        return `<div><b>${L==='vi'?'C∆° h·ªôi ƒë√°ng ch√∫ √Ω':'Notable opportunities'}</b><br>${list.join('<br>')}
        <div class="um15-small" style="margin-top:6px">${L==='vi'?'M·∫πo: b·∫•m ‚Äú‚Üª L√†m m·ªõi‚Äù tr√™n trang ƒë·ªÉ c·∫≠p nh·∫≠t.':'Tip: press ‚Äú‚Üª Refresh‚Äù on page to update.'}</div></div>`;
      }
    }catch(_){}
    return (L==='vi'?'Hi·ªán ch∆∞a c√≥ d·ªØ li·ªáu c∆° h·ªôi. H√£y b·∫•m ‚Äú‚Üª L√†m m·ªõi‚Äù ho·∫∑c h·ªèi l·∫°i sau.'
                   :'No opportunity data yet. Click ‚Äú‚Üª Refresh‚Äù or ask again later.');
  }

  function coursePanel(){
    return (L==='vi'
      ? `<div><b>L·ªô tr√¨nh h·ªçc nhanh</b>
         <ul style="margin:6px 0 0 16px">
           <li><b>Crypto 101</b> ‚Äî v√≠ & b·∫£o m·∫≠t, chu k·ª≥, qu·∫£n tr·ªã r·ªßi ro. <span class="um15-small">$19</span></li>
           <li><b>DeFi Mastery</b> ‚Äî Yield/Lending/Perp. <span class="um15-small">$29</span></li>
         </ul>
         <div style="margin-top:8px"><button class="um15-btn" onclick="document.getElementById('unlockCode').focus()">${'Mua & nh·∫≠p m√£'}</button></div></div>`
      : `<div><b>Fast learning path</b>
         <ul style="margin:6px 0 0 16px">
           <li><b>Crypto 101</b> ‚Äî wallet & security, cycles, risk. <span class="um15-small">$19</span></li>
           <li><b>DeFi Mastery</b> ‚Äî Yield/Lending/Perp. <span class="um15-small">$29</span></li>
         </ul>
         <div style="margin-top:8px"><button class="um15-btn" onclick="document.getElementById('unlockCode').focus()">${'Buy & enter code'}</button></div></div>`);
  }
  function safetyPanel(){
    return (L==='vi'
      ? `<div><b>Nguy√™n t·∫Øc an to√†n</b>
         <ol style="margin:6px 0 0 18px">
           <li>Kh√¥ng all-in; chia nh·ªè v·ªã th·∫ø.</li>
           <li>Lu√¥n ƒë·∫∑t stoploss; t·ªâ l·ªá R:R ‚â• 1:2.</li>
           <li>∆Øu ti√™n s√†n uy t√≠n; 2FA & ch·ªëng phishing.</li>
           <li>Ghi ch√©p nh·∫≠t k√Ω giao d·ªãch.</li>
         </ol></div>`
      : `<div><b>Safety principles</b>
         <ol style="margin:6px 0 0 18px">
           <li>No all-in; scale in/out.</li>
           <li>Always use stoploss; R:R ‚â• 1:2.</li>
           <li>Reputable exchanges; 2FA & anti-phishing.</li>
           <li>Keep a trading journal.</li>
         </ol></div>`);
  }
  function binancePanel(){
    return (L==='vi'
      ? `<div><b>Binance ‚Äî s√†n s·ªë 1</b><br>Ph√≠ th·∫•p, thanh kho·∫£n s√¢u, Earn/Futures/Options, Launchpad/Launchpool.<br>
         <a class="um15-btn" target="_blank" rel="noopener" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N">ƒêƒÉng k√Ω Binance ‚Üó</a></div>`
      : `<div><b>Binance ‚Äî #1 exchange</b><br>Low fees, deep liquidity, Earn/Futures/Options, Launchpad/Launchpool.<br>
         <a class="um15-btn" target="_blank" rel="noopener" href="https://www.binance.com/en/register?ref=GRO_20338_9V44N">Join Binance ‚Üó</a></div>`);
  }
  function algosonePanel(){
    return (L==='vi'
      ? `<div><b>AlgosOne ‚Äî AI giao d·ªãch</b><br>T·ªëi ∆∞u chi·∫øn l∆∞·ª£c, c·∫£nh b√°o realtime, backtest nhanh, k·∫øt n·ªëi nhi·ªÅu s√†n.<br>
         <a class="um15-btn" target="_blank" rel="noopener" href="https://algosone.page.link/MbtR">D√πng th·ª≠ mi·ªÖn ph√≠ ‚Üó</a></div>`
      : `<div><b>AlgosOne ‚Äî AI trading</b><br>Strategy optimization, realtime alerts, fast backtest, multi-exchange.<br>
         <a class="um15-btn" target="_blank" rel="noopener" href="https://algosone.page.link/MbtR">Try for free ‚Üó</a></div>`);
  }

  // Auto open on first visit? b·∫≠t n·∫øu mu·ªën
  // setTimeout(()=>{document.getElementById('um15Fab').click()}, 1000);
}

/* ===== END AI Chat ===== */
</script>
</body>
</html>
