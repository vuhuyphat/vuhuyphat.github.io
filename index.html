<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Si√™u Metaverse Web3 V·∫°n V·∫≠t x1000</title>
  <style>
    :root { --bg: #1a1a1a; --card: #2c2c2c; --text: #fff; --accent: #27AE60; --gold: #FFD700; --blue: #1E90FF; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { text-align: center; padding: 20px; }
    h1 { font-size: 2.5em; color: var(--blue); animation: omni 0.5s infinite; }
    @keyframes omni { 0% { text-shadow: 0 0 10px var(--blue); } 50% { text-shadow: 0 0 20px var(--gold); } 100% { text-shadow: 0 0 10px var(--blue); } }
    #globe3d { width: 100%; height: 300px; margin: 20px 0; }
    .section { margin: 20px 0; }
    .card { background: var(--card); border-radius: 12px; padding: 16px; margin: 8px 0; animation: pulse 0.4s infinite; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.06); } 100% { transform: scale(1); } }
    .card b { color: var(--gold); }
    .muted { color: #aaa; font-size: 0.9em; }
    .btn { background: var(--accent); color: #fff; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin: 4px; transition: transform 0.2s; }
    .btn:hover { transform: scale(1.05); }
    .btn.out { background: transparent; border: 1px solid var(--accent); }
    .btn.connecting::after { content: '‚è≥'; margin-left: 8px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; }
    #ticker { font-size: 1.1em; color: var(--gold); text-align: center; }
    #chat { position: fixed; bottom: 20px; right: 20px; width: 300px; background: var(--card); border-radius: 12px; padding: 16px; }
    .bubble { margin: 8px 0; padding: 8px; border-radius: 8px; }
    .bubble.me { background: var(--accent); margin-left: 20%; }
    .bubble.ai { background: var(--blue); margin-right: 20%; }
    #premium { display: none; }
    #premium.unlocked { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Si√™u Metaverse Web3 V·∫°n V·∫≠t x1000</h1>
      <canvas id="globe3d"></canvas>
      <div class="row">
        <button id="connectWallet" class="btn">K·∫øt n·ªëi v√≠</button>
        <button id="connectBank" class="btn out">Li√™n k·∫øt Vietcombank</button>
        <button id="connectMoMo" class="btn out">Li√™n k·∫øt MoMo</button>
        <button id="connectPayPal" class="btn out">Li√™n k·∫øt PayPal</button>
      </div>
    </header>
    <div id="ticker">üåå Omni singularity loading...</div>
    <div class="section">
      <h2>Top 3 Tokens</h2>
      <div id="tokenPro"></div>
      <div id="tokenFree"></div>
    </div>
    <div class="section" id="premium">
      <h2>Omni Singularity Zone</h2>
    </div>
    <div class="section">
      <h2>Gi·ªõi thi·ªáu</h2>
      <div class="row">
        <a id="cta_binance" class="btn" href="#">Binance</a>
        <a id="cta_algos" class="btn out" href="#">AlgosOne</a>
      </div>
    </div>
    <div id="chat">
      <div id="chatBody"></div>
      <input id="chatInput" placeholder="Nh·∫≠p FOMO, moon..." style="width: 100%; padding: 8px; border-radius: 8px; border: none;">
    </div>
  </div>
  <script type="application/json" id="SITE_CONFIG">
    {
      "ai_api_url": "https://api.x.ai/v1",
      "ai_api_key": "YOUR_GROK3_API_KEY_HERE",
      "infura_url": "https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161",
      "alchemy_url": "https://eth-mainnet.g.alchemy.com/v2/demo",
      "coingecko_api": "https://api.coingecko.com/api/v3",
      "arweave_gateway": "https://arweave.net",
      "ipfs_gateway": "https://ipfs.io/ipfs",
      "swaps_api": "https://api.swaps.app/v1",
      "momo_api": "https://developers.momo.vn/v3",
      "paypal_api": "https://api-m.paypal.com",
      "nft_contract": "0xYOUR_NFT_CONTRACT_ADDRESS",
      "payments": {
        "eth": {
          "id": "0x54E15A7b6d4213beE87800432A151d794638E3C2",
          "min": 0.01,
          "token": "ETH"
        },
        "usdt": {
          "id": "0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",
          "min": 10,
          "token": "USDT",
          "network": "ERC-20"
        },
        "bank": {
          "account_number": "9567892030",
          "bank_name": "Vietcombank",
          "swift": "BFTVVNVX",
          "iban": ""
        },
        "momo": {
          "phone": "0567892030",
          "merchant_id": "YOUR_MOMO_MERCHANT_ID"
        },
        "paypal": {
          "email": "vumumabada@gmail.com",
          "client_id": "YOUR_PAYPAL_CLIENT_ID"
        }
      },
      "links": {
        "binance": "https://www.binance.com/referral/earn-together/refer-in-hotsummer/claim?hl=vi&ref=GRO_20338_9V44N",
        "algos": "https://algosone.page.link/MbtR"
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
  <script>
    const st = { 
      lang: (localStorage.getItem('lang') || (navigator.language || 'vi')).toLowerCase().startsWith('vi') ? 'vi' : 'en',
      theme: localStorage.getItem('theme') || 'dark',
      points: Number(localStorage.getItem('points') || 0),
      rev: Number(localStorage.getItem('rev') || 0),
      cfg: {}
    };
    try { st.cfg = JSON.parse(document.getElementById('SITE_CONFIG').textContent.trim()); } catch (e) { st.cfg = {}; }
    let provider, signer, walletAddress, chainIndex = 0;
    const chains = [st.cfg.infura_url, st.cfg.alchemy_url];

    // DOM helpers
    const $ = id => document.getElementById(id);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const setHref = (sel, href) => href && (document.querySelector(sel).href = href);

    // Initialize links
    setHref('#cta_binance', st.cfg.links?.binance);
    setHref('#cta_algos', st.cfg.links?.algos);

    // Wallet connection
    async function connectWallet() {
      $('#connectWallet').classList.add('connecting');
      try {
        if (window.ethereum) {
          provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send("eth_requestAccounts", []);
          signer = provider.getSigner();
          walletAddress = await signer.getAddress();
          $('#connectWallet').textContent = `Connected: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
          $('#connectWallet').classList.add('connected');
          checkOnChainUnlock();
          autoRevenue();
          connectUSDT();
        } else {
          alert('C√†i MetaMask ho·∫∑c WalletConnect!');
        }
      } catch (e) {
        console.warn('Wallet connect failed', e);
        alert('L·ªói k·∫øt n·ªëi v√≠!');
      } finally {
        $('#connectWallet').classList.remove('connecting');
      }
    }
    $('#connectWallet').onclick = connectWallet;

    // Vietcombank connection
    async function connectBank() {
      $('#connectBank').classList.add('connecting');
      try {
        const bankDetails = st.cfg.payments.bank;
        const res = await fetch(st.cfg.swaps_api + '/kyc', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            account_number: bankDetails.account_number,
            bank_name: bankDetails.bank_name,
            swift: bankDetails.swift,
            iban: bankDetails.iban
          })
        });
        if (res.ok) {
          localStorage.setItem('bank_linked', 'true');
          $('#connectBank').textContent = `Vietcombank: ${bankDetails.account_number.slice(-4)}`;
          addBubble('Vietcombank ƒë√£ li√™n k·∫øt!', 'me');
          storeArweave({ type: 'bank', content: JSON.stringify(bankDetails) });
        } else {
          alert('Li√™n k·∫øt Vietcombank th·∫•t b·∫°i. Ki·ªÉm tra th√¥ng tin!');
        }
      } catch (e) {
        console.warn('Bank connect failed', e);
        alert('L·ªói k·∫øt n·ªëi Vietcombank!');
      } finally {
        $('#connectBank').classList.remove('connecting');
      }
    }
    $('#connectBank').onclick = connectBank;

    // MoMo connection
    async function connectMoMo() {
      $('#connectMoMo').classList.add('connecting');
      try {
        const momoDetails = st.cfg.payments.momo;
        const res = await fetch(st.cfg.momo_api + '/merchant/auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            phone: momoDetails.phone,
            merchant_id: momoDetails.merchant_id
          })
        });
        if (res.ok) {
          localStorage.setItem('momo_linked', 'true');
          $('#connectMoMo').textContent = `MoMo: ${momoDetails.phone}`;
          addBubble('MoMo ƒë√£ li√™n k·∫øt!', 'me');
          storeArweave({ type: 'momo', content: JSON.stringify(momoDetails) });
        } else {
          alert('Li√™n k·∫øt MoMo th·∫•t b·∫°i. Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i!');
        }
      } catch (e) {
        console.warn('MoMo connect failed', e);
        alert('L·ªói k·∫øt n·ªëi MoMo!');
      } finally {
        $('#connectMoMo').classList.remove('connecting');
      }
    }
    $('#connectMoMo').onclick = connectMoMo;

    // PayPal connection
    async function connectPayPal() {
      $('#connectPayPal').classList.add('connecting');
      try {
        const paypalDetails = st.cfg.payments.paypal;
        const res = await fetch(st.cfg.paypal_api + '/v1/oauth2/token', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `grant_type=client_credentials&client_id=${paypalDetails.client_id}`
        });
        if (res.ok) {
          localStorage.setItem('paypal_linked', 'true');
          $('#connectPayPal').textContent = `PayPal: ${paypalDetails.email}`;
          addBubble('PayPal ƒë√£ li√™n k·∫øt!', 'me');
          storeArweave({ type: 'paypal', content: JSON.stringify(paypalDetails) });
          initPayPalButton();
        } else {
          alert('Li√™n k·∫øt PayPal th·∫•t b·∫°i. Ki·ªÉm tra email/client ID!');
        }
      } catch (e) {
        console.warn('PayPal connect failed', e);
        alert('L·ªói k·∫øt n·ªëi PayPal!');
      } finally {
        $('#connectPayPal').classList.remove('connecting');
      }
    }
    $('#connectPayPal').onclick = connectPayPal;

    // PayPal button
    function initPayPalButton() {
      paypal.Buttons({
        createOrder: (data, actions) => {
          return actions.order.create({
            purchase_units: [{
              amount: { value: '10.00', currency_code: 'USD' }
            }]
          });
        },
        onApprove: async (data, actions) => {
          const order = await actions.order.capture();
          addBubble(`Thanh to√°n PayPal $10 th√†nh c√¥ng!`, 'me');
          storeArweave({ type: 'paypal_payment', content: JSON.stringify(order) });
          autoRevenueUSDT(10);
        }
      }).render('#premium');
    }

    // USDT connection
    async function connectUSDT() {
      if (!signer) return alert('K·∫øt n·ªëi v√≠ Web3 tr∆∞·ªõc!');
      const usdtDetails = st.cfg.payments.usdt;
      try {
        const usdtContract = new ethers.Contract(
          '0xdAC17F958D2ee523a2206206994597C13D831ec7',
          ['function balanceOf(address) view returns (uint256)'],
          provider
        );
        const balance = await usdtContract.balanceOf(usdtDetails.id);
        if (balance.gte(ethers.utils.parseUnits(usdtDetails.min.toString(), 6))) {
          localStorage.setItem('usdt_linked', 'true');
          addBubble(`V√≠ USDT ${usdtDetails.id.slice(0,6)}...${usdtDetails.id.slice(-4)} ƒë√£ li√™n k·∫øt!`, 'me');
          storeArweave({ type: 'usdt', content: JSON.stringify(usdtDetails) });
        } else {
          addBubble(`V√≠ USDT c·∫ßn ‚â•${usdtDetails.min} USDT ƒë·ªÉ k√≠ch ho·∫°t!`, 'ai');
        }
      } catch (e) {
        console.warn('USDT connect failed', e);
        alert('L·ªói k·∫øt n·ªëi v√≠ USDT!');
      }
    }

    // On-chain payment check
    async function checkOnChainUnlock() {
      if (!signer) return;
      try {
        const balance = await provider.getBalance(walletAddress);
        const usdtContract = new ethers.Contract(
          '0xdAC17F958D2ee523a2206206994597C13D831ec7',
          ['function balanceOf(address) view returns (uint256)'],
          provider
        );
        const usdtBalance = await usdtContract.balanceOf(walletAddress);
        if (balance.gte(ethers.utils.parseEther(st.cfg.payments.eth.min.toString())) || 
            usdtBalance.gte(ethers.utils.parseUnits(st.cfg.payments.usdt.min.toString(), 6))) {
          localStorage.setItem('premium_unlocked', '3096');
          paintPremium();
          connectUSDT();
          addBubble('Omni Singularity Zone m·ªü kh√≥a!', 'me');
        }
      } catch (e) {
        console.warn('On-chain check failed', e);
      }
    }

    async function doUnlock() {
      if (!signer) return alert('K·∫øt n·ªëi v√≠ tr∆∞·ªõc!');
      try {
        const tx = await signer.sendTransaction({
          to: st.cfg.payments.eth.id,
          value: ethers.utils.parseEther(st.cfg.payments.eth.min.toString())
        });
        await tx.wait();
        localStorage.setItem('premium_unlocked', '3096');
        paintPremium();
        addBubble('Omni Singularity m·ªü kh√≥a!', 'me');
        connectUSDT();
      } catch (e) {
        console.warn('Unlock failed', e);
        alert('Thanh to√°n ETH th·∫•t b·∫°i!');
      }
    }

    function remember() {
      if (localStorage.getItem('premium_unlocked') === '3096') {
        paintPremium();
        connectUSDT();
      }
    }

    function relock() {
      localStorage.removeItem('premium_unlocked');
      $('#premium').classList.remove('unlocked');
      $('#premium').style.display = 'none';
    }

    // Omni-neural heuristics
    function omniAI(query) {
      const keywords = query.toLowerCase().split(' ');
      const seed = (Date.now() + parseInt((provider.getBlock('latest').then(b => b.hash.slice(-8)) || '0'), 16)) % 10000;
      const responses = {
        'ph√¢n t√≠ch': `Mua ${keywords[1] || 'ETH'} ·ªü h·ªó tr·ª£, b√°n ·ªü kh√°ng c·ª±. Volume tƒÉng x${(seed % 10 + 1) * 1000}!`,
        'g·ª£i √Ω': `Token hot: ETH, USDT, BNB. Stake USDT tr√™n Binance APY ${(seed % 5 + 4) * 100}%.`,
        'fomo': `üåå ${keywords[1] || 'USDT'} b√πng n·ªï x1000! Join: ${st.cfg.links.binance}`,
        'moon': `üöÄ ${keywords[1] || 'BNB'} to the moon x1000! Nhanh tay: ${st.cfg.links.algos}`,
        'rocket': `üî• ${keywords[1] || 'USDT'} tƒÉng t·ªëc x${(seed % 10 + 1) * 1000}! ƒêƒÉng k√Ω: ${st.cfg.links.binance}`
      };
      return responses[keywords[0]] || `üåå ${keywords[0] || 'USDT'} si√™u hot x1000! Join: ${st.cfg.links.binance}`;
    }

    // Auto beautify UI
    async function autoBeautify() {
      const styleEl = document.createElement('style');
      styleEl.textContent = `.card { animation: omni 0.5s infinite; } @keyframes omni { 0% { box-shadow: 0 0 10px var(--blue); } 50% { box-shadow: 0 0 20px var(--gold); } 100% { box-shadow: 0 0 10px var(--blue); } }`;
      document.head.appendChild(styleEl);
      storeArweave({ type: 'css', content: styleEl.textContent });
    }

    // Auto viral
    async function autoViral() {
      const events = JSON.parse(localStorage.getItem('userEvents') || '[]');
      const keywords = events.slice(-1)[0]?.target || 'FOMO';
      const seed = (Date.now() + parseInt((await provider.getBlock('latest')).hash.slice(-8), 16)) % 10000;
      const variants = Array.from({ length: 1000 }, (_, i) => `${keywords}_${i}_${seed}`);
      const post = omniAI(keywords);
      for (const variant of variants.slice(0, 100)) {
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(`${post} #${variant}`)}`, '_blank');
        try {
          await fetch(st.cfg.arweave_gateway + '/tx', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: `${post} #${variant}`, tags: { app: 'MetaverseWeb3', type: 'viral' } })
          });
        } catch (e) { console.warn('Arweave viral failed.', e); }
      }
    }

    // Store on Arweave
    async function storeArweave(data) {
      try {
        await fetch(st.cfg.arweave_gateway + '/tx', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ content: JSON.stringify(data), tags: { app: 'MetaverseWeb3', type: data.type } })
        });
      } catch (e) { console.warn('Arweave store failed.', e); }
    }

    // Fetch token data
    async function fetchRealtimeTokens() {
      try {
        provider = provider || new ethers.providers.JsonRpcProvider(chains[chainIndex]);
        const res = await fetch(st.cfg.coingecko_api + '/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10');
        if (!res.ok) throw new Error('CoinGecko failed');
        const tokens = await res.json();
        const top3 = tokens.slice(0, 3);
        const rest = tokens.slice(3, 6);
        $('#tokenPro').innerHTML = top3.map(t => cardToken(t).outerHTML).join('');
        $('#tokenFree').innerHTML = rest.map(t => cardToken(t).outerHTML).join('');
        $('#ticker').textContent = `üåå ${top3[0].symbol.toUpperCase()} $${top3[0].current_price} (${top3[0].price_change_percentage_24h.toFixed(2)}%) x1000`;
        storeArweave({ type: 'tokens', content: JSON.stringify(top3) });
      } catch (e) {
        console.warn('Fetch tokens failed, trying next chain.', e);
        chainIndex = (
