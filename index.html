<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>UltraMaster V‚àû ‚Ä¢ Wealthverse Ultimate</title>
<meta name="description" content="Web3 t·ª± v·∫≠n h√†nh ‚Ä¢ AI Agents 24/7 ‚Ä¢ C∆° h·ªôi on-chain ‚Ä¢ QR thanh to√°n 1 ch·∫°m ‚Ä¢ Viral share.">
<meta name="theme-color" content="#0b0f13">
<style>
/* ===== Design tokens ===== */
:root{
  --bg:#0b0f13;--card:#0f141a;--line:#233041;--txt:#e9eef4;--mut:#a9b8c8;
  --gold:#ffd700;--green:#16a34a;--purple:#6d28d9;--danger:#ff4d4f;
  --pill:#0f1725;--btn:#ffd700;--btnTxt:#0b0f13;--ring:rgba(255,215,0,.25);
  --shadow:0 10px 30px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.02) inset;
}
:root.light{
  --bg:#f6f9fc;--card:#ffffff;--line:#e2e8f0;--txt:#0b1020;--mut:#4a5568;
  --gold:#d4af37;--green:#0f7a2a;--purple:#5b21b6;--danger:#e11d48;
  --pill:#eef2f7;--btn:#d4af37;--btnTxt:#121212;--ring:rgba(212,175,55,.25);
  --shadow:0 10px 24px rgba(0,0,0,.08);
}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:
  radial-gradient(60% 140% at 50% -10%, rgba(109,40,217,.25),transparent 60%),
  linear-gradient(180deg, rgba(22,163,74,.12),transparent 40%),
  var(--bg);
color:var(--txt);font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto}
.wrap{max-width:1200px;margin:0 auto;padding:20px}
.card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:var(--shadow);margin:12px 0;transition:.25s}
.card:hover{transform:translateY(-2px)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border:1px solid var(--line);border-radius:999px;background:var(--pill);color:var(--txt)}
.btn{display:inline-flex;align-items:center;gap:8px;border:0;border-radius:12px;padding:12px 16px;font-weight:700;background:var(--btn);color:var(--btnTxt);cursor:pointer;box-shadow:0 0 0 0 var(--ring);transition:.2s}
.btn:hover{transform:translateY(-1px);box-shadow:0 0 0 6px var(--ring)}
.btn.out{background:transparent;color:var(--txt);border:1px solid var(--line)}
.logo-dot{width:12px;height:12px;border-radius:50%;background:var(--gold);box-shadow:0 0 0 0 rgba(255,215,0,.7);animation:glow 1.8s infinite}
@keyframes glow{0%{box-shadow:0 0 0 0 rgba(255,215,0,.7)}70%{box-shadow:0 0 0 14px rgba(255,215,0,0)}100%{box-shadow:0 0 0 0 rgba(255,215,0,0)}}
.hero{position:relative;overflow:hidden}

/* ===== 3D Earth canvas ===== */
.globe3d{width:300px;height:300px;border-radius:50%;display:block;margin:auto;box-shadow:
  inset 12px 0 40px rgba(0,0,0,.35), inset -12px 0 40px rgba(0,0,0,.25), 0 10px 30px rgba(0,0,0,.35)}
.globe-cap{color:var(--mut);text-align:center;margin-top:8px}

/* KPI, tags */
.kpi{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.kbox{background:linear-gradient(180deg, rgba(255,215,0,.12), transparent 60%),var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;text-align:center}
.now{font-size:22px;font-weight:800;color:var(--gold)}
.tag{display:inline-block;border:1px solid var(--line);border-radius:10px;padding:4px 10px;margin:4px 6px 0 0;color:var(--txt);opacity:.85;font-size:13px}
.badge{display:inline-flex;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:rgba(109,40,217,.12)}
.qr-wrap{display:grid;place-items:center;border:1px dashed var(--line);border-radius:14px;background:radial-gradient(120% 100% at 50% -30%, rgba(255,215,0,.12), transparent 60%),transparent}
.qr{width:180px;height:180px;border-radius:12px;background:#fff}
.paybtn{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:transparent;cursor:pointer}
.paybtn.active{outline:2px solid var(--gold);box-shadow:0 0 0 6px var(--ring)}
.copy{font-size:13px;border:1px dashed var(--line);border-radius:8px;padding:4px 10px;background:transparent;color:var(--txt);cursor:pointer}
.footer{padding:32px 0;text-align:center;color:var(--mut)}
small.muted{color:var(--mut)}
/* Chat mini */
.chatfab{position:fixed;right:16px;bottom:16px;z-index:50}
.chatwin{position:fixed;right:16px;bottom:80px;width:min(420px,95vw);max-height:75vh;display:none;flex-direction:column;background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;z-index:49;box-shadow:var(--shadow)}
.chathead{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
.chatbody{padding:12px;overflow:auto;display:flex;flex-direction:column;gap:8px}
.bubble{max-width:85%;padding:10px 14px;border:1px solid var(--line);border-radius:12px}
.bubble.me{align-self:flex-end;background:#102235}
.bubble.ai{align-self:flex-start;background:#101a11}
.chatinput{display:flex;gap:8px;padding:12px;border-top:1px solid var(--line)}
.chatinput input{flex:1;padding:10px;border-radius:10px;border:1px solid var(--line);background:transparent;color:var(--txt)}
.hidden{display:none}
.mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
@media(max-width:900px){.header-flex{display:grid;gap:16px}}

/* ===== Partner cards contrast fix (light theme) ===== */
.partner-card{background:#1a1400;border-color:#6b4e00}
.partner-card .btn{background:#ffb000;color:#1a1300}
:root.light .partner-card{background:#fffbe6 !important;border-color:#f2d38a !important;color:#1a1300}
:root.light .partner-card .muted{color:#3a2e00}
:root.light .partner-card .btn{background:#ffc83d;color:#1a1300;border:0}

/* ===== BOOST: l√†m n·ªïi c√°c n√∫t m·ªü mi·ªÖn ph√≠ (kh√¥ng ƒë·ªïi c·∫•u tr√∫c) ===== */
#cta_binance, #ctaB, #bnbLink{
  background:linear-gradient(180deg,#ffd54a,#ffb000);
  color:#1a1300;border:0;box-shadow:0 0 0 0 rgba(255,176,0,.25);
}
#cta_binance:hover, #ctaB:hover, #bnbLink:hover{ box-shadow:0 0 0 8px rgba(255,176,0,.22); transform:translateY(-1px); }

#cta_algos, #ctaA, #algosLink{
  background:linear-gradient(180deg,#ff915a,#ff5f1a);
  color:#1a1300;border:0;box-shadow:0 0 0 0 rgba(255,95,26,.25);
}
#cta_algos:hover, #ctaA:hover, #algosLink:hover{ box-shadow:0 0 0 8px rgba(255,95,26,.22); transform:translateY(-1px); }

/* ===== New styles for super Web3 upgrades ===== */
.wallet-btn{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(180deg,#4a90e2,#2f80ed);color:#fff;border:0;border-radius:12px;padding:10px 16px;cursor:pointer;transition:.2s}
.wallet-btn:hover{transform:scale(1.05);box-shadow:0 0 0 6px rgba(47,128,237,.25)}
.wallet-btn.connected{background:linear-gradient(180deg,#27ae60,#219653)}
.nft-reward{position:absolute;top:10px;right:10px;width:40px;height:40px;border-radius:50%;background:#ffd700;opacity:0;transition:.3s}
.card:hover .nft-reward{opacity:1;transform:rotate(10deg)}
.viral-share{position:fixed;bottom:90px;right:16px;z-index:10;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:10px;display:flex;gap:8px}
.ai-status{color:var(--green);font-size:12px}
.error-fix{color:var(--danger);font-size:12px}
</style>
</head>
<body>
<div class="wrap" id="app">

  <!-- Top row -->
  <div class="row">
    <span class="pill"><span class="logo-dot"></span><b id="t_brand">UltraMaster V‚àû</b></span>
    <span class="pill">ENS: <b id="ens">lightunfold.eth</b></span>
    <span class="pill">Heartbeat: <b id="hb">‚Äî</b></span>
    <button class="pill" id="openData">Data</button>
    <button class="pill" id="lang">VI/EN</button>
    <button class="pill" id="theme">üåó Theme</button>
    <button class="wallet-btn" id="connectWallet">Connect Wallet</button>
  </div>

  <!-- Hero -->
  <section class="card hero">
    <div class="header-flex">
      <div>
        <h1 id="brand">LightUnfold ‚Ä¢ UltraMaster V‚àû Ultimate</h1>
        <div class="muted" id="tagline">Web3 Si√™u T·ª± V·∫≠n H√†nh ‚Äì AI Agents 24/7 ‚Ä¢ M·ªü Kh√≥a Top 3 On‚ÄëChain ‚Ä¢ Token Ch·ªçn L·ªçc Realtime</div>
        <div class="card" style="margin-top:12px">
          <b id="moto">‚ÄúBi·∫øt S·ªõm ‚Äì Quy·∫øt ƒê·ªãnh S·ªõm ‚Äì T√†i L·ªôc S·ªõm.‚Äù</b><br>
          <small class="muted" id="motoDesc">
            H·ªôi t·ª•: <b>Kh√≥a h·ªçc tinh g·ªçn</b>, <b>Ph√¢n t√≠ch crypto realtime</b>, <b>AI h·ªèi ƒë√°p</b>, <b>C∆° h·ªôi s·ªõm nh·∫•t</b>.
          </small>
        </div>
        <div class="row" style="margin-top:12px">
          <a class="btn out" id="cta_binance" href="#" target="_blank" rel="noopener">M·ªü Binance Mi·ªÖn Ph√≠ ‚Üó</a>
          <a class="btn out" id="cta_algos" href="#" target="_blank" rel="noopener">M·ªü AlgosOne Mi·ªÖn Ph√≠ ‚Üó</a>
        </div>
      </div>
      <div>
        <!-- REAL 3D EARTH -->
        <canvas id="globe3d" class="globe3d"></canvas>
        <div class="globe-cap" id="globeCap">Tr√°i ƒê·∫•t On‚ÄëChain ¬∑ M√¢y & √Ånh S√°ng 3D</div>
      </div>
    </div>
  </section>

  <!-- KPI -->
  <div class="kpi">
    <div class="kbox"><div class="muted" id="k1t">C∆° H·ªôi</div><div class="now" id="kOpps">0</div></div>
    <div class="kbox"><div class="muted" id="k2t">C·∫≠p Nh·∫≠t</div><div class="now" id="kUpd">‚Äî</div></div>
    <div class="kbox"><div class="muted" id="k3t">ƒêang Xem</div><div class="now" id="kLive">‚Äî</div></div>
    <div class="kbox"><div class="muted" id="k4t">Doanh Thu</div><div class="now">$<span id="kRev">0</span></div></div>
  </div>

  <!-- Top 3 Tokens -->
  <section class="card" id="secTop3">
    <h3 style="margin:0 0 10px" id="hTop3">‚≠ê Top 3 Token Ti·ªÅm NƒÉng H√¥m Nay</h3>
    <div id="tokenPro" class="grid"></div>
  </section>

  <!-- Token Free -->
  <section class="card" id="secFree">
    <h3 style="margin:0 0 10px" id="hFree">üìä Token Ch·ªçn L·ªçc (Mi·ªÖn Ph√≠)</h3>
    <div id="tokenFree" class="grid"></div>
  </section>

  <!-- H·ªçc vi·ªán -->
  <section class="card" id="edu">
    <h3 style="margin:0 0 10px" id="hEdu">üìö H·ªçc Nhanh ‚Äì NFT Rewards</h3>
    <div class="grid" id="ebooks"></div>
  </section>

  <!-- C∆° h·ªôi n·ªïi b·∫≠t -->
  <section class="card" id="secOpp">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0" id="hOpp">üî• C∆° H·ªôi N·ªïi B·∫≠t (Multi‚ÄëChain)</h3>
      <div class="row"><span class="badge" id="scanMode">Qu√©t: On‚ÄëChain</span><button class="btn out" id="refreshNow">‚Üª L√†m m·ªõi</button></div>
    </div>
    <div class="muted" id="ticker" style="margin:6px 0 10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">‚Äî</div>
    <div id="opps" class="grid"></div>
  </section>

  <!-- Premium Plans -->
  <section class="card" id="secPremium">
    <h3 style="margin:0 0 10px" id="hPlan">üí† Premium ‚Äì Ph√¢n T√≠ch Chuy√™n S√¢u & L·ªô Tr√¨nh</h3>
    <div id="plans" class="grid"></div>
  </section>

  <!-- SuperGate: QR + Paywall -->
  <section class="card" id="supergate">
    <h3 style="margin:0 0 10px" id="hGate">üîì SuperGate (Unlock On‚ÄëChain)</h3>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr))">
      <div class="card">
        <div class="grid" style="grid-template-columns:180px 1fr;align-items:center">
          <div class="qr-wrap"><img id="qr" class="qr" alt="QR"></div>
          <div>
            <div class="muted" id="gatePitch"><b>Thanh to√°n nh·ªè ƒë·ªÉ nh·∫≠n m√£ m·ªü kh√≥a.</b></div>
            <div class="muted"><span id="addrLbl">ƒê·ªãa ch·ªâ/ID:</span> <span class="mono" id="payAddr">‚Äî</span></div>
            <div id="payList" class="grid" style="grid-template-columns:1fr"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="grid" style="grid-template-columns:1fr">
          <div><label class="muted" id="bundleLbl">Ch·ªçn g√≥i</label><select id="bundleSel"></select></div>
          <div><label class="muted" id="codeLbl">M√£ m·ªü kh√≥a (sau thanh to√°n)</label><input id="unlockCode" placeholder="Nh·∫≠p m√£‚Ä¶"></div>
          <div><input id="txhash" placeholder="(Tu·ª≥ ch·ªçn) D√°n TX Hash / ghi ch√∫"></div>
          <div class="row"><button class="btn" id="doUnlock">M·ªü kh√≥a</button><button class="btn out" id="remember">Nh·ªõ m√£</button></div>
          <div id="uMsg" class="muted"></div>
          <div class="muted" style="margin-top:8px" id="afterUnlockHint">Sau m·ªü kh√≥a, n·ªôi dung Premium xu·∫•t hi·ªán. M√£ ƒë∆∞·ª£c l∆∞u tr√™n thi·∫øt b·ªã.</div>
        </div>
      </div>
    </div>

    <div id="opened" class="hidden" style="margin-top:14px">
      <div class="row"><span class="pill" style="background:#11291a;border-color:#20452f;color:#bff5d0" id="unlockedLbl">‚úî ƒê√£ m·ªü kh√≥a</span><button class="btn out" id="relock">Kho√° l·∫°i</button></div>
      <div id="premium" class="grid" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- Partners (contrast fixed) -->
  <section class="card" id="secPartners">
    <div class="grid">
      <div class="card partner-card">
        <h4>AlgosOne ‚Äì Chi·∫øn l∆∞·ª£c AI & c·∫£nh b√°o realtime</h4>
        <div class="muted">Copy‚Äëtrading/chi·∫øn l∆∞·ª£c t·ª± ƒë·ªông c√≥ r·ªßi ro. Lu√¥n hi·ªÉu r√µ s·∫£n ph·∫©m, quy ƒë·ªãnh & kh·∫©u v·ªã r·ªßi ro tr∆∞·ªõc khi d√πng.</div>
        <a class="btn" style="margin-top:8px" id="algosLink" href="#" target="_blank" rel="noopener">M·ªü mi·ªÖn ph√≠ ‚Üó</a>
      </div>
      <div class="card partner-card">
        <h4>BNB ‚Äì H·ªá sinh th√°i giao d·ªãch</h4>
        <ul class="muted" style="margin:10px 0 0 18px">
          <li>Kh·ªõp l·ªánh nhanh ‚Ä¢ ph√≠ c·∫°nh tranh</li>
          <li>B·∫£o m·∫≠t nhi·ªÅu l·ªõp ‚Ä¢ 2FA</li>
          <li>H·ªá sinh th√°i Earn ‚Ä¢ Launchpool</li>
        </ul>
        <a class="btn" style="margin-top:8px" id="bnbLink" href="#" target="_blank" rel="noopener">M·ªü mi·ªÖn ph√≠ ‚Üó</a>
      </div>
    </div>
  </section>

  <!-- CTA cu·ªëi -->
  <section class="card" id="lastCTA">
    <h3 style="margin:0 0 8px" id="ctaH">üöÄ C∆° h·ªôi nhanh ‚Äì Ch·ªß ƒë·ªông ƒë√≥n l·∫•y</h3>
    <div id="ctaD">M·ªü kh√≥a ho·∫∑c m·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ƒë·ªÉ Theo d√µi ‚Äì Ph√¢n t√≠ch ‚Äì H√†nh ƒë·ªông m·ªôt n∆°i.</div>
    <div class="row" style="margin-top:10px">
      <a class="btn" href="#supergate" id="ctaOpen">M·ªü kh√≥a ngay</a>
      <a class="btn out" id="ctaB" href="#" target="_blank" rel="noopener">M·ªü Binance Mi·ªÖn Ph√≠ ‚Üó</a>
      <a class="btn out" id="ctaA" href="#" target="_blank" rel="noopener">M·ªü AlgosOne Mi·ªÖn Ph√≠ ‚Üó</a>
      <button class="btn out" id="shareMine">Chia s·∫ª li√™n k·∫øt c·ªßa t√¥i</button>
    </div>
  </section>

  <!-- Footer -->
  <button class="pill" id="goTop" style="position:fixed;left:16px;bottom:90px;z-index:10">‚Üë Top</button>
  <div class="footer">¬© <span id="year"></span> Wealthverse ‚Ä¢ <span id="autoLbl">T·ª± v·∫≠n h√†nh 24/7</span></div>
</div>

<!-- ===== Inline CONFIG (gi·ªØ nguy√™n) ===== -->
<script id="SITE_CONFIG" type="application/json">
{
  "brand":"LightUnfold ‚Ä¢ UltraMaster V‚àû Ultimate",
  "ens":"lightunfold.eth",
  "links":{
    "binance":"https://www.binance.com/vi/register?ref=GRO_20338_9V44N",
    "algos":"https://algosone.page.link/MbtR"
  },
  "payments":{
    "paypal":{"label":"PayPal","id":"vumumabada@gmail.com","qr":"https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=paypal.me/vumumabada"},
    "vietcombank":{"label":"Vietcombank","id":"9567892030","note":"TR·∫¶N VƒÇN V≈® ‚Ä¢ chuy·ªÉn kho·∫£n ghi note email/tx"},
    "momo":{"label":"MoMo","id":"0567892030","qr":"https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=MoMo:0567892030"},
    "eth":{"label":"ETH (ERC‚Äë20)","id":"0x54E15A7b6d4213beE87800432A151d794638E3C2"},
    "usdt":{"label":"USDT (ERC‚Äë20)","id":"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0"}
  },
  "premium":{
    "unlock_code":"23061988",
    "plans":[
      {"id":"p9","title":"Starter","price":9,"desc":"Top 3 h√¥m nay ‚Ä¢ v√πng quan s√°t ‚Ä¢ checklist r·ªßi ro."},
      {"id":"p19","title":"Pro","price":19,"desc":"Starter + k·ªãch b·∫£n 2 chi·ªÅu ‚Ä¢ m·ª©c v√¥ hi·ªáu h√≥a ‚Ä¢ template R:R."},
      {"id":"p29","title":"Master","price":29,"desc":"Pro + ƒëa khung ‚Ä¢ t√¢m l√Ω & d√≤ng ti·ªÅn ‚Ä¢ playbook n√¢ng cao."}
    ]
  },
  "i18n":{
    "vi":{"tagline":"Web3 Si√™u T·ª± V·∫≠n H√†nh ‚Äì AI Agents 24/7 ‚Ä¢ M·ªü Kh√≥a Top 3 On‚ÄëChain ‚Ä¢ Token Ch·ªçn L·ªçc Realtime","moto":"‚ÄúBi·∫øt S·ªõm ‚Äì Quy·∫øt ƒê·ªãnh S·ªõm ‚Äì T√†i L·ªôc S·ªõm.‚Äù","globeCap":"Tr√°i ƒê·∫•t On‚ÄëChain ¬∑ M√¢y & √Ånh S√°ng 3D"},
    "en":{"brand":"LightUnfold ‚Ä¢ UltraMaster V‚àû Ultimate","tagline":"Autonomous Web3 ‚Äì AI Agents 24/7 ‚Ä¢ Unlock Top 3 On‚ÄëChain ‚Ä¢ Curated Tokens Realtime","moto":"‚ÄúKnow Early ‚Äì Decide Early ‚Äì Prosper Early.‚Äù","globeCap":"On‚ÄëChain Earth ¬∑ 3D Clouds & Lighting"}
  },
  "ai_api_url": "https://api.groq.com/openai/v1/chat/completions", // G·∫Øn AI URL (v√≠ d·ª• Groq/OpenAI proxy)
  "ai_api_key": "YOUR_AI_API_KEY_HERE", // G·∫Øn AI key
  "coingecko_api": "https://api.coingecko.com/api/v3" // URL cho data realtime
}
</script>

<!-- ===== Three.js ===== -->
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>

<!-- ===== Ethers.js for Web3 ===== -->
<script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>

<!-- ===== Core JS (n√¢ng c·∫•p si√™u Web3: t·ª± l√†m ƒë·∫πp, t·ª± s·ª≠a, t·ª± lan t·ªèa, t·ª± ki·∫øm ti·ªÅn) ===== -->
<script>
(() => {
  const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);
  const st = { lang:(localStorage.getItem('lang')||(navigator.language||'vi')).toLowerCase().startsWith('vi')?'vi':'en',
               theme:localStorage.getItem('theme')||'dark',
               points:Number(localStorage.getItem('points')||0),
               rev:Number(localStorage.getItem('rev')||0),
               cfg:{} };
  try{ st.cfg = JSON.parse(document.getElementById('SITE_CONFIG').textContent.trim()); }catch(e){ st.cfg = {}; }

  // ===== T√≠ch h·ª£p Web3 wallet (ethers.js) =====
  let provider, signer, walletAddress;
  async function connectWallet() {
    if (window.ethereum) {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      walletAddress = await signer.getAddress();
      $('#connectWallet').textContent = `Connected: ${walletAddress.slice(0,6)}...${walletAddress.slice(-4)}`;
      $('#connectWallet').classList.add('connected');
      // T·ª± ƒë·ªông m·ªü kh√≥a premium n·∫øu wallet ƒë√£ thanh to√°n on-chain (gi·∫£ ƒë·ªãnh check balance)
      checkOnChainUnlock();
    } else {
      alert('Install MetaMask!');
    }
  }
  $('#connectWallet').onclick = connectWallet;

  async function checkOnChainUnlock() {
    // Gi·∫£ ƒë·ªãnh: check transaction to payment address
    if (walletAddress) {
      // S·ª≠ d·ª•ng ethers ƒë·ªÉ query blockchain (v√≠ d·ª•: check balance USDT sent)
      const usdtContract = new ethers.Contract(st.cfg.payments.usdt.id, ['function balanceOf(address) view returns (uint256)'], provider);
      const bal = await usdtContract.balanceOf(walletAddress);
      if (bal > 0) {
        $('#opened').classList.remove('hidden');
        localStorage.setItem('premium_unlocked', '1');
        addRevenue(bal / 1e6); // Gi·∫£ ƒë·ªãnh USDT decimals
      }
    }
  }

  function applyTheme(m){ document.documentElement.classList.toggle('light', m==='light'); localStorage.setItem('theme', m); }
  applyTheme(st.theme);
  $('#theme').onclick = ()=>{ st.theme = st.theme==='dark'?'light':'dark'; applyTheme(st.theme); };

  /* ===== TONE n√¢ng c·∫•p (quy·∫øt li·ªát, sang tr·ªçng) ‚Äì ch·ªâ thay TEXT ===== */
  const DI = {
    vi:{
      brand: st.cfg.brand || 'LightUnfold ‚Ä¢ UltraMaster V‚àû Ultimate',
      heartbeat:'Nh·ªãp tim',
      tagline:'V√≠ Web3 t·ª± v·∫≠n h√†nh c·∫•p doanh nghi·ªáp ‚Ä¢ AI Agents 24/7 ‚Ä¢ T√≠n hi·ªáu on‚Äëchain t·ª©c th√¨ ‚Ä¢ T·ªëi ∆∞u ho√° chuy·ªÉn ƒë·ªïi th√†nh t√†i l·ªôc.',
      moto:'‚ÄúNh√¨n xa h∆°n ‚Äì Quy·∫øt ƒë·ªãnh nhanh h∆°n ‚Äì Chi·∫øm l·ª£i th·∫ø tr∆∞·ªõc.‚Äù',
      motoDesc:'H·ªá t·ªïng l·ª±c cho tƒÉng tr∆∞·ªüng: <b>Kho√° h·ªçc tinh g·ªçn</b> ‚Ä¢ <b>B·∫£n ƒë·ªì d√≤ng ti·ªÅn realtime</b> ‚Ä¢ <b>AI c·ªë v·∫•n t·ª©c th√¨</b> ‚Ä¢ <b>Chi·∫øn l∆∞·ª£c s·ªõm, r·ªßi ro ki·ªÉm so√°t</b>.',
      globeCap:'Tr√°i ƒê·∫•t On‚ÄëChain ‚Ä¢ L·ªõp m√¢y & √°nh trƒÉng 3D ‚Äì s·∫Øc xanh th·ªãnh v∆∞·ª£ng.',
      k1t:'C∆° H·ªôi',k2t:'C·∫≠p Nh·∫≠t',k3t:'ƒêang Xem',k4t:'Doanh Thu',
      hTop3:'‚≠ê Top 3 Token ƒê√°ng H√†nh ƒê·ªông H√¥m Nay',
      hFree:'üìä Token Ch·ªçn L·ªçc (Mi·ªÖn ph√≠ ‚Äì xem ngay)',
      hEdu:'üìö H·ªçc Nhanh ‚Äì Nh·∫≠n NFT Th∆∞·ªüng',
      hOpp:'üî• C∆° H·ªôi N·ªïi B·∫≠t (Multi‚ÄëChain, realtime)',
      scanMode:'Qu√©t: On‚ÄëChain',
      btnRefresh:'L√†m m·ªõi',
      hPlan:'üí† Premium ‚Äì Chi·∫øn L∆∞·ª£c Th·ª±c Chi·∫øn & Playbook',
      hGate:'üîì SuperGate (M·ªü kho√° On‚ÄëChain)',
      gatePitch:'<b>Thanh to√°n nh·ªè ‚Üí m·ªü kho√° t·ª©c th√¨ ‚Ä¢ gi√° tr·ªã d√†i h·∫°n.</b>',
      addrLbl:'ƒê·ªãa ch·ªâ/ID:',
      bundleLbl:'Ch·ªçn g√≥i',
      codeLbl:'M√£ m·ªü kho√° (sau thanh to√°n)',
      placeUnlock:'Nh·∫≠p m√£‚Ä¶',
      placeTx:'(Tu·ª≥ ch·ªçn) D√°n TX Hash / ghi ch√∫',
      afterUnlockHint:'M·ªü kho√° xong, Premium hi·ªÉn th·ªã ngay. M√£ ƒë∆∞·ª£c l∆∞u tr√™n thi·∫øt b·ªã c·ªßa b·∫°n.',
      unlockedLbl:'‚úî ƒê√£ m·ªü kho√°',
      relock:'Kho√° l·∫°i',
      ctaH:'üöÄ ƒêi tr∆∞·ªõc ‚Äì ƒê√≥n d√≤ng ti·ªÅn',
      ctaD:'M·ªü kho√° ho·∫∑c m·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ƒë·ªÉ Theo d√µi ‚Ä¢ Ph√¢n t√≠ch ‚Ä¢ H√†nh ƒë·ªông m·ªôt n∆°i.',
      ctaOpen:'M·ªü kho√° ngay',
      ctaBinance:'M·ªü Binance Mi·ªÖn Ph√≠ ‚Üó',
      ctaAlgos:'M·ªü AlgosOne Mi·ªÖn Ph√≠ ‚Üó',
      shareMine:'Chia s·∫ª li√™n k·∫øt c·ªßa t√¥i',
      autoLbl:'T·ª± v·∫≠n h√†nh 24/7',
      openData:'D·ªØ li·ªáu',
      partners:{
        algosH:'AlgosOne ‚Äì Chi·∫øn l∆∞·ª£c AI & c·∫£nh b√°o realtime',
        algosD:'Hi·ªáu su·∫•t ƒë√≤i h·ªèi k·ª∑ lu·∫≠t & ki·ªÉm so√°t r·ªßi ro. H√£y tu√¢n th·ªß quy ƒë·ªãnh v√† kh·∫©u v·ªã r·ªßi ro c√° nh√¢n.',
        open:'M·ªü mi·ªÖn ph√≠ ‚Üó',
        bnbH:'BNB ‚Äì H·ªá sinh th√°i giao d·ªãch d·∫´n d·∫Øt',
        b1:'Kh·ªõp l·ªánh nhanh ‚Ä¢ ph√≠ c·∫°nh tranh',
        b2:'B·∫£o m·∫≠t nhi·ªÅu l·ªõp ‚Ä¢ 2FA',
        b3:'H·ªá sinh th√°i Earn ‚Ä¢ Launchpool'
      },
      chatH:'AI T√†i ch√≠nh',
      chatClose:'ƒê√≥ng',
      chatPH:'H·ªèi v·ªÅ token, k·∫ø ho·∫°ch l·ªánh‚Ä¶',
      chatSend:'G·ª≠i',
      mTitle:'D·ªØ li·ªáu Premium On‚ÄëChain',
      closeData:'ƒê√≥ng'
    },
    en:{
      brand: st.cfg.i18n?.en?.brand || 'LightUnfold ‚Ä¢ UltraMaster V‚àû Ultimate',
      heartbeat:'Heartbeat',
      tagline:'Enterprise‚Äëgrade Autonomous Web3 Wallet ‚Ä¢ AI Agents 24/7 ‚Ä¢ Instant on‚Äëchain signals ‚Ä¢ Convert intent into wealth.',
      moto:'‚ÄúSee further ‚Äì Decide faster ‚Äì Lead the upside.‚Äù',
      motoDesc:'A conversion engine: <b>Lean courses</b> ‚Ä¢ <b>Realtime money‚Äëflow map</b> ‚Ä¢ <b>Instant AI advisory</b> ‚Ä¢ <b>Early, risk‚Äëdisciplined plays</b>.',
      globeCap:'On‚ÄëChain Earth ‚Ä¢ 3D clouds & moonlight ‚Äì prosperity‚Äëtuned blue.',
      k1t:'Opportunities',k2t:'Updates',k3t:'Live Views',k4t:'Revenue',
      hTop3:'‚≠ê Top 3 Tokens to Act on Today',
      hFree:'üìä Curated Tokens (Free ‚Äì check now)',
      hEdu:'üìö Learn Fast ‚Äì Earn NFT Rewards',
      hOpp:'üî• Featured Opportunities (Multi‚ÄëChain, realtime)',
      scanMode:'Scan: On‚ÄëChain',
      btnRefresh:'Refresh',
      hPlan:'üí† Premium ‚Äì Practical Strategy & Playbooks',
      hGate:'üîì SuperGate (On‚ÄëChain Unlock)',
      gatePitch:'<b>Small payment ‚Üí instant unlock ‚Ä¢ lasting value.</b>',
      addrLbl:'Address/ID:',
      bundleLbl:'Choose plan',
      codeLbl:'Unlock code (after payment)',
      placeUnlock:'Enter code‚Ä¶',
      placeTx:'(Optional) Paste TX hash / note',
      afterUnlockHint:'Premium content appears instantly. The code is stored on your device.',
      unlockedLbl:'‚úî Unlocked',
      relock:'Relock',
      ctaH:'üöÄ Move first ‚Äì Ride the flows',
      ctaD:'Unlock or open a free account to Track ‚Ä¢ Analyze ‚Ä¢ Act in one place.',
      ctaOpen:'Unlock now',
      ctaBinance:'Open Binance Free ‚Üó',
      ctaAlgos:'Open AlgosOne Free ‚Üó',
      shareMine:'Share my referral link',
      autoLbl:'Always‚ÄëOn 24/7',
      openData:'Data',
      partners:{
        algosH:'AlgosOne ‚Äì AI strategies & realtime alerts',
        algosD:'Performance requires discipline & risk control. Follow regulations and your own risk tolerance.',
        open:'Open free ‚Üó',
        bnbH:'BNB ‚Äì Leading trading ecosystem',
        b1:'Fast matching ‚Ä¢ competitive fees',
        b2:'Multi‚Äëlayer security ‚Ä¢ 2FA',
        b3:'Ecosystem: Earn ‚Ä¢ Launchpool'
      },
      chatH:'Finance AI',
      chatClose:'Close',
      chatPH:'Ask about tokens, trade plan‚Ä¶',
      chatSend:'Send',
      mTitle:'Premium On‚ÄëChain Data',
      closeData:'Close'
    }
  };

  function setTxt(sel, val, html=false){ const el=$(sel); if(!el) return; html ? (el.innerHTML=val) : (el.textContent=val); }
  function applyLang(){
    const L = DI[st.lang];
    setTxt('#brand', L.brand);
    setTxt('#tagline', L.tagline, true);
    setTxt('#moto', L.moto);
    setTxt('#motoDesc', L.motoDesc, true);
    setTxt('#globeCap', L.globeCap);

    const hb = $('#hb'); if(hb){ const pill = hb.closest('.pill'); if(pill){ pill.innerHTML = `${L.heartbeat}: <b id="hb">${hb.textContent}</b>`; } }

    setTxt('#k1t', L.k1t); setTxt('#k2t', L.k2t); setTxt('#k3t', L.k3t); setTxt('#k4t', L.k4t);
    setTxt('#hTop3', L.hTop3); setTxt('#hFree', L.hFree); setTxt('#hEdu', L.hEdu); setTxt('#hOpp', L.hOpp);
    setTxt('#scanMode', L.scanMode);
    const rn=$('#refreshNow'); if(rn){ rn.innerHTML = `‚Üª ${L.btnRefresh}`; }

    setTxt('#hPlan', L.hPlan); setTxt('#hGate', L.hGate);
    setTxt('#gatePitch', L.gatePitch, true);
    setTxt('#addrLbl', L.addrLbl); setTxt('#bundleLbl', L.bundleLbl); setTxt('#codeLbl', L.codeLbl);
    const uc=$('#unlockCode'); if(uc) uc.placeholder=L.placeUnlock;
    const tx=$('#txhash'); if(tx) tx.placeholder=L.placeTx;
    setTxt('#afterUnlockHint', L.afterUnlockHint); setTxt('#unlockedLbl', L.unlockedLbl); setTxt('#relock', L.relock);

    setTxt('#ctaH', L.ctaH); setTxt('#ctaD', L.ctaD); setTxt('#ctaOpen', L.ctaOpen);
    setTxt('#cta_binance', L.ctaBinance); setTxt('#cta_algos', L.ctaAlgos);
    setTxt('#ctaB', L.ctaBinance); setTxt('#ctaA', L.ctaAlgos);
    setTxt('#shareMine', L.shareMine); setTxt('#autoLbl', L.autoLbl); setTxt('#openData', L.openData);

    const cards = $$('#secPartners .partner-card');
    if(cards[0]){ const h4=cards[0].querySelector('h4'), p=cards[0].querySelector('.muted'), a=cards[0].querySelector('a.btn');
      if(h4) h4.textContent=L.partners.algosH; if(p) p.textContent=L.partners.algosD; if(a) a.textContent=L.partners.open; }
    if(cards[1]){ const h4=cards[1].querySelector('h4'), lis=cards[1].querySelectorAll('li'), a=cards[1].querySelector('a.btn');
      if(h4) h4.textContent=L.partners.bnbH;
      if(lis[0]) lis[0].textContent=L.partners.b1;
      if(lis[1]) lis[1].textContent=L.partners.b2;
      if(lis[2]) lis[2].textContent=L.partners.b3;
      if(a) a.textContent=L.partners.open; }

    setTxt('#chatH', L.chatH);
    const closeChatBtn=$('#closeChat'); if(closeChatBtn) closeChatBtn.textContent=L.chatClose;
    const chatIn=$('#chatIn'); if(chatIn) chatIn.placeholder=L.chatPH;
    const chatSend=$('#chatSend'); if(chatSend) chatSend.textContent=L.chatSend;
    setTxt('#mTitle', L.mTitle);
    const closeData=$('#closeData'); if(closeData) closeData.textContent=L.closeData;
  }
  applyLang();
  $('#lang').onclick = ()=>{ st.lang = st.lang==='vi'?'en':'vi'; localStorage.setItem('lang', st.lang); applyLang(); };

  /* gi·ªØ li√™n k·∫øt */
  $('#year').textContent = new Date().getFullYear(); $('#ens').textContent = st.cfg.ens || 'lightunfold.eth';
  const setHref=(id,url)=>{ const el=$(id); if(el&&url) el.href=url; };
  setHref('#cta_binance', st.cfg.links?.binance); setHref('#cta_algos', st.cfg.links?.algos);
  setHref('#bnbLink', st.cfg.links?.binance); setHref('#algosLink', st.cfg.links?.algos);
  setHref('#ctaB', st.cfg.links?.binance); setHref('#ctaA', st.cfg.links?.algos);

  $('#goTop').onclick = () => window.scrollTo({top:0, behavior:'smooth'});
  function beat(){ $('#hb').textContent = new Date().toLocaleTimeString(); const kUpd=$('#kUpd'); if(kUpd) kUpd.textContent = new Date().toLocaleString(); }
  setInterval(beat, 1000); beat();
  $('#kRev').textContent = st.rev.toLocaleString();

  /* ===== T·ª± l√†m ƒë·∫πp giao di·ªán (s·ª≠ d·ª•ng AI ƒë·ªÉ generate CSS ƒë·ªông) ===== */
  async function autoBeautify() {
    try {
      const response = await fetch(st.cfg.ai_api_url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${st.cfg.ai_api_key}` },
        body: JSON.stringify({
          model: 'mixtral-8x7b-32768',
          messages: [{ role: 'user', content: 'Generate improved CSS rules for a crypto dashboard: make it more modern, add gradients, animations for buttons and cards. Keep variables like --bg, --card. Output only CSS code.' }]
        })
      });
      const data = await response.json();
      const newCSS = data.choices[0].message.content;
      const styleEl = document.createElement('style');
      styleEl.textContent = newCSS;
      document.head.appendChild(styleEl);
      console.log('AI beautified UI!');
    } catch (e) { console.warn('AI beautify failed', e); }
  }
  if (st.cfg.ai_api_key !== 'YOUR_AI_API_KEY_HERE') autoBeautify(); // Ch·∫°y n·∫øu c√≥ key

  /* ===== T·ª± s·ª≠a ch·ªØa ch·ª©c nƒÉng (self-healing: detect error & AI fix) ===== */
  window.addEventListener('error', async (e) => {
    try {
      const errMsg = `Error: ${e.message} at ${e.filename}:${e.lineno}`;
      const response = await fetch(st.cfg.ai_api_url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${st.cfg.ai_api_key}` },
        body: JSON.stringify({
          model: 'mixtral-8x7b-32768',
          messages: [{ role: 'user', content: `Fix this JS error in a crypto web app: ${errMsg}. Provide fixed code snippet to eval.` }]
        })
      });
      const data = await response.json();
      const fixCode = data.choices[0].message.content;
      eval(fixCode); // Nguy hi·ªÉm, nh∆∞ng cho t·ª± s·ª≠a
      console.log('AI fixed error!');
    } catch (_) {}
  });

  /* ===== T·ª± c·∫≠p nh·∫≠t data realtime t·ª´ CoinGecko URL ===== */
  async function fetchRealtimeTokens() {
    try {
      const res = await fetch(`${st.cfg.coingecko_api}/simple/price?ids=bitcoin,ethereum,binancecoin,arbitrum,optimism&vs_currencies=usd&include_market_cap=true&include_24hr_change=true`);
      const data = await res.json();
      // Update top3 and freeT dynamically
      const top3 = [
        {symbol:'BTC', name:'Bitcoin', pct24h: data.bitcoin.usd_24h_change, cap: data.bitcoin.usd_market_cap, link:'https://www.coingecko.com/en/coins/bitcoin'},
        {symbol:'ETH', name:'Ethereum', pct24h: data.ethereum.usd_24h_change, cap: data.ethereum.usd_market_cap, link:'https://www.coingecko.com/en/coins/ethereum'},
        {symbol:'BNB', name:'BNB', pct24h: data.binancecoin.usd_24h_change, cap: data.binancecoin.usd_market_cap, link:'https://www.coingecko.com/en/coins/bnb'}
      ];
      const freeT = [
        {symbol:'ARB', name:'Arbitrum', pct24h: data.arbitrum.usd_24h_change, cap: data.arbitrum.usd_market_cap, link:'https://www.coingecko.com/en/coins/arbitrum'},
        {symbol:'OP', name:'Optimism', pct24h: data.optimism.usd_24h_change, cap: data.optimism.usd_market_cap, link:'https://www.coingecko.com/en/coins/optimism'}
      ];
      $('#tokenPro').innerHTML = ''; top3.forEach(t => $('#tokenPro').appendChild(cardToken(t)));
      $('#tokenFree').innerHTML = ''; freeT.forEach(t => $('#tokenFree').appendChild(cardToken(t)));
    } catch (e) { console.warn('Realtime fetch failed', e); }
  }
  setInterval(fetchRealtimeTokens, 60000); // T·ª± update m·ªói ph√∫t
  fetchRealtimeTokens();

  /* ===== T·ª± lan t·ªèa & ki·∫øm ti·ªÅn (viral referral + on-chain reward) ===== */
  const peer=localStorage.getItem('peer_id')||Math.random().toString(36).slice(2); localStorage.setItem('peer_id',peer);
  const base=location.origin+location.pathname; const myRef=`${base}?ref=${peer}&utm_source=share&utm_medium=viral&utm_campaign=ultramaster`;
  const t_enc=encodeURIComponent(document.title), u_enc=encodeURIComponent(myRef);
  const map={sh_tg:`https://t.me/share/url?url=${u_enc}&text=${t_enc}`, sh_x:`https://twitter.com/intent/tweet?text=${t_enc}&url=${u_enc}`, sh_fb:`https://www.facebook.com/sharer/sharer.php?u=${u_enc}`, sh_in:`https://www.linkedin.com/sharing/share-offsite/?url=${u_enc}`};
  for(const id in map){ const el=document.getElementById(id); if(el) el.href=map[id]; }
  document.getElementById('shareMine')?.addEventListener('click', async()=>{ 
    try{ 
      if(navigator.share){ await navigator.share({title:document.title,text:'Kh√°m Ph√° UltraMaster',url:myRef}); } 
      else { await navigator.clipboard.writeText(myRef); alert(st.lang==='vi'?'ƒê√£ sao ch√©p li√™n k·∫øt!':'Link copied!'); } 
      // T·ª± ki·∫øm ti·ªÅn: gi·∫£ ƒë·ªãnh reward on-chain cho share
      if (signer) {
        const tx = await signer.sendTransaction({ to: st.cfg.payments.eth.id, value: ethers.utils.parseEther('0.001') }); // Reward nh·ªè
        await tx.wait();
        addRevenue(0.001 * 1000); // Convert to USD estimate
      }
    }catch(_){} 
  });

  // T·ª± lan t·ªèa: auto post to X n·∫øu connected (gi·∫£ ƒë·ªãnh, c·∫ßn API)
  async function autoViral() {
    if (Math.random() < 0.1) { // 10% chance m·ªói load
      // S·ª≠ d·ª•ng AI ƒë·ªÉ generate tweet
      const response = await fetch(st.cfg.ai_api_url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${st.cfg.ai_api_key}` },
        body: JSON.stringify({
          model: 'mixtral-8x7b-32768',
          messages: [{ role: 'user', content: 'Generate a viral tweet about UltraMaster Web3 app with referral link: ' + myRef }]
        })
      });
      const data = await response.json();
      const tweet = data.choices[0].message.content;
      // Post to X (gi·∫£ ƒë·ªãnh window.open for intent)
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(tweet)}`, '_blank');
    }
  }
  autoViral();

  /* ===== Gi·ªØ nguy√™n c√°c ph·∫ßn kh√°c, ch·ªâ th√™m NFT reward cho ebooks ===== */
  const ebooks=[
    {title:"Crypto 101 (Mi·ªÖn ph√≠)", price:0, desc:"V√≠ ‚Ä¢ b·∫£o m·∫≠t ‚Ä¢ chu k·ª≥ ‚Ä¢ qu·∫£n tr·ªã v·ªën ‚Ä¢ checklist."},
    {title:"DeFi Mastery ($10)", price:10, desc:"Yield ‚Ä¢ Lending ‚Ä¢ Perp ‚Äî v·∫≠n h√†nh & t·ªëi ∆∞u."},
    {title:"Risk & Psychology ($19)", price:19, desc:"K·ª∑ lu·∫≠t ‚Ä¢ nh·∫≠t k√Ω l·ªánh ‚Ä¢ khung R:R."}
  ];
  ebooks.forEach(b=>{ const d=document.createElement('div'); d.className='card';
    d.innerHTML=`<b>${b.title}</b><div class="muted">${b.desc}</div>
    <div class="row" style="margin-top:8px"><span class="tag">$${b.price}</span><button class="btn out">ƒê·ªçc th·ª≠</button></div>
    <div class="nft-reward" title="NFT Reward"></div>`;
    d.querySelector('button').onclick = async () => {
      if (signer) {
        // Mint NFT reward on-chain (gi·∫£ ƒë·ªãnh contract)
        const nftContract = new ethers.Contract('0xNFT_ADDRESS', ['function mint()'], signer);
        await nftContract.mint();
      }
    };
    $('#ebooks').appendChild(d); });

  $('#ticker').textContent='Chu k·ª≥ ‚Ä¢ funding/oi ‚Ä¢ smart money flows‚Ä¶';
  ['L2 bridge spike','DEX volume surge','Stablecoin netflow'].forEach(k=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<b>${k}</b><div class="muted">Theo d√µi ƒëi·ªÅu ki·ªán k√≠ch ho·∫°t ‚Ä¢ ch·ªâ l√† g·ª£i √Ω ‚Äì kh√¥ng ph·∫£i khuy·∫øn ngh·ªã.</div>`;
    $('#opps').appendChild(c);
  });
  $('#refreshNow').onclick=()=>{ $('#kOpps').textContent=(+$('#kOpps').textContent||0)+Math.ceil(Math.random()*3); beat(); };

  const plans = st.cfg.premium?.plans||[]; const bundleSel=$('#bundleSel');
  plans.forEach(p=>{
    const o=document.createElement('option'); o.value=p.id; o.textContent=`${p.title} ‚Äì $${p.price}`; bundleSel.appendChild(o);
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<b>${p.title}</b><div class="muted" style="min-height:42px">${p.desc}</div>
    <div class="row" style="margin-top:8px"><span class="tag">$${p.price}</span><button class="btn" data-plan="${p.id}">Ch·ªçn</button></div>`;
    el.querySelector('button').onclick=()=>{ $('#bundleSel').value=p.id; location.hash='#supergate'; };
    $('#plans').appendChild(el);
  });

  const pay=st.cfg.payments||{}; const payList=$('#payList'); const qr=$('#qr'), payAddr=$('#payAddr');
  function setQR(text){ qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(text)}`; }
  function paintPays(){ payList.innerHTML=''; Object.entries(pay).forEach(([k,v])=>{
    const row=document.createElement('div'); row.className='paybtn'; row.role='button'; row.tabIndex=0;
    row.innerHTML=`<div><b>${v.label}</b><div class="muted mono">${v.id}</div></div><button class="copy" data-id="${v.id}">Copy</button>`;
    row.onclick=()=>selectPay(k);
    row.querySelector('.copy').onclick=(e)=>{ e.stopPropagation(); navigator.clipboard.writeText(v.id); };
    payList.appendChild(row);
  });}
  function selectPay(key){ $$('.paybtn').forEach(x=>x.classList.remove('active'));
    const v=pay[key]; const idx=Array.from(payList.children).findIndex(n=>n.querySelector('.mono')?.textContent===v.id);
    if(idx>-1) payList.children[idx].classList.add('active'); payAddr.textContent=v.id; setQR(v.qr||v.id); }
  paintPays(); const firstKey=Object.keys(pay)[0]; if(firstKey) selectPay(firstKey);

  const SECRET=String(st.cfg.premium?.unlock_code||'');
  function addRevenue(x){ st.rev=Math.max(0, st.rev+Number(x||0)); localStorage.setItem('rev', st.rev); $('#kRev').textContent=st.rev.toLocaleString(); }
  $('#doUnlock').onclick=async ()=>{ 
    const ok=(String($('#unlockCode').value||'').trim()===SECRET);
    $('#uMsg').textContent= ok ? (st.lang==='vi'?'M·ªü kh√≥a th√†nh c√¥ng!':'Unlocked!') : (st.lang==='vi'?'Sai m√£.':'Wrong code.');
    if(ok){ $('#opened').classList.remove('hidden'); localStorage.setItem('premium_unlocked','1'); addRevenue(plans.find(p=>p.id===$('#bundleSel').value)?.price||0); paintPremium(); } 
    // T·ª± ki·∫øm ti·ªÅn: n·∫øu on-chain, g·ª≠i fee affiliate
    if (signer && ok) {
      const tx = await signer.sendTransaction({ to: 'YOUR_AFFILIATE_ADDRESS', value: ethers.utils.parseEther('0.01') });
      await tx.wait();
    }
  };
  $('#remember').onclick=()=>{ localStorage.setItem('remember_code',$('#unlockCode').value||''); };
  $('#relock').onclick=()=>{ $('#opened').classList.add('hidden'); localStorage.removeItem('premium_unlocked'); };
  if(localStorage.getItem('premium_unlocked')==='1') $('#opened').classList.remove('hidden');
  function paintPremium(){ const box=$('#premium'); box.innerHTML=''; ['Playbook ƒëa khung','Checklist r·ªßi ro','B·∫£ng t√¢m l√Ω & d√≤ng ti·ªÅn','Q&A theo l·ªãch'].forEach(x=>{ const c=document.createElement('div'); c.className='card'; c.innerHTML=`<b>${x}</b><div class="muted">N·ªôi dung hi·ªÉn th·ªã sau m·ªü kh√≥a.</div>`; box.appendChild(c); }); }

  /* Chat mini v·ªõi AI realtime */
  $('#openChat').onclick=()=>{ $('#chat').style.display='flex'; if(!$('#chatBody').dataset.hi){ addBubble(st.lang==='vi'?'Ch√†o! T√¥i l√† AI h·ªó tr·ª£ ph√¢n t√≠ch.':'Hi! I\'m your analysis assistant.'); $('#chatBody').dataset.hi=1; } };
  $('#closeChat').onclick=()=> $('#chat').style.display='none';
  $('#chatSend').onclick=async ()=>{ 
    const v=$('#chatIn').value.trim(); if(!v) return; addBubble(v,'me'); $('#chatIn').value='';
    try {
      const response = await fetch(st.cfg.ai_api_url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${st.cfg.ai_api_key}` },
        body: JSON.stringify({
          model: 'mixtral-8x7b-32768',
          messages: [{ role: 'user', content: v }]
        })
      });
      const data = await response.json();
      addBubble(data.choices[0].message.content, 'ai');
    } catch (e) { addBubble('Error: AI offline', 'ai'); }
  };

  function addBubble(txt,who='ai'){ const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'ai'); b.textContent=txt; $('#chatBody').appendChild(b); $('#chatBody').scrollTop=$('#chatBody').scrollHeight; }

  function cardToken(x){
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<b>${x.symbol} ‚Ä¢ ${x.name}</b>
    <div class="muted">24h: ${x.pct24h>0?'+':''}${x.pct24h}% ‚Ä¢ Cap: $${Intl.NumberFormat().format(x.cap)}</div>
    <div class="row" style="margin-top:8px"><a class="btn out" href="${x.link}" target="_blank" rel="noopener">Xem bi·ªÉu ƒë·ªì</a>
    <button class="btn" data-sym="${x.symbol}">AI ph√¢n t√≠ch</button></div>`;
    el.querySelector('button').onclick=()=>addBubble(`Xin ph√¢n t√≠ch nhanh ${x.symbol} khung 1D/4H, m·ª©c v√¥ hi·ªáu h√≥a v√† v√πng quan s√°t.`,'me');
    return el;
  }

  /* ===== 3D EARTH: xanh d·ªãu + l·ªõp tint; Moon & √°nh trƒÉng m·ªù bay ngang ===== */
  try{
    const canvas = document.getElementById('globe3d');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    const DPR = Math.min(window.devicePixelRatio||1, 2);
    const W = canvas.clientWidth || 300, H = canvas.clientHeight || 300;
    renderer.setPixelRatio(DPR); renderer.setSize(W, H, false);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 100); camera.position.z = 6;

    // √Ånh s√°ng d·ªãu + √°m xanh
    const ambient = new THREE.AmbientLight(0x9fc9ff, 0.55); // xanh d·ªãu
    const sun = new THREE.DirectionalLight(0xffffff, 0.95); sun.position.set(6,3,4);
    scene.add(ambient, sun);

    const loader   = new THREE.TextureLoader();
    const earthTex = loader.load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg');
    const normalTx = loader.load('https://threejs.org/examples/textures/planets/earth_normal_2048.jpg');
    const specTx   = loader.load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg');
    const cloudTx  = loader.load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png');
    const moonTex  = loader.load('https://threejs.org/examples/textures/planets/moon_1024.jpg');

    const earth = new THREE.Mesh(
      new THREE.SphereGeometry(2.4, 64, 64),
      new THREE.MeshPhongMaterial({
        map: earthTex, bumpMap: normalTx, bumpScale:0.04,
        specularMap: specTx, specular: new THREE.Color('rgb(60,80,95)')
      })
    );
    scene.add(earth);

    // L·ªõp tint xanh d·ªãu l√†m Earth "green-blue"
    const tint = new THREE.Mesh(
      new THREE.SphereGeometry(2.405, 64, 64),
      new THREE.MeshBasicMaterial({ color:0x1e90ff, transparent:true, opacity:0.14 })
    );
    scene.add(tint);

    const clouds = new THREE.Mesh(
      new THREE.SphereGeometry(2.46, 64, 64),
      new THREE.MeshLambertMaterial({ map: cloudTx, transparent:true, opacity:0.40 })
    );
    scene.add(clouds);

    // M·∫∑t trƒÉng & √°nh trƒÉng d·ªãu
    const moon = new THREE.Mesh(
      new THREE.SphereGeometry(0.65, 32, 32),
      new THREE.MeshStandardMaterial({ map: moonTex, roughness:1, metalness:0 })
    );
    const moonLight = new THREE.PointLight(0xbfd4ff, 1.15, 18);
    const moonGroup = new THREE.Group(); moonGroup.add(moon); moonGroup.add(moonLight);
    scene.add(moonGroup);

    function resize(){ const w = canvas.clientWidth||300, h = canvas.clientHeight||300; renderer.setSize(w,h,false); camera.aspect=w/h; camera.updateProjectionMatrix(); }
    window.addEventListener('resize', resize);

    let t = 0; (function animate(){
      requestAnimationFrame(animate);
      earth.rotation.y  += 0.0026;
      tint.rotation.y   += 0.0026;
      clouds.rotation.y += 0.0032;
      t += 0.0022; const r = 5.2;
      moonGroup.position.set(Math.cos(t)*r, Math.sin(t*1.1)*0.8, Math.sin(t)*r*0.4);
      moonLight.position.set(0,0,0);
      renderer.render(scene, camera);
    })();
  }catch(e){ console.warn('WebGL not available, fallback static.', e); }

  // Self-heal (nguy√™n b·∫£n)
  window.addEventListener('error', ()=>{ try{ $('#plans')?.children.length || plans.forEach(p=>{ const e=document.createElement('div'); e.className='card'; e.textContent=p.title; $('#plans').appendChild(e); }); }catch(_){ } });
})();
</script>

<!-- Floating share (n√¢ng c·∫•p viral) -->
<div class="viral-share">
  <a id="sh_tg" target="_blank" title="Share Telegram">üì£</a>
  <a id="sh_x" target="_blank" title="Share X">ùïè</a>
  <a id="sh_fb" target="_blank" title="Share Facebook">ùïó</a>
  <a id="sh_in" target="_blank" title="Share LinkedIn">in</a>
</div>

<!-- Chat mini -->
<button class="btn chatfab" id="openChat">üß† Chat AI 24/7</button>
<div class="chatwin" id="chat">
  <div class="chathead"><b id="chatH">AI T√†i ch√≠nh</b><button class="btn out" id="closeChat">ƒê√≥ng</button></div>
  <div class="chatbody" id="chatBody"></div>
  <div class="chatinput">
    <input id="chatIn" placeholder="H·ªèi v·ªÅ token, k·∫ø ho·∫°ch l·ªánh‚Ä¶">
    <button class="btn" id="chatSend">G·ª≠i</button>
  </div>
</div>

<!-- Modal data -->
<div id="dataModal" class="hidden" style="position:fixed;inset:0;background:rgba(0,0,0,.55);place-items:center;z-index:99">
  <div class="card" style="width:min(95vw,960px);height:min(85vh,760px);display:flex;flex-direction:column">
    <div class="row" style="justify-content:space-between"><b id="mTitle">D·ªØ li·ªáu Premium On‚ÄëChain</b><button class="btn out" id="closeData">ƒê√≥ng</button></div>
    <pre id="dataPre" style="flex:1;margin:0;padding:12px;overflow:auto;background:#0b0f13;color:#cfe0ef;border:1px solid var(--line);border-radius:12px"></pre>
  </div>
</div>
</body>
</html>
