<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>UltraMaster V‚àû ‚Ä¢ Web3 Singularity</title>
<meta name="description" content="V‚àû: Meta-Brain ‚Ä¢ SuperGate m·ªü kh√≥a ‚Ä¢ AI 24/7 ‚Ä¢ Top token realtime ‚Ä¢ QR phong th·ªßy ‚Ä¢ ViralShare 2.0">
<meta property="og:title" content="UltraMaster V‚àû ‚Ä¢ Web3 Singularity">
<meta property="og:description" content="AI 24/7 ‚Ä¢ Token ch·ªçn l·ªçc mi·ªÖn ph√≠ ‚Ä¢ Top 3 premium ‚Ä¢ Binance & AlgosOne ‚Ä¢ ViralShare 2.0">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0b0f13">
<style>
:root{
  --bg:#0b0f13;--card:#0f141a;--line:#1e2a3a;--txt:#e9eef4;--mut:#a9b8c8;
  --brand:#7dc1ff;--accent:#ffb000;--ok:#22c55e;--bad:#ff4d4f;--pill:#101825;
  --leaf:#123524;--leaf2:#0d2a1d;--gold:#ffd38a;--shadow:rgba(0,0,0,.35);
  --halo: 0 0 0px rgba(255,176,0,0);
}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1120px;margin:0 auto;padding:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:#101825;color:#cfe0ef}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin-top:12px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;position:relative}
.btn.out{background:transparent;border:1px solid var(--line);color:var(--txt)}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
.hidden{display:none}.mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;word-break:break-all}
.footer{padding:28px 0;text-align:center;color:var(--mut)}
.light{
  --bg:#0f1216;--card:#ffffff;--line:#e4e9f2;--txt:#0a1020;--mut:#49556a;--brand:#1d4ed8;--pill:#f4f7fb;
  --accent:#ffd34d; --ok:#148c3f; --bad:#c62828;
}
.marquee{white-space:nowrap;overflow:hidden}.marquee>div{display:inline-block;animation:mar 25s linear infinite}
@keyframes mar{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.list .item{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px dashed var(--line)}
.score{min-width:64px;text-align:center;border:1px solid var(--line);border-radius:10px;padding:4px 6px;color:#ffdca8;background:#241a00}
.tag{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:2px 8px;margin:2px 4px 0 0;color:#c9d6e2;font-size:12px}
.kpi{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.kbox{background:#0f1720;border:1px solid var(--line);border-radius:12px;padding:10px}
.now{font-size:22px;font-weight:800}

/* HERO (globe + ribbon + moon glow) */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
 radial-gradient(70% 140% at 50% -10%, rgba(41,93,64,.45), transparent),
 radial-gradient(80% 120% at 50% 10%, rgba(21,58,40,.35), transparent),
 linear-gradient(180deg, rgba(22,54,37,.18), transparent)}
.ribbon{position:absolute;inset:auto -30% -10% -30%;height:140px;background:
 linear-gradient(90deg,rgba(52,115,84,.25),rgba(13,63,45,.05),rgba(52,115,84,.25));filter:blur(18px);transform:rotate(-2deg)}
.logo-hero{display:flex;align-items:center;gap:8px}
.logo-dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 0 rgba(255,176,0,.6);animation:pulse 1.6s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,176,0,.5)}70%{box-shadow:0 0 0 12px rgba(255,176,0,0)}100%{box-shadow:0 0 0 0 rgba(255,176,0,0)}}
.hero-cta{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.header-flex{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;align-items:center}
@media (max-width:900px){.header-flex{grid-template-columns:1fr}}

/* Globe */
.globe-wrap{display:grid;place-items:center;gap:8px}
.globe{width:min(280px,62vw);aspect-ratio:1;border-radius:50%;position:relative;overflow:hidden;
 background: radial-gradient(circle at 52% 45%, #0a2036 35%, #0a1830 58%, #071225 82%);
 box-shadow:0 18px 34px var(--shadow), inset 0 0 40px rgba(0,0,0,.5)}
.globe .ocean{position:absolute;inset:0;background:
 radial-gradient(60% 60% at 60% 40%, rgba(90,180,255,.35), transparent 60%),
 radial-gradient(60% 60% at 35% 65%, rgba(60,140,240,.25), transparent 60%)}
.globe .map{position:absolute;inset:-8% 0 0 0;background:
 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400"><g fill="%23ffd38a" opacity="0.72"><path d="M80 150l24-8 16 7 12 16-6 12-15 6-18-5-13-12z"/><circle cx="500" cy="150" r="60"/></g></svg>') repeat-x;
 background-size:200% 100%; animation:spin 18s linear infinite; mix-blend-mode:screen; filter:contrast(110%)}
@keyframes spin{from{background-position:0 0}to{background-position:-200% 0}}
.glow-moon{position:absolute;top:-6%;left:-6%;width:60%;height:60%;border-radius:50%;
 background:radial-gradient(circle, rgba(255,222,130,.45) 0%, rgba(255,222,130,.12) 40%, rgba(255,222,130,0) 70%)}
.ticker3{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:8px}
.ticker3 .chip{border:1px dashed var(--line);border-radius:999px;padding:4px 10px}

/* SuperGate (pay/qr) */
.paygrid{display:grid;gap:12px;grid-template-columns:1.2fr 1fr}
@media(max-width:900px){.paygrid{grid-template-columns:1fr}}
.qrbox{display:flex;gap:12px}
.qrbox img{width:132px;height:132px;border-radius:12px;border:1px solid var(--line);background:#000}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0e1720;color:var(--txt}
.note{color:#9fb3c8}
.shop-card{padding:14px;border:1px solid var(--line);border-radius:12px;background:#0e1720}
.paybtn{position:relative}
.paybtn::after{content:"";position:absolute;inset:-2px;border-radius:12px;box-shadow:0 0 18px rgba(255,176,0,.25);opacity:0;transition:.25s}
.paybtn.sel::after{opacity:1}

/* Chat */
.chatfab{position:fixed;right:16px;bottom:16px;z-index:20}
.chatwin{position:fixed;right:16px;bottom:80px;width:min(380px,92vw);max-height:70vh;display:none;flex-direction:column;background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;z-index:21}
.chathead{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--line)}
.chatbody{padding:10px;overflow:auto}
.chatinput{display:flex;gap:6px;padding:10px;border-top:1px solid var(--line)}
.chatinput input{flex:1} .bubble{padding:8px 10px;border:1px solid var(--line);border-radius:10px;margin:6px 0}
.bubble.me{background:#122033} .bubble.ai{background:#121a12}

/* Footer CTA (green band) */
.footer-cta{border:1px dashed var(--line);border-radius:14px;padding:12px;
 background:linear-gradient(180deg,rgba(18,53,36,.38),rgba(18,53,36,.18))}
.footer-cta-band{background:linear-gradient(90deg, rgba(18,53,36,.65), rgba(31,84,57,.55), rgba(18,53,36,.65));
 border:1px solid #244c36;border-radius:14px;padding:14px;color:#d9ffe8}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:99}
.modal.show{display:flex}
.modal .box{width:min(92vw,900px);height:min(80vh,700px);background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
.modal header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
.modal pre{flex:1;margin:0;padding:12px;overflow:auto;background:#0b0f13;color:#e9eef4}

/* Section titles spacing */
h3{margin:0 0 8px}
</style>
</head>
<body>
<div class="wrap">
  <!-- Top pills -->
  <div class="row">
    <span class="pill logo-hero"><span class="logo-dot"></span><b id="t_app">UltraMaster V‚àû</b></span>
    <span class="pill">ENS: <b id="ens">lightunfold.eth</b></span>
    <span class="pill">Heartbeat: <b id="hb">LIVE</b></span>
    <button class="pill" id="openData">data</button>
    <button class="pill" id="lang">VI/EN</button>
    <button class="pill" id="theme">üåó Theme</button>
  </div>

  <!-- HERO -->
  <section class="card hero">
    <div class="ribbon"></div>
    <div class="header-flex">
      <div>
        <h1 id="brand">LightUnfold ‚Ä¢ UltraMaster V‚àû</h1>
        <div class="note" id="tagline">Web3 c·ªßa b·∫°n ‚Äì Tr·ª£ l√Ω t√†i ch√≠nh AI 24/7 ‚Ä¢ Token ch·ªçn l·ªçc mi·ªÖn ph√≠ ‚Ä¢ Top 3 premium ‚Ä¢ M·ªü kh√≥a t·∫°i ch·ªó</div>
        <div class="card" style="margin-top:10px;background:#0f1720;border-color:#244c36">
          <b style="color:#d1ffe3" id="heroQuote">‚ÄúBi·∫øt s·ªõm ‚Äì Quy·∫øt ƒë·ªãnh s·ªõm ‚Äì L·ª£i th·∫ø s·ªõm.‚Äù</b><br>
          <span id="heroLine">H·ªôi t·ª•: <b>Kho√° h·ªçc tinh g·ªçn</b>, <b>Ph√¢n t√≠ch Crypto realtime</b>, <b>AI h·ªèi ƒë√°p</b>, <b>C∆° h·ªôi ƒë·∫ßu t∆∞ s·ªõm nh·∫•t</b>.</span>
        </div>
        <div class="hero-cta" style="margin-top:10px" id="belowGlobe">
          <a class="btn out" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="ctaAlgos">D√πng th·ª≠ AlgosOne ‚Üó</a>
          <a class="btn out" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="ctaBinance">M·ªü t√†i kho·∫£n Binance ‚Üó</a>
        </div>
        <div class="ticker3" id="ticker3">
          <span class="chip">BTC ‚Äî ‚Äî</span><span class="chip">ETH ‚Äî ‚Äî</span><span class="chip">USDT ‚Äî ‚Äî</span>
        </div>
      </div>
      <div class="globe-wrap">
        <div class="globe">
          <div class="ocean"></div>
          <div class="map"></div>
          <div class="glow-moon"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- KPI -->
  <div class="kpi">
    <div class="kbox"><div class="muted" id="k1">C∆° h·ªôi</div><div class="now" id="kOpps">0</div></div>
    <div class="kbox"><div class="muted" id="k2">C·∫≠p nh·∫≠t</div><div class="now" id="kUpd">‚Äî</div></div>
    <div class="kbox"><div class="muted" id="k3">ƒêang xem</div><div class="now" id="kLive">‚Äî</div></div>
    <div class="kbox"><div class="muted" id="k4">Doanh thu</div><div class="now">$<span id="kRev">0</span></div></div>
  </div>

  <!-- ORDER 1: TOP 3 (masked / unlock) -->
  <section class="card" id="secTop3">
    <h3 id="hTop3">‚≠ê Top 3 Token ti·ªÅm nƒÉng (m·ªü kh√≥a ƒë·ªÉ xem)</h3>
    <div id="tokenProMask" class="grid"></div>
    <div class="row" style="margin-top:8px"><a class="btn" href="#supergate" id="goUnlock">M·ªü kh√≥a ngay</a></div>
  </section>

  <!-- ORDER 2: Free tokens -->
  <section class="card" id="secFree">
    <h3 id="hFree">üìä Token ch·ªçn l·ªçc ƒë·ªÉ b·∫°n tham kh·∫£o c∆° h·ªôi t·ªët nh·∫•t ‚Äî c·∫≠p nh·∫≠t li√™n t·ª•c</h3>
    <div class="grid" id="tokenFree"></div>
  </section>

  <!-- ORDER 3: Academy -->
  <section class="card" id="edu">
    <h3 id="hEdu">üìö H·ªçc vi·ªán ‚Ä¢ Kho s√°ch s·ªë</h3>
    <div class="grid" id="ebooks"></div>
  </section>

  <!-- ORDER 4: Hot opportunities -->
  <section class="card" id="hot">
    <div class="row" style="justify-content:space-between">
      <h3 id="hHot">üî• C∆° h·ªôi n·ªïi b·∫≠t</h3>
      <div class="row"><span class="badge" id="scanMode">qu√©t: data</span><button class="btn out" id="refreshNow">‚Üª L√†m m·ªõi</button></div>
    </div>
    <div class="marquee" style="margin:4px 0 8px;color:#bcd"><div id="ticker">‚Äî</div></div>
    <div id="opps" class="list"></div>
  </section>

  <!-- ORDER 5: Premium bundles (with price) -->
  <section class="card" id="bundles">
    <h3 id="hBundles">üß∞ G√≥i Premium</h3>
    <div id="bundleWrap" class="grid"></div>
  </section>

  <!-- ORDER 6: SUPERGATE (Payments + Unlock inline) -->
  <section class="card" id="supergate">
    <h3 id="hGate">üîì C·ª≠a m·ªü kho√° (SuperGate)</h3>
    <div class="paygrid">
      <!-- Left: Payment compact -->
      <div class="card" style="background:#0f1720">
        <div class="qrbox">
          <img id="qr" alt="QR" src="" loading="lazy">
          <div style="flex:1;min-width:0">
            <div class="note" id="gatePitch"><b>Xem Top 3 & kho ki·∫øn th·ª©c tinh g·ªçn?</b> Thanh to√°n nh·ªè ‚Üí nh·∫≠n <b>m√£ m·ªü kh√≥a</b> t·∫°i ƒë√¢y.</div>
            <div class="note"><span id="addrLabel">ƒê·ªãa ch·ªâ/ID</span>: <span class="mono" id="payAddr">‚Äî</span></div>
            <div class="note" id="minHint">T·ªëi thi·ªÉu: ETH ‚â• 0.0005 ‚Ä¢ USDT ‚â• 5</div>
            <div class="row" style="margin-top:8px;gap:8px;flex-wrap:wrap" id="payList"></div>
            <div class="row" style="margin-top:8px;gap:8px">
              <button class="btn out" id="copyAddrBtn">üìã Sao ch√©p</button>
              <a class="btn out" id="openQR" download>‚ö° T·∫£i QR</a>
              <a class="btn out" id="openExplorer" target="_blank" rel="noopener">üîé Explorer</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Right: Choose bundle + unlock input -->
      <div class="card" style="background:#0f1720">
        <div class="grid" style="grid-template-columns:1fr">
          <div>
            <label class="note" id="selBundle">Ch·ªçn g√≥i</label>
            <select id="bundleSel" class="input"></select>
          </div>
          <div>
            <label class="note" id="unlockLabel">Nh·∫≠p m√£ m·ªü kho√°</label>
            <input id="unlockCode" class="input" placeholder="Nh·∫≠p m√£‚Ä¶">
          </div>
          <div><input id="txhash" class="input" placeholder="(Tu·ª≥ ch·ªçn) D√°n TX hash / ghi ch√∫"></div>
          <div class="row">
            <button class="btn" id="doUnlock">M·ªü kho√°</button>
            <button class="btn out" id="remember">Nh·ªõ m√£</button>
          </div>
          <div id="uMsg" class="note"></div>
          <div class="note" style="margin-top:6px" id="unlockHint">M·ªü kho√° xong, premium hi·ªÉn th·ªã ngay b√™n d∆∞·ªõi. M√£ ƒë∆∞·ª£c l∆∞u tr√™n thi·∫øt b·ªã.</div>
        </div>
      </div>
    </div>

    <!-- Premium detail (after unlock) -->
    <div id="opened" class="hidden" style="margin-top:12px">
      <div class="row"><span class="pill ok" id="unlockedLbl">‚úî ƒê√£ m·ªü kh√≥a</span><button class="btn out" id="relock">Kho√° l·∫°i</button></div>
      <div id="premium" class="grid" style="margin-top:10px"></div>
    </div>
  </section>

  <!-- ORDER 7: AlgosOne intro -->
  <section class="card" id="ag">
    <h3>ü§ù AlgosOne ‚Äì AI giao d·ªãch th·ª±c chi·∫øn</h3>
    <div class="grid">
      <div class="shop-card">
        <h4 id="agTitle">T·ª´ d·ªØ li·ªáu ‚Üí chi·∫øn l∆∞·ª£c ‚Üí k·ª∑ lu·∫≠t</h4>
        <div class="note" id="agCopy">
          ‚Ä¢ Machine Learning g·ª£i √Ω l·ªánh theo r·ªßi ro ‚Ä¢ C·∫£nh b√°o realtime ‚Ä¢ Backtest t·ª©c th√¨ ‚Ä¢ K·∫øt n·ªëi ƒëa s√†n<br>
          ‚Ä¢ T·ªëi ∆∞u chi·∫øn l∆∞·ª£c c√° nh√¢n (R/R, win-rate, max-drawdown) ‚Ä¢ API m·ªü k·∫øt n·ªëi h·ªá th·ªëng c·ªßa b·∫°n
        </div>
        <a class="btn" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="agCTA">D√πng th·ª≠ mi·ªÖn ph√≠ ‚Üó</a>
      </div>
    </div>
  </section>

  <!-- ORDER 8: Binance intro -->
  <section class="card" id="bn">
    <h3>ü§ù Binance ‚Äì c·ªïng thanh kho·∫£n s·ªë 1</h3>
    <div class="grid">
      <div class="shop-card">
        <h4 id="bnTitle">N∆°i d√≤ng ti·ªÅn h·ªôi t·ª•</h4>
        <div class="note" id="bnCopy">
          ‚Ä¢ Ph√≠ c·∫°nh tranh ‚Ä¢ Thanh kho·∫£n s√¢u ‚Ä¢ Earn/Futures/Options ‚Ä¢ Launchpad/Launchpool ‚Ä¢ B·∫£o m·∫≠t & API m·∫°nh<br>
          ‚Ä¢ T·ªëi ∆∞u ph√≠ & t·ªëc ƒë·ªô kh·ªõp l·ªánh cho nh√† ƒë·∫ßu t∆∞ nghi√™m t√∫c
        </div>
        <a class="btn" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="bnCTA">M·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ‚Üó</a>
      </div>
    </div>
  </section>

  <!-- ORDER 9: CTA cu·ªëi (green band) -->
  <section class="card footer-cta">
    <div class="footer-cta-band">
      <h3 style="margin:0 0 6px" id="ctaEndTitle">üöÄ C∆° h·ªôi kh√¥ng ch·ªù ƒë·ª£i ‚Äì b·∫°n c≈©ng ƒë·ª´ng ch·ªù!</h3>
      <div id="ctaEndCopy">M·ªü kh√≥a nh·ªè ho·∫∑c m·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ngay h√¥m nay ƒë·ªÉ v√†o h·ªá th·ªëng <b>AI t√†i ch√≠nh 24/7</b> ‚Äì n∆°i m·ªçi nh·ªãp th·ªã tr∆∞·ªùng ƒë·ªÅu trong t·∫ßm tay.</div>
      <div class="row" style="margin-top:8px">
        <a class="btn" href="#supergate" id="ctaUnlock">M·ªü kh√≥a ngay</a>
        <a class="btn out" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="ctaAg2">D√πng th·ª≠ AlgosOne ‚Üó</a>
        <a class="btn out" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="ctaBn2">ƒêƒÉng k√Ω Binance ‚Üó</a>
        <button class="btn out" id="shareMine">Chia s·∫ª li√™n k·∫øt c·ªßa t√¥i</button>
      </div>
    </div>
  </section>

  <button class="pill" id="goTop" style="position:fixed;left:12px;bottom:80px;z-index:9">‚Üë Top</button>
  <div class="footer">¬© <span id="year"></span> LightUnfold ‚Ä¢ <span id="autoLbl">T·ª± ƒë·ªông 24/7</span></div>
</div>

<!-- Share floating -->
<div class="sharebar" style="position:fixed;right:12px;bottom:12px;display:flex;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px;z-index:9">
  <a id="sh_tg" target="_blank" title="Share Telegram">üì£</a>
  <a id="sh_x"  target="_blank" title="Share X/Twitter">ùïè</a>
  <a id="sh_fb" target="_blank" title="Share Facebook">f</a>
  <a id="sh_in" target="_blank" title="Share LinkedIn">in</a>
</div>

<!-- Chat 24/7 -->
<button class="btn chatfab" id="openChat">üß† Chat AI 24/7</button>
<div class="chatwin" id="chat" role="dialog" aria-label="AI Chat">
  <div class="chathead"><b id="chatTitle">AI T√†i Ch√≠nh 24/7</b><button class="btn out" id="closeChat">ƒê√≥ng</button></div>
  <div class="chatbody" id="chatBody"></div>
  <div style="padding:0 10px" id="chipBar"></div>
  <div class="chatinput">
    <input id="chatIn" class="input" placeholder="H·ªèi th·ªã tr∆∞·ªùng, token, k·∫ø ho·∫°ch l·ªánh‚Ä¶">
    <button class="btn" id="chatSend">G·ª≠i</button>
  </div>
</div>

<!-- Modal data -->
<div id="dataModal" class="modal" aria-modal="true">
  <div class="box">
    <header>
      <b id="dataTitle">D·ªØ li·ªáu Premium</b>
      <div class="row">
        <button class="btn out" id="closeData">ƒê√≥ng</button>
      </div>
    </header>
    <pre id="dataPre"></pre>
  </div>
</div>

<script>
/* ===== helpers ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
function setTheme(m){document.documentElement.classList.toggle('light',m==='light');localStorage.setItem('theme',m)}
setTheme(localStorage.getItem('theme')||'dark'); $('#theme')?.addEventListener('click',()=>setTheme(document.documentElement.classList.contains('light')?'dark':'light'));
const fmt=n=>Number(n||0).toLocaleString(undefined,{maximumFractionDigits:8});
const qrlink=t=>`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(t)}`;
async function j(url){try{const r=await fetch(url,{cache:'no-store'});if(!r.ok) throw 0;return await r.json()}catch(_){return null}}
$('#year').textContent=new Date().getFullYear();
$('#goTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

/* ===== i18n full ===== */
let LANG=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';
const I18N={
 vi:{
  app:"UltraMaster V‚àû", tag:"Web3 c·ªßa b·∫°n ‚Äì Tr·ª£ l√Ω t√†i ch√≠nh AI 24/7 ‚Ä¢ Token ch·ªçn l·ªçc mi·ªÖn ph√≠ ‚Ä¢ Top 3 premium ‚Ä¢ M·ªü kh√≥a t·∫°i ch·ªó",
  quote:"‚ÄúBi·∫øt s·ªõm ‚Äì Quy·∫øt ƒë·ªãnh s·ªõm ‚Äì L·ª£i th·∫ø s·ªõm.‚Äù",
  line:"H·ªôi t·ª•: <b>Kho√° h·ªçc tinh g·ªçn</b>, <b>Ph√¢n t√≠ch Crypto realtime</b>, <b>AI h·ªèi ƒë√°p</b>, <b>C∆° h·ªôi ƒë·∫ßu t∆∞ s·ªõm nh·∫•t</b>.",
  k1:"C∆° h·ªôi",k2:"C·∫≠p nh·∫≠t",k3:"ƒêang xem",k4:"Doanh thu",
  top3:"‚≠ê Top 3 Token ti·ªÅm nƒÉng (m·ªü kh√≥a ƒë·ªÉ xem)", goUnlock:"M·ªü kh√≥a ngay",
  free:"üìä Token ch·ªçn l·ªçc ƒë·ªÉ b·∫°n tham kh·∫£o c∆° h·ªôi t·ªët nh·∫•t ‚Äî c·∫≠p nh·∫≠t li√™n t·ª•c",
  edu:"üìö H·ªçc vi·ªán ‚Ä¢ Kho s√°ch s·ªë",
  hot:"üî• C∆° h·ªôi n·ªïi b·∫≠t", scan:"qu√©t: data",
  bundles:"üß∞ G√≥i Premium",
  gate:"üîì C·ª≠a m·ªü kho√° (SuperGate)", pitch:"Xem Top 3 & kho ki·∫øn th·ª©c tinh g·ªçn? Thanh to√°n nh·ªè ‚Üí nh·∫≠n <b>m√£ m·ªü kh√≥a</b> t·∫°i ƒë√¢y.",
  addr:"ƒê·ªãa ch·ªâ/ID", min:"T·ªëi thi·ªÉu: ETH ‚â• 0.0005 ‚Ä¢ USDT ‚â• 5", choose:"Ch·ªçn g√≥i", unlock:"Nh·∫≠p m√£ m·ªü kho√°",
  unlocked:"‚úî ƒê√£ m·ªü kh√≥a", save:"Nh·ªõ m√£", lockAgain:"Kho√° l·∫°i",
  hint:"M·ªü kho√° xong, premium hi·ªÉn th·ªã ngay b√™n d∆∞·ªõi. M√£ ƒë∆∞·ª£c l∆∞u tr√™n thi·∫øt b·ªã.",
  dataT:"D·ªØ li·ªáu Premium", dataOpen:"Xem d·ªØ li·ªáu", copy:"üìã Sao ch√©p", explorer:"üîé Explorer", dlQR:"‚ö° T·∫£i QR",
  algosH:"T·ª´ d·ªØ li·ªáu ‚Üí chi·∫øn l∆∞·ª£c ‚Üí k·ª∑ lu·∫≠t", algosCTA:"D√πng th·ª≠ mi·ªÖn ph√≠ ‚Üó",
  binH:"N∆°i d√≤ng ti·ªÅn h·ªôi t·ª•", binCTA:"M·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ‚Üó",
  ctaEnd:"üöÄ C∆° h·ªôi kh√¥ng ch·ªù ƒë·ª£i ‚Äì b·∫°n c≈©ng ƒë·ª´ng ch·ªù!",
  ctaCopy:"M·ªü kh√≥a nh·ªè ho·∫∑c m·ªü t√†i kho·∫£n mi·ªÖn ph√≠ ngay h√¥m nay ƒë·ªÉ v√†o h·ªá th·ªëng <b>AI t√†i ch√≠nh 24/7</b> ‚Äì n∆°i m·ªçi nh·ªãp th·ªã tr∆∞·ªùng ƒë·ªÅu trong t·∫ßm tay.",
  ctaUnlock:"M·ªü kh√≥a ngay", auto:"T·ª± ƒë·ªông 24/7",
  freeOpen:"M·ªü bi·ªÉu ƒë·ªì ‚Üó", freeAI:"AI ph√¢n t√≠ch nhanh", details:"Chi ti·∫øt ‚Üó",
  invalid:"M√£ kh√¥ng ƒë√∫ng.", saved:"ƒê√£ l∆∞u tr√™n thi·∫øt b·ªã.", ok:"‚úî ƒê√£ m·ªü kh√≥a",
  chatTitle:"AI T√†i Ch√≠nh 24/7", chatHello:"Ch√†o b·∫°n! 70% n·ªôi dung mi·ªÖn ph√≠, Top 3 c·∫ßn m·ªü kho√°.",
  askPH:"H·ªèi th·ªã tr∆∞·ªùng, token, k·∫ø ho·∫°ch l·ªánh‚Ä¶"
 },
 en:{
  app:"UltraMaster V‚àû", tag:"Your Web3 ‚Äì 24/7 Finance AI ‚Ä¢ Curated free tokens ‚Ä¢ Top 3 premium ‚Ä¢ On-site unlock",
  quote:"‚ÄúKnow early ‚Äì Decide early ‚Äì Win early.‚Äù",
  line:"Where <b>Lean Courses</b>, <b>Realtime Crypto Analytics</b>, <b>AI Q&A</b> and <b>Earliest Opportunities</b> converge.",
  k1:"Opportunities",k2:"Updated",k3:"Live peers",k4:"Revenue",
  top3:"‚≠ê Top 3 picks (unlock to view)", goUnlock:"Unlock now",
  free:"üìä Curated tokens for best opportunities ‚Äî continuously refreshed",
  edu:"üìö Academy ‚Ä¢ E-book Library",
  hot:"üî• Hot opportunities", scan:"scan: data",
  bundles:"üß∞ Premium Bundles",
  gate:"üîì SuperGate (Unlock)", pitch:"See Top 3 & the lean knowledge vault? Small payment ‚Üí receive <b>unlock code</b> here.",
  addr:"Address/ID", min:"Minimum: ETH ‚â• 0.0005 ‚Ä¢ USDT ‚â• 5", choose:"Choose bundle", unlock:"Enter unlock code",
  unlocked:"‚úî Unlocked", save:"Remember", lockAgain:"Lock again",
  hint:"After unlocking, premium appears below. Code is saved on your device.",
  dataT:"Premium Data", dataOpen:"Open data", copy:"üìã Copy", explorer:"üîé Explorer", dlQR:"‚ö° Download QR",
  algosH:"From data ‚Üí strategy ‚Üí discipline", algosCTA:"Try for free ‚Üó",
  binH:"Where liquidity converges", binCTA:"Open a free account ‚Üó",
  ctaEnd:"üöÄ Opportunity won‚Äôt wait ‚Äî neither should you!",
  ctaCopy:"Unlock or open a free account today to enter the <b>24/7 Finance AI</b> system ‚Äî every market beat in your hands.",
  ctaUnlock:"Unlock now", auto:"Always-on 24/7",
  freeOpen:"Open chart ‚Üó", freeAI:"AI quick take", details:"Details ‚Üó",
  invalid:"Invalid code.", saved:"Saved on device.", ok:"‚úî Unlocked",
  chatTitle:"24/7 Finance AI", chatHello:"Hi! 70% is free, Top 3 requires unlock.",
  askPH:"Ask about market, tokens, plan‚Ä¶"
 }};
function applyI18N(){
  const t=I18N[LANG];
  $('#t_app').textContent=t.app; $('#tagline').innerHTML=t.tag; $('#heroQuote').textContent=t.quote; $('#heroLine').innerHTML=t.line;
  $('#k1').textContent=t.k1; $('#k2').textContent=t.k2; $('#k3').textContent=t.k3; $('#k4').textContent=t.k4;
  $('#hTop3').textContent=t.top3; $('#goUnlock').textContent=t.goUnlock;
  $('#hFree').textContent=t.free; $('#hEdu').textContent=t.edu; $('#hHot').textContent=t.hot; $('#scanMode').textContent=t.scan;
  $('#hBundles').textContent=t.bundles; $('#hGate').textContent=t.gate; $('#gatePitch').innerHTML=t.pitch;
  $('#addrLabel').textContent=t.addr; $('#minHint').textContent=t.min; $('#selBundle').textContent=t.choose; $('#unlockLabel').textContent=t.unlock;
  $('#unlockedLbl').textContent=t.unlocked; $('#remember').textContent=t.save; $('#relock').textContent=t.lockAgain; $('#unlockHint').textContent=t.hint;
  $('#dataTitle').textContent=t.dataT; $('#openData').textContent='data'; $('#copyAddrBtn').textContent=t.copy; $('#openExplorer').textContent=t.explorer; $('#openQR').textContent=t.dlQR;
  $('#agTitle').textContent=t.algosH; $('#agCTA').textContent=t.algosCTA; $('#bnTitle').textContent=t.binH; $('#bnCTA').textContent=t.binCTA;
  $('#ctaEndTitle').textContent=t.ctaEnd; $('#ctaEndCopy').innerHTML=t.ctaCopy; $('#ctaUnlock').textContent=t.ctaUnlock; $('#autoLbl').textContent=t.auto;
  $('#chatTitle').textContent=t.chatTitle; $('#chatIn').placeholder=t.askPH;
  // Buttons already bound in render; labels on cards use i18n at render time.
}
$('#lang').addEventListener('click',()=>{LANG=LANG==='vi'?'en':'vi';localStorage.setItem('lang',LANG);applyI18N(); paintBundles(); paintPremium(); paintEdu(); renderAll(LAST_ITEMS); renderTop3Mask(LAST_ITEMS);});

/* ===== Config ===== */
const CFG={
  site:{brand:"LightUnfold ‚Ä¢ UltraMaster V‚àû",ens:"lightunfold.eth",
    payments:{chains:[
      {name:"ETH (EVM)",address:"0x54E15A7b6d4213beE87800432A151d794638E3C2",explorer:"https://etherscan.io/address/0x54E15A7b6d4213beE87800432A151d794638E3C2",min:0.0005},
      {name:"USDT (ERC20)",address:"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",explorer:"https://etherscan.io/token/USDT?a=0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",min:5},
      {name:"MoMo",address:"0567892030"},
      {name:"Vietcombank",address:"9567892030"},
      {name:"PayPal",address:"vumumabada@gmail.com"}
    ]},
  },
  secrets:{unlock_code:"23061988"},
  store:{
    bundles:[
      {id:"alpha",title:"Alpha Signals X",price:19,desc_vi:"T√≠n hi·ªáu ng·∫Øn h·∫°n x√°c su·∫•t cao.",desc_en:"High-probability short-term signals."},
      {id:"etfbtc",title:"ETF & BTC Flow",price:29,desc_vi:"D√≤ng v·ªën ETF/BTC ‚Äì macro view.",desc_en:"ETF/BTC flow ‚Äì macro view."},
      {id:"alts",title:"Altseason Radar",price:10,desc_vi:"Chu k·ª≥ xoay v√≤ng v·ªën.",desc_en:"Capital rotation cycles."}
    ],
    premium:[
      {title:"Alpha Feed Pro",desc_vi:"D√≤ng tin alpha si√™u nhanh (ƒë·ªô tr·ªÖ ms).",desc_en:"Ultra-fast alpha feed (ms latency).",
       bullets_vi:["B·∫•t th∆∞·ªùng d√≤ng ti·ªÅn","Ngu·ªìn ƒëa k√™nh","B·ªô l·ªçc nhi·ªÖu"],bullets_en:["Flow anomalies","Multi-source","Noise filters"]},
      {title:"Deal Flow Private",desc_vi:"T·ªïng h·ª£p deal/seed ƒëang m·ªü private.",desc_en:"Active private/seed deal flow.",
       bullets_vi:["ƒêi·ªÅu ki·ªán","∆Øu ti√™n th·ªùi gian"],bullets_en:["Terms","Time priority"]}
    ],
    edu:[
      {title:"Crypto 101",tag_vi:"Mi·ªÖn ph√≠",tag_en:"Free",
       desc_vi:"V√≠ & b·∫£o m·∫≠t ‚Ä¢ Chu k·ª≥ ‚Ä¢ Qu·∫£n tr·ªã v·ªën ‚Ä¢ Checklist th·ª±c chi·∫øn.",desc_en:"Wallet & security ‚Ä¢ Cycles ‚Ä¢ Risk capital ‚Ä¢ Practical checklist."},
      {title:"DeFi Mastery",tag_vi:"N√¢ng cao",tag_en:"Advanced",
       desc_vi:"Yield ‚Ä¢ Lending ‚Ä¢ Perp ‚Ä¢ Case study.",desc_en:"Yield ‚Ä¢ Lending ‚Ä¢ Perp ‚Ä¢ Case studies."},
      {title:"Risk & Psychology",tag_vi:"Chuy√™n s√¢u",tag_en:"Pro",
       desc_vi:"K·ª∑ lu·∫≠t ‚Ä¢ R:R ‚Ä¢ H·ªá th·ªëng h√≥a quy·∫øt ƒë·ªãnh.",desc_en:"Discipline ‚Ä¢ R:R ‚Ä¢ Decision systems."}
    ]
  }
};
/* Header apply */
$('#brand').textContent=CFG.site.brand; $('#ens').textContent=CFG.site.ens; applyI18N();

/* ===== BTC/ETH/USDT ticker ===== */
async function tick3(){
  try{
    const ids=['bitcoin','ethereum','tether'].join(',');
    const r=await j('https://api.coingecko.com/api/v3/simple/price?ids='+ids+'&vs_currencies=usd&include_24hr_change=true');
    if(!r) return;
    const m=[
      {k:'BTC',p:r.bitcoin?.usd, c:r.bitcoin?.usd_24h_change},
      {k:'ETH',p:r.ethereum?.usd, c:r.ethereum?.usd_24h_change},
      {k:'USDT',p:r.tether?.usd, c:r.tether?.usd_24h_change}
    ];
    $('#ticker3').innerHTML=m.map(o=>`<span class="chip">${o.k} $${fmt(o.p)} <b class="${(o.c||0)>=0?'ok':'bad'}">${(o.c||0).toFixed(2)}%</b></span>`).join('');
  }catch(_){}
}
setInterval(tick3, 8000); tick3();

/* ===== Market data ===== */
let LAST_ITEMS=[];
async function fetchLive(){
  const latest=await j('data/latest.json'); // optional feed
  if(latest && Array.isArray(latest.items)){ LAST_ITEMS=latest.items; renderAll(LAST_ITEMS); renderTop3Mask(LAST_ITEMS); return; }
  try{
    const cg=await j('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=60&page=1&price_change_percentage=1h,24h,7d');
    const items=(cg||[]).map(c=>({source:"coingecko",symbol:(c.symbol||"").toUpperCase(),name:c.name,price:+c.current_price||0,
      ch24h:+c.price_change_percentage_24h_in_currency||0,vol24h:+c.total_volume||0,
      mcap:+c.market_cap||0, link:`https://www.coingecko.com/en/coins/${c.id}`,
      score:(+c.price_change_percentage_1h_in_currency||0)*0.4+(+c.price_change_percentage_24h_in_currency||0)*0.35+(+c.price_change_percentage_7d_in_currency||0)*0.25+Math.log10((+c.total_volume||1))}));
    const bestBySymbol={}; for(const it of items){const k=it.symbol; if(!bestBySymbol[k]||it.score>bestBySymbol[k].score) bestBySymbol[k]=it;}
    LAST_ITEMS=Object.values(bestBySymbol).sort((a,b)=>b.score-a.score).slice(0,20);
    renderAll(LAST_ITEMS); renderTop3Mask(LAST_ITEMS);
  }catch(_){}
}
function renderTop3Mask(items){
  const t=I18N[LANG];
  const pro = (items||[]).slice(0,3);
  $('#tokenProMask').innerHTML=pro.map((x,i)=>`
    <div class="shop-card">
      <h4>‚≠ê #${i+1}</h4>
      <div class="note">${x.symbol} ‚Ä¢ Price/Vol/7d ‚Ä¢ ${LANG==='vi'?'Chi·∫øn l∆∞·ª£c v√†o/ra an to√†n':'Safe in/out plan'}.</div>
      <a class="btn" href="#supergate">${t.goUnlock}</a>
    </div>`).join('') || `<div class="note">‚Äî</div>`;
}
function renderAll(items){
  const t=I18N[LANG];
  // ticker + hot
  $('#kOpps').textContent=items.length; $('#ticker').innerHTML=items.slice(0,12).map(x=>`<span class="tag">${x.symbol}: $${fmt(x.price)} (${(x.ch24h||0).toFixed(2)}%)</span>`).join('')||'‚Äî';
  $('#opps').innerHTML=items.slice(0,10).map(x=>{
    const ch=x.ch24h||0,pct=`${ch>=0?'+':''}${ch.toFixed(2)}%`;
    return `<div class="item"><div class="score">+${(x.score||0).toFixed(2)}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div><b>${x.symbol}</b> ¬∑ <span class="muted">${x.name||''}</span></div>
          <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${t.details}</a></div>
        <div class="row" style="gap:8px">
          <span class="tag">${LANG==='vi'?'Gi√°':'Price'}: $${fmt(x.price||0)}</span>
          <span class="tag ${ch>=0?'ok':'bad'}">24h: ${pct}</span>
          <span class="tag">Vol: $${fmt(x.vol24h||0)}</span>
        </div></div></div>`;
  }).join('');
  // Free 7
  const free = items.slice(0,7);
  $('#tokenFree').innerHTML=free.map(x=>{
    const c=x.ch24h||0, rr=c>=0?'ok':'bad';
    return `<div class="shop-card">
      <h4>${x.symbol} ‚Äî ${x.name||''}</h4>
      <div class="note">${LANG==='vi'?'Gi√°':'Price'}: $${fmt(x.price)} ¬∑ <b class="${rr}">${c.toFixed(2)}%</b> ¬∑ Vol: $${fmt(x.vol24h)}</div>
      <div class="row" style="margin-top:8px">
        <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${t.freeOpen}</a>
        <button class="btn out" onclick="aiHint('${x.symbol}')">${t.freeAI}</button>
      </div>
    </div>`;
  }).join('');
}

/* ===== Bundles + Premium ===== */
function paintBundles(){
  const t=I18N[LANG];
  $('#bundleWrap').innerHTML=CFG.store.bundles.map(b=>{
    const desc = LANG==='vi' ? b.desc_vi : b.desc_en;
    return `<div class="shop-card">
      <h4>${b.title}</h4>
      <div class="note">${desc||''}</div>
      <div class="row" style="margin-top:8px"><span class="badge">$${b.price}</span><a class="btn out" href="#supergate">${t.goUnlock}</a></div>
    </div>`;
  }).join('');
}
function paintPremium(){
  const t=I18N[LANG];
  $('#premium').innerHTML=CFG.store.premium.map(p=>{
    const desc = LANG==='vi'?p.desc_vi:p.desc_en;
    const bullets = (LANG==='vi'?p.bullets_vi:p.bullets_en)||[];
    return `<div class="shop-card"><h4>${p.title}</h4>
      <div class="note">${desc||''}</div>
      ${bullets.length?`<ul>${bullets.map(x=>`<li>${x}</li>`).join('')}</ul>`:""}
      <button class="btn out" onclick="openDataModal()">${t.dataOpen} ‚Üó</button>
    </div>`;
  }).join('');
}
function paintEdu(){
  $('#ebooks').innerHTML=CFG.store.edu.map(e=>{
    const tag = LANG==='vi'?e.tag_vi:e.tag_en;
    const desc = LANG==='vi'?e.desc_vi:e.desc_en;
    return `<div class="shop-card">
      <h4>${e.title}</h4><div class="note">${desc}</div>
      <div class="row" style="margin-top:8px"><span class="badge">${tag}</span></div>
    </div>`;
  }).join('');
}
paintBundles(); paintPremium(); paintEdu();

/* ===== Payments: selectable + copy + explorer ===== */
const pays=CFG.site.payments.chains;
let curPay = null;
function selectPay(idx=0){
  const c=pays[idx]; if(!c) return;
  curPay=c;
  $('#qr').src=qrlink(c.address);
  $('#payAddr').textContent=c.address;
  $('#openQR').href=qrlink(c.address);
  $('#openExplorer').href=c.explorer||'#';
  $$('#payList .btn').forEach((b,i)=>b.classList.toggle('sel',i===idx));
}
(function paintPay(){
  $('#payList').innerHTML=pays.map((c,i)=>`<button class="btn out paybtn" data-i="${i}">${c.name}</button>`).join('');
  $('#payList').addEventListener('click',e=>{const b=e.target.closest('button'); if(!b) return; selectPay(+b.dataset.i||0);});
  $('#copyAddrBtn').onclick=()=>{navigator.clipboard.writeText($('#payAddr').textContent||''); $('#copyAddrBtn').textContent=I18N[LANG].copy+' ‚úì'; setTimeout(()=>$('#copyAddrBtn').textContent=I18N[LANG].copy,1200);}
  selectPay(0);
})();

/* ===== Paywall ===== */
const SECRET=String(CFG.secrets.unlock_code||'23061988');
function gate(open){$('#opened').classList.toggle('hidden',!open);}
(function bindPaywall(){
  const saved=localStorage.getItem('unlocked_code')||'';
  if(saved===SECRET){gate(true); paintPremium(); const th=localStorage.getItem('tx_hash'); if(th) $('#uMsg').innerHTML='<span class="ok">TX: '+th+'</span>';}
  $('#doUnlock').onclick=()=>{const code=$('#unlockCode').value.trim(),tx=$('#txhash').value.trim();
    if(code===SECRET){gate(true); paintPremium(); $('#uMsg').innerHTML='<span class="ok">'+I18N[LANG].ok+'</span>'; if(tx) localStorage.setItem('tx_hash',tx); localStorage.setItem('unlocked_code',code);}
    else $('#uMsg').innerHTML='<span class="bad">'+I18N[LANG].invalid+'</span>';};
  $('#remember').onclick=()=>{const c=$('#unlockCode').value.trim(); if(c){localStorage.setItem('unlocked_code',c); $('#uMsg').textContent=I18N[LANG].saved}};
  $('#relock').onclick=()=>{localStorage.removeItem('unlocked_code'); gate(false);};
})();

/* ===== AI Chat (hooks ready) ===== */
function addBubble(txt, who='ai'){
  const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'ai'); b.innerHTML=txt; $('#chatBody').appendChild(b); $('#chatBody').scrollTop=1e6;
}
function aiHint(sym){
  addBubble((LANG==='vi'?'Ph√¢n t√≠ch nhanh ':'Quick take ')+`<b>${sym}</b>: ${(LANG==='vi'?'Kh·ªëi l∆∞·ª£ng & ƒë√† gi√° ƒëang ƒë∆∞·ª£c theo d√µi. M·ªü kh√≥a Top 3 ƒë·ªÉ xem chi·∫øn l∆∞·ª£c v√†o/ra.':'Momentum & volume under watch. Unlock Top 3 for in/out plan.')}`);
}
(function chatInit(){
  const t=I18N[LANG];
  const chips=[LANG==='vi'?'T√≥m t·∫Øt th·ªã tr∆∞·ªùng':'Market summary',LANG==='vi'?'Token ti·ªÅm nƒÉng h√¥m nay':'Today‚Äôs picks',LANG==='vi'?'K·∫ø ho·∫°ch l·ªánh an to√†n':'Safe trade plan',LANG==='vi'?'C√°ch m·ªü kh√≥a':'How to unlock',LANG==='vi'?'L·∫•y link chia s·∫ª':'My share link'];
  const bar=$('#chipBar'); bar.innerHTML=''; chips.forEach(txt=>{const b=document.createElement('button'); b.className='btn out'; b.textContent=txt; b.onclick=()=>{$('#chatIn').value=txt; $('#chatSend').click();}; bar.appendChild(b);});
  $('#openChat').onclick=()=>{$('#chat').style.display='flex'; if(!$('#chatBody').dataset.hi){addBubble(t.chatHello); $('#chatBody').dataset.hi=1;}};
  $('#closeChat').onclick=()=>{$('#chat').style.display='none'};
  $('#chatSend').onclick=()=>{const v=$('#chatIn').value.trim(); if(!v) return; addBubble(v,'me'); $('#chatIn').value='';
    // AI-HOOK: place meta-brain endpoint here if needed
    const s=v.toLowerCase(); let ans='';
    if(/unlock|m·ªü kh√≥a|thanh to√°n|premium/.test(s)) ans = (LANG==='vi'?'B∆∞·ªõc 1: Ch·ªçn ph∆∞∆°ng th·ª©c & thanh to√°n ‚Ä¢ B∆∞·ªõc 2: Nh·∫≠n m√£ ‚Ä¢ B∆∞·ªõc 3: Nh·∫≠p t·∫°i SuperGate ƒë·ªÉ m·ªü Top 3 & kho ki·∫øn th·ª©c.':'Step 1: Pick method & pay ‚Ä¢ Step 2: Get code ‚Ä¢ Step 3: Enter at SuperGate to unlock Top 3 & vault.');
    else if(/token|ti·ªÅm nƒÉng|coin|pick/.test(s)){
      const top=(LAST_ITEMS||[]).slice(0,5).map(x=>`${x.symbol} $${fmt(x.price)} (${(x.ch24h||0).toFixed(1)}%)`).join(' ‚Ä¢ ');
      ans=(LANG==='vi'?'Theo bi·∫øn ƒë·ªông hi·ªán t·∫°i: ':'Based on momentum: ')+top+(LANG==='vi'?'. M·ªü Top 3 ƒë·ªÉ xem chi·∫øn l∆∞·ª£c v√†o/ra.':'. Unlock Top 3 for in/out plan.');
    }else if(/an to√†n|risk|stop|k·∫ø ho·∫°ch|plan|dca/.test(s))
      ans=(LANG==='vi'?'K·∫ø ho·∫°ch an to√†n: r·ªßi ro 1‚Äì2%/l·ªánh ‚Ä¢ DCA 2‚Äì3 nh·ªãp ‚Ä¢ Stop-loss c·ª©ng ‚Ä¢ Kh√¥ng all-in ‚Ä¢ RR‚â•1:2 ‚Ä¢ Nh·∫≠t k√Ω giao d·ªãch.'
                       :'Safety plan: 1‚Äì2% risk/trade ‚Ä¢ 2‚Äì3 step DCA ‚Ä¢ hard stop-loss ‚Ä¢ no all-in ‚Ä¢ RR‚â•1:2 ‚Ä¢ trading journal.');
    else if(/share|chia s·∫ª|ref/.test(s)){
      const myRef=localStorage.getItem('my_ref')||location.href; ans=(LANG==='vi'?'Li√™n k·∫øt gi·ªõi thi·ªáu c·ªßa b·∫°n: ':'Your referral link: ')+`<span class="mono">${myRef}</span>`;
    }else ans=(LANG==='vi'?'M√¨nh s·∫µn s√†ng: th·ªã tr∆∞·ªùng, token, m·ªü kh√≥a, an to√†n, ho·∫∑c g√µ ‚Äúshare‚Äù ƒë·ªÉ l·∫•y link.':'Ready: market, tokens, unlock, safety, or type ‚Äúshare‚Äù.');
    addBubble(ans);
  };
})();

/* ===== ViralShare 2.0 ===== */
(function ViralShare(){
  const U = new URL(location.href);
  const refIn = U.searchParams.get('ref');
  const peer = localStorage.getItem('peer_id') || Math.random().toString(36).slice(2);
  if(!localStorage.getItem('peer_id')) localStorage.setItem('peer_id', peer);
  if(refIn) localStorage.setItem('ref_by', refIn);
  const base = location.origin + location.pathname;
  const myRef = `${base}?ref=${peer}&utm_source=share&utm_medium=viral&utm_campaign=ultramaster`;
  localStorage.setItem('my_ref', myRef);
  const t = encodeURIComponent(document.title), u = encodeURIComponent(myRef);
  $('#sh_tg').href=`https://t.me/share/url?url=${u}&text=${t}`;
  $('#sh_x').href =`https://twitter.com/intent/tweet?text=${t}&url=${u}`;
  $('#sh_fb').href=`https://www.facebook.com/sharer/sharer.php?u=${u}`;
  $('#sh_in').href=`https://www.linkedin.com/sharing/share-offsite/?url=${u}`;
  $('#shareMine').onclick=async()=>{try{if(navigator.share){await navigator.share({title:document.title,text:'UltraMaster V‚àû',url:myRef});}else{await navigator.clipboard.writeText(myRef);alert(LANG==='vi'?'ƒê√£ sao ch√©p li√™n k·∫øt!':'Link copied!');}}catch(_){}}; 
  const refBy=localStorage.getItem('ref_by'); if(refBy){const badge=document.createElement('div');badge.className='pill';badge.style.marginTop='8px';badge.textContent=LANG==='vi'?'‚ú® B·∫°n truy c·∫≠p t·ª´ li√™n k·∫øt gi·ªõi thi·ªáu. Ch√†o m·ª´ng!':'‚ú® You came via referral. Welcome!'; $('#belowGlobe')?.appendChild(badge);}
})();

/* ===== Modal data (safe close incl. overlay & ESC) ===== */
const PREMIUM_DATA={
  updated_at:new Date().toISOString(),
  alpha_feed:[
    {type:"flow", text:"BTC CEX inflow tƒÉng d·∫ßn ‚Äî theo d√µi breakout."},
    {type:"onchain", text:"V√≠ l·ªõn gom mid-cap h·ªá ETH theo gi·ªù."},
    {type:"macro", text:"ETF spot ghi nh·∫≠n inflow ƒë·ªÅu 3 tu·∫ßn."}
  ],
  deals:[{name:"Seed/Private-DeFiX", note:"Allocation nh·ªè ‚Ä¢ vesting 12m"}]
};
function openDataModal(){ $('#dataPre').textContent=JSON.stringify(PREMIUM_DATA,null,2); $('#dataModal').classList.add('show'); }
$('#openData')?.addEventListener('click', openDataModal);
$('#closeData').addEventListener('click', ()=>$('#dataModal').classList.remove('show'));
$('#dataModal').addEventListener('click',e=>{ if(e.target===e.currentTarget) $('#dataModal').classList.remove('show'); });
document.addEventListener('keydown',e=>{ if(e.key==='Escape') $('#dataModal').classList.remove('show'); });

/* ===== Live counters ===== */
(function peers(){
  const k='umv_peers'; const now=Date.now(), ttl=25e3; const id=localStorage.getItem('peer_id')||Math.random().toString(36).slice(2); localStorage.setItem('peer_id',id);
  const raw=localStorage.getItem(k); let list=raw?JSON.parse(raw):[]; list=list.filter(x=>now-x.t<ttl); const me=list.find(x=>x.id===id); if(me) me.t=now; else list.push({id,t:now});
  localStorage.setItem(k,JSON.stringify(list)); $('#kLive').textContent=list.length; setTimeout(peers,4000);
})();

/* ===== Loops ===== */
async function boot(){ await fetchLive(); setInterval(fetchLive, 60*1000); }
boot();

/* ===== Theme button ===== */
$('#theme')?.addEventListener('click',()=>{});

/* ===== Initial apply (lang) ===== */
applyI18N();
</script>
</body>
</html>
