<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>UltraMaster V‚àû.2 ‚Ä¢ Web3 Singularity</title>
<meta name="description" content="Top 3 m·ªü kho√° ‚Ä¢ Token ch·ªçn l·ªçc realtime ‚Ä¢ AI chat 24/7 ‚Ä¢ QR thanh to√°n phong thu·ª∑ ‚Ä¢ ViralShare 2.1">
<meta property="og:title" content="UltraMaster V‚àû.2 ‚Ä¢ Web3 Singularity">
<meta property="og:description" content="Top 3 Premium ‚Ä¢ Token ch·ªçn l·ªçc ‚Ä¢ H·ªçc vi·ªán AI ‚Ä¢ Binance & AlgosOne ‚Ä¢ QR t√†i l·ªôc ‚Ä¢ Si√™u t·ªëi ∆∞u chuy·ªÉn ƒë·ªïi">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0b0f13">
<style>
:root{
  /* Dark */
  --bg:#0b0f13;--card:#0f141a;--line:#1e2a3a;--txt:#e9eef4;--mut:#a9b8c8;
  --brand:#7dc1ff;--accent:#ffb000;--ok:#22c55e;--bad:#ff4d4f;--pill:#101825;
  --jade:#139a5a;--gold:#ffd38a;--ocean:#18a4d6;--sand:#e2c26f;--moon:#ffe8a3;
  --aura:rgba(19,154,90,.28);--shadow:rgba(0,0,0,.35);
}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1120px;margin:0 auto;padding:18px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pill{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:#101825;color:#cfe0ef}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin-top:12px}
.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
.btn{display:inline-flex;gap:8px;align-items:center;background:var(--accent);color:#1a1300;border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
.btn.out{background:transparent;border:1px solid var(--line);color:var(--txt)}
.badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
.hidden{display:none}.mono{font-family:ui-monospace,SFMono-Regular,Consolas,monospace;word-break:break-all}
.footer{padding:28px 0;text-align:center;color:var(--mut)}
/* Light sang tr·ªçng phong thu·ª∑ (ocean+jade+gold) */
.light{
  --bg:#f3f8fb;--card:#ffffff;--line:#dfe8ee;--txt:#0b0f13;--mut:#4a5b62;
  --brand:#0d9488;--accent:#f7b340;--pill:#f6faf7;--aura:rgba(13,148,136,.12);
}
/* HERO */
.hero{position:relative;border:1px solid var(--line);border-radius:18px;overflow:hidden;background:
 radial-gradient(70% 140% at 50% -10%, rgba(19,154,90,.22), transparent),
 radial-gradient(85% 120% at 50% 15%, rgba(14,103,70,.20), transparent),
 linear-gradient(180deg, rgba(13,34,26,.15), transparent)}
.ribbon{position:absolute;inset:auto -30% -10% -30%;height:140px;background:
 linear-gradient(90deg,rgba(19,154,90,.22),rgba(8,40,28,.05),rgba(19,154,90,.22));filter:blur(18px);transform:rotate(-2deg)}
.logo-hero{display:flex;align-items:center;gap:8px}
.logo-dot{width:12px;height:12px;border-radius:50%;background:var(--accent);box-shadow:0 0 0 0 rgba(255,176,0,.55);animation:pulse 1.6s infinite}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(255,176,0,.55)}70%{box-shadow:0 0 0 12px rgba(255,176,0,0)}100%{box-shadow:0 0 0 0 rgba(255,176,0,0)}}
.header-flex{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;align-items:center}
@media (max-width:900px){.header-flex{grid-template-columns:1fr}}
/* Globe phong thu·ª∑: bi·ªÉn xanh + ƒë·∫•t v√†ng + h√†o quang trƒÉng */
.globe{width:min(300px,64vw);aspect-ratio:1;border-radius:50%;margin:auto;position:relative;
  box-shadow:inset 0 0 28px rgba(0,0,0,.4),0 18px 34px var(--shadow);
  background:radial-gradient(circle at 50% 45%, #091720 35%, #061116 70%, #040b0f 85%);}
.layer{position:absolute;inset:0;border-radius:50%}
.ocean{background:radial-gradient(circle at 35% 35%, rgba(24,164,214,.95) 0%, rgba(15,115,170,.85) 45%, rgba(5,60,100,.9) 70%, rgba(3,28,46,.95) 100%);opacity:.9}
.land{background-image:
 radial-gradient(circle at 58% 48%, rgba(226,194,111,.85) 0 22%, transparent 24%),
 radial-gradient(circle at 32% 62%, rgba(226,194,111,.75) 0 18%, transparent 20%);
 mix-blend-mode:soft-light;opacity:.85;animation:spin 26s linear infinite;background-size:200% 100%}
.map{background-image:
 radial-gradient(circle at 58% 48%, rgba(255,255,255,.12) 0 22%, transparent 24%),
 radial-gradient(circle at 32% 62%, rgba(255,255,255,.08) 0 18%, transparent 20%);
 mix-blend-mode:screen;opacity:.6;animation:spin 18s linear infinite;background-size:200% 100%}
.moon{position:absolute;top:6%;right:8%;width:54px;height:54px;border-radius:50%;
  background:radial-gradient(circle at 35% 35%, var(--moon), rgba(255,232,163,.55) 40%, rgba(255,232,163,0) 70%);
  box-shadow:0 0 28px rgba(255,232,163,.45)}
@keyframes spin{from{background-position:0 0}to{background-position:-200% 0}}
/* ticker */
.ticker3{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:8px}
.ticker3 .chip{border:1px dashed var(--line);border-radius:999px;padding:4px 10px;background:var(--pill)}
/* KPI */
.kpi{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.kbox{background:var(--pill);border:1px solid var(--line);border-radius:12px;padding:10px}
.now{font-size:22px;font-weight:800}
/* lists */
.marquee{white-space:nowrap;overflow:hidden}.marquee>div{display:inline-block;animation:mar 25s linear infinite}
@keyframes mar{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.list .item{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-top:1px dashed var(--line)}
.score{min-width:64px;text-align:center;border:1px solid var(--line);border-radius:10px;padding:4px 6px;color:#ffdca8;background:#241a00}
.tag{display:inline-block;border:1px solid var(--line);border-radius:8px;padding:2px 8px;margin:2px 4px 0 0;color:#c9d6e2;font-size:12px}
.ok{color:#22c55e}.bad{color:#ff4d4f}
/* shop */
.shop-card{padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--pill)}
.shop-title{display:flex;justify-content:space-between;align-items:center;gap:8px}
.price{font-weight:900;color:#ffd38a}
/* SuperGate */
.paygrid{display:grid;gap:12px;grid-template-columns:1.1fr 1fr}
@media(max-width:900px){.paygrid{grid-template-columns:1fr}}
.qrbox{display:flex;gap:12px;align-items:flex-start}
.qrbox img{width:120px;height:120px;border-radius:12px;border:1px solid var(--line);background:#000}
.paychips{display:flex;flex-wrap:wrap;gap:8px}
.chipbtn{border:1px solid var(--line);background:var(--card);padding:6px 10px;border-radius:999px;cursor:pointer}
.chipbtn.active{background:rgba(19,154,90,.18);border-color:#237a59}
.copytxt{font-size:12px;color:var(--mut);margin-left:6px}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:var(--card);color:var(--txt)}
.note{color:var(--mut)}
/* Chat */
.chatfab{position:fixed;right:16px;bottom:16px;z-index:40}
.chatwin{position:fixed;right:16px;bottom:80px;width:min(380px,92vw);max-height:70vh;display:none;flex-direction:column;background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;z-index:41}
.chathead{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--line)}
.chatbody{padding:10px;overflow:auto;background:linear-gradient(180deg,rgba(20,33,25,.35),transparent)}
.chatinput{display:flex;gap:6px;padding:10px;border-top:1px solid var(--line)}
.chatinput input{flex:1}
.bubble{padding:8px 10px;border:1px solid var(--line);border-radius:10px;margin:6px 0}
.bubble.me{background:#122033} .bubble.ai{background:#121a12}
/* Footer CTA ‚Äì green band */
.footer-cta{border:1px dashed var(--line);border-radius:14px;padding:16px;
  background:linear-gradient(180deg,rgba(19,154,90,.28),rgba(19,154,90,.08));box-shadow:0 10px 30px var(--aura)}
/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:99}
.modal .box{width:min(92vw,900px);height:min(80vh,700px);background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
.modal header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
/* Share bar */
.sharebar{position:fixed;right:12px;bottom:12px;display:flex;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px;z-index:30}
</style>
</head>
<body>
<div class="wrap">
  <!-- Top pills -->
  <div class="row">
    <span class="pill logo-hero"><span class="logo-dot"></span><b>UltraMaster V‚àû.2</b></span>
    <span class="pill">ENS: <b id="ens">lightunfold.eth</b></span>
    <span class="pill">Heartbeat: <b id="hb">LIVE</b></span>
    <button class="pill" id="openData">data</button>
    <button class="pill" id="lang">VI/EN</button>
    <button class="pill" id="theme">üåó Theme</button>
  </div>

  <!-- HERO -->
  <section class="card hero">
    <div class="ribbon"></div>
    <div class="header-flex">
      <div>
        <h1 id="brand">LightUnfold ‚Ä¢ UltraMaster V‚àû.2</h1>
        <div class="note" id="tagline">Web3 t√†i l·ªôc c·ªßa b·∫°n ‚Äì Top 3 Premium ‚Ä¢ Token ch·ªçn l·ªçc realtime ‚Ä¢ AI 24/7 ‚Ä¢ M·ªü kh√≥a t·∫°i ch·ªó</div>
        <div class="card" style="margin-top:10px;background:var(--pill);border-color:#204a36">
          <b style="color:#d1ffe3">‚ÄúBi·∫øt s·ªõm ‚Äì Quy·∫øt ƒë·ªãnh s·ªõm ‚Äì L·ª£i th·∫ø s·ªõm.‚Äù</b><br>
          N∆°i h·ªôi t·ª•: <b>Kho√° h·ªçc tinh g·ªçn</b>, <b>Token ch·ªçn l·ªçc realtime</b>, <b>AI h·ªèi ƒë√°p</b> v√† <b>C∆° h·ªôi ƒë·∫ßu t∆∞ d·∫´n tr∆∞·ªõc ƒë√°m ƒë√¥ng</b>.
        </div>
        <div class="row" style="margin-top:10px" id="belowGlobe">
          <a class="btn out" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="algosBtn">AlgosOne ‚Äì D√πng th·ª≠ ‚Üó</a>
          <a class="btn out" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="binanceBtn">Binance ‚Äì M·ªü t√†i kho·∫£n ‚Üó</a>
        </div>
      </div>
      <div style="position:relative;display:grid;place-items:center;gap:4px">
        <div class="globe">
          <div class="layer ocean"></div>
          <div class="layer land"></div>
          <div class="layer map"></div>
          <div class="moon"></div>
        </div>
        <div class="ticker3" id="ticker3">
          <span class="chip">BTC ‚Äî ‚Äî</span><span class="chip">ETH ‚Äî ‚Äî</span><span class="chip">USDT ‚Äî ‚Äî</span>
        </div>
      </div>
    </div>
  </section>

  <!-- KPI -->
  <div class="kpi">
    <div class="kbox"><div class="muted">C∆° h·ªôi</div><div class="now" id="kOpps">0</div></div>
    <div class="kbox"><div class="muted">C·∫≠p nh·∫≠t</div><div class="now" id="kUpd">‚Äî</div></div>
    <div class="kbox"><div class="muted">ƒêang xem</div><div class="now" id="kLive">‚Äî</div></div>
    <div class="kbox"><div class="muted">Doanh thu</div><div class="now">$<span id="kRev">0</span></div></div>
  </div>

  <!-- 1) TOP 3 PREMIUM -->
  <section class="card" id="top3">
    <h3 style="margin:0 0 8px" id="top3Title">‚≠ê Top 3 Premium (m·ªü kho√° ƒë·ªÉ xem chi ti·∫øt)</h3>
    <div id="top3Mask" class="grid"></div>
    <div id="top3Real" class="grid hidden"></div>
  </section>

  <!-- 2) TOKEN CH·ªåN L·ªåC (mi·ªÖn ph√≠) -->
  <section class="card">
    <h3 style="margin:0 0 8px" id="curatedTitle">üìä Token ƒë∆∞·ª£c ch·ªçn l·ªçc ‚Äî c·∫≠p nh·∫≠t realtime</h3>
    <div class="grid" id="tokenFree"></div>
  </section>

  <!-- 3) H·ªåC VI·ªÜN (n·ªôi dung phong ph√∫ + r√µ l·ª£i √≠ch) -->
  <section class="card" id="edu">
    <h3 style="margin:0 0 8px" id="academyTitle">üìö H·ªçc vi·ªán</h3>
    <div class="grid" id="ebooks"></div>
  </section>

  <!-- 4) C∆† H·ªòI N·ªîI B·∫¨T -->
  <section class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0" id="hotTitle">üî• C∆° h·ªôi n·ªïi b·∫≠t</h3>
      <div class="row"><span class="badge" id="scanMode">qu√©t: data</span><button class="btn out" id="refreshNow">‚Üª L√†m m·ªõi</button></div>
    </div>
    <div class="marquee" style="margin:4px 0 8px;color:#bcd"><div id="ticker">‚Äî</div></div>
    <div id="opps" class="list"></div>
  </section>

  <!-- 5) G√ìI PREMIUM (m√¥ t·∫£ s√¢u s·∫Øc) -->
  <section class="card" id="bundlesSec">
    <h3 style="margin:0 0 8px" id="bundlesTitle">üß∞ G√≥i Premium</h3>
    <div class="grid" id="bundles"></div>
  </section>

  <!-- 6) SUPERGATE -->
  <section class="card" id="supergate">
    <h3 style="margin:0 0 8px" id="supergateTitle">üîì C·ª≠a m·ªü kho√° (SuperGate)</h3>
    <div class="paygrid">
      <!-- Left: Payment -->
      <div class="card" style="background:var(--pill)">
        <div class="qrbox">
          <img id="qr" alt="QR" src="" loading="lazy">
          <div style="flex:1;min-width:0">
            <div class="note"><b id="payPitch">Thanh to√°n nh·ªè ‚Üí nh·∫≠n m√£ m·ªü kho√° ngay t·∫°i ƒë√¢y.</b></div>
            <div class="note"><span id="addrLabel">ƒê·ªãa ch·ªâ/ID</span>: <span class="mono" id="payAddr">‚Äî</span>
              <button class="btn out" id="copyAddr" style="margin-left:8px">üìã <span id="copyTxt">Sao ch√©p</span></button>
            </div>
            <div class="note"><span id="minLabel">T·ªëi thi·ªÉu</span>: <span id="minHint">ETH ‚â• 0.0005</span></div>
            <div class="paychips" id="payList"></div>
          </div>
        </div>
      </div>
      <!-- Right: Unlock -->
      <div class="card" style="background:var(--pill)">
        <div class="grid" style="grid-template-columns:1fr">
          <div>
            <label class="note" id="chooseBundleLbl">Ch·ªçn g√≥i</label>
            <select id="bundleSel" class="input"></select>
          </div>
          <div>
            <label class="note" id="enterCodeLbl">Nh·∫≠p m√£ m·ªü kho√° (sau khi thanh to√°n)</label>
            <input id="unlockCode" class="input" placeholder="Nh·∫≠p m√£‚Ä¶">
          </div>
          <div><input id="txhash" class="input" placeholder="(Tu·ª≥ ch·ªçn) D√°n TX hash / ghi ch√∫"></div>
          <div class="row">
            <button class="btn" id="doUnlock">M·ªü kho√°</button>
            <button class="btn out" id="remember">Nh·ªõ m√£</button>
          </div>
          <div id="uMsg" class="note"></div>
          <div class="note" style="margin-top:6px" id="unlockHint">Sau khi m·ªü, n·ªôi dung premium xu·∫•t hi·ªán t·ª©c th√¨ v√† ƒë∆∞·ª£c nh·ªõ tr√™n thi·∫øt b·ªã.</div>
        </div>
      </div>
    </div>

    <!-- Sau m·ªü kho√° -->
    <div id="opened" class="hidden" style="margin-top:12px">
      <div class="row">
        <span class="pill ok" id="unlockedLbl">‚úî ƒê√£ m·ªü kh√≥a</span>
        <button class="btn out" id="relock">Kho√° l·∫°i</button>
        <span class="pill" id="rewardMini" style="border-color:#2a5f3d;background:rgba(21,88,58,.25)">üéÅ Mini-Reward: +10% hoa h·ªìng gi·ªõi thi·ªáu trong 24h</span>
      </div>
      <div id="premium" class="grid" style="margin-top:10px"></div>
    </div>
  </section>

  <!-- 7) ƒê·ªêI T√ÅC -->
  <section class="card">
    <h3 style="margin:0 0 8px" id="partnersTitle">ü§ù ƒê·ªëi t√°c chi·∫øn l∆∞·ª£c</h3>
    <div class="grid">
      <div class="shop-card">
        <div class="shop-title"><h4>AlgosOne ‚Äì AI giao d·ªãch th·ª±c chi·∫øn</h4><span class="price">D√πng th·ª≠</span></div>
        <div class="note">T√≠n hi·ªáu t·ª´ m√°y h·ªçc, c·∫£nh b√°o realtime, backtest nhanh, qu·∫£n tr·ªã r·ªßi ro k·ª∑ lu·∫≠t ‚Äî ƒë·ªÉ thu·∫≠t to√°n l√†m vi·ªác, b·∫°n gi·ªØ c·∫£m x√∫c l·∫°nh.</div>
        <a class="btn" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="algosBtn2">K√≠ch ho·∫°t AlgosOne ‚Üó</a>
      </div>
      <div class="shop-card">
        <div class="shop-title"><h4>Binance ‚Äì b∆∞·ªõc kh·ªüi ƒë·∫ßu th√¥ng minh</h4><span class="price">Mi·ªÖn ph√≠</span></div>
        <div class="note">N∆°i thanh kho·∫£n s√¢u nh·∫•t: ph√≠ c·∫°nh tranh, Earn/Futures/Options, Launchpad/Launchpool, b·∫£o m·∫≠t & API m·∫°nh.</div>
        <a class="btn out" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="binanceBtn2">M·ªü t√†i kho·∫£n Binance ‚Üó</a>
      </div>
    </div>
  </section>

  <!-- 8) CTA cu·ªëi trang -->
  <section class="card footer-cta">
    <h3 style="margin:0 0 6px" id="ctaTitle">üöÄ C∆° h·ªôi kh√¥ng ch·ªù ƒë·ª£i ‚Äì b·∫°n c≈©ng ƒë·ª´ng ch·ªù!</h3>
    <div id="ctaBody">Ch·ªâ c·∫ßn <b>m·ªü kho√°</b> ho·∫∑c <b>ƒëƒÉng k√Ω t√†i kho·∫£n mi·ªÖn ph√≠</b> h√¥m nay, b·∫°n s·∫Ω b∆∞·ªõc v√†o <b>h·ªá th·ªëng AI t√†i ch√≠nh 24/7</b> ‚Äì n∆°i m·ªçi nh·ªãp th·ªã tr∆∞·ªùng ƒë·ªÅu trong t·∫ßm tay.</div>
    <div class="row" style="margin-top:8px">
      <a class="btn" href="#supergate" id="ctaUnlockBtn">M·ªü kho√° ngay</a>
      <a class="btn out" href="https://algosone.page.link/MbtR" target="_blank" rel="noopener" id="ctaAlgos">D√πng th·ª≠ AlgosOne ‚Üó</a>
      <a class="btn out" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N" target="_blank" rel="noopener" id="ctaBinance">ƒêƒÉng k√Ω Binance ‚Üó</a>
      <button class="btn out" id="shareMine">Chia s·∫ª li√™n k·∫øt c·ªßa t√¥i</button>
    </div>
  </section>

  <button class="pill" id="goTop" style="position:fixed;left:12px;bottom:80px;z-index:9">‚Üë Top</button>
  <div class="footer">¬© <span id="year"></span> LightUnfold ‚Ä¢ <span id="autoLbl">T·ª± ƒë·ªông 24/7</span></div>
</div>

<!-- Share floating -->
<div class="sharebar">
  <a id="sh_tg" target="_blank" title="Share Telegram">üì£</a>
  <a id="sh_x"  target="_blank" title="Share X/Twitter">ùïè</a>
  <a id="sh_fb" target="_blank" title="Share Facebook">f</a>
  <a id="sh_in" target="_blank" title="Share LinkedIn">in</a>
</div>

<!-- Chat 24/7 -->
<button class="btn chatfab" id="openChat">üß† Chat AI 24/7</button>
<div class="chatwin" id="chat">
  <div class="chathead"><b>AI T√†i Ch√≠nh 24/7</b><button class="btn out" id="closeChat">ƒê√≥ng</button></div>
  <div class="chatbody" id="chatBody"></div>
  <div style="padding:0 10px" id="chipBar"></div>
  <div class="chatinput">
    <input id="chatIn" class="input" placeholder="H·ªèi th·ªã tr∆∞·ªùng, token, k·∫ø ho·∫°ch l·ªánh‚Ä¶">
    <button class="btn" id="chatSend">G·ª≠i</button>
  </div>
</div>

<!-- Modal d·ªØ li·ªáu premium -->
<div id="dataModal" class="modal" role="dialog" aria-label="D·ªØ li·ªáu Premium">
  <div class="box">
    <header>
      <b id="dataTitle">D·ªØ li·ªáu Premium</b>
      <button class="btn" id="closeData">ƒê√≥ng</button>
    </header>
    <pre id="dataPre" style="flex:1;margin:0;padding:12px;overflow:auto;background:#0b0f13;color:#d6f5e1"></pre>
  </div>
</div>

<script>
/* ===== Helpers ===== */
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
function setTheme(m){document.documentElement.classList.toggle('light',m==='light');localStorage.setItem('theme',m)}
setTheme(localStorage.getItem('theme')||'dark');
$('#theme').onclick=()=>setTheme(document.documentElement.classList.contains('light')?'dark':'light');
const fmt=n=>Number(n||0).toLocaleString(undefined,{maximumFractionDigits:8});
const qrlink=t=>`https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(t)}`;
async function j(url){try{const r=await fetch(url,{cache:'no-store'});if(!r.ok) throw 0;return await r.json()}catch(_){return null}}
$('#year').textContent=new Date().getFullYear();
$('#goTop').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});

/* ===== i18n (m·ªü r·ªông & ƒë·ªìng b·ªô to√†n trang) ===== */
let LANG=(localStorage.getItem('lang')||navigator.language||'vi').toLowerCase().startsWith('vi')?'vi':'en';
const I={
vi:{
  brand:"LightUnfold ‚Ä¢ UltraMaster V‚àû.2",
  tagline:"Web3 t√†i l·ªôc c·ªßa b·∫°n ‚Äì Top 3 Premium ‚Ä¢ Token ch·ªçn l·ªçc realtime ‚Ä¢ AI 24/7 ‚Ä¢ M·ªü kh√≥a t·∫°i ch·ªó",
  top3:"‚≠ê Top 3 Premium (m·ªü kho√° ƒë·ªÉ xem chi ti·∫øt)",
  curated:"üìä Token ƒë∆∞·ª£c ch·ªçn l·ªçc ‚Äî c·∫≠p nh·∫≠t realtime",
  academy:"üìö H·ªçc vi·ªán",
  hot:"üî• C∆° h·ªôi n·ªïi b·∫≠t",
  bundles:"üß∞ G√≥i Premium",
  supergate:"üîì C·ª≠a m·ªü kho√° (SuperGate)",
  partners:"ü§ù ƒê·ªëi t√°c chi·∫øn l∆∞·ª£c",
  cta_title:"üöÄ C∆° h·ªôi kh√¥ng ch·ªù ƒë·ª£i ‚Äì b·∫°n c≈©ng ƒë·ª´ng ch·ªù!",
  cta_body:"Ch·ªâ c·∫ßn m·ªü kho√° ho·∫∑c ƒëƒÉng k√Ω t√†i kho·∫£n mi·ªÖn ph√≠ h√¥m nay, b·∫°n s·∫Ω b∆∞·ªõc v√†o h·ªá th·ªëng AI t√†i ch√≠nh 24/7 ‚Äì n∆°i m·ªçi nh·ªãp th·ªã tr∆∞·ªùng ƒë·ªÅu trong t·∫ßm tay.",
  open_data:"Xem d·ªØ li·ªáu",
  details:"Chi ti·∫øt",
  open_chart:"Xem chi ti·∫øt ‚Üó",
  ai_quick:"AI ph√¢n t√≠ch nhanh",
  choose_bundle:"Ch·ªçn g√≥i",
  enter_code_lbl:"Nh·∫≠p m√£ m·ªü kho√° (sau khi thanh to√°n)",
  enter_code_ph:"Nh·∫≠p m√£‚Ä¶",
  saved:"ƒê√£ l∆∞u tr√™n thi·∫øt b·ªã.",
  unlocked:"‚úî ƒê√£ m·ªü kh√≥a",
  wrong:"M√£ kh√¥ng ƒë√∫ng.",
  min:"T·ªëi thi·ªÉu",
  pay_copy:"Sao ch√©p",
  scan_data:"qu√©t: data",
  always_on:"T·ª± ƒë·ªông 24/7",
  algos_btn:"K√≠ch ho·∫°t AlgosOne ‚Üó", binance_btn:"M·ªü t√†i kho·∫£n Binance ‚Üó",
  addr:"ƒê·ªãa ch·ªâ/ID", pay_pitch:"Thanh to√°n nh·ªè ‚Üí nh·∫≠n m√£ m·ªü kho√° ngay t·∫°i ƒë√¢y.",
  unlock_hint:"Sau khi m·ªü, n·ªôi dung premium xu·∫•t hi·ªán t·ª©c th√¨ v√† ƒë∆∞·ª£c nh·ªõ tr√™n thi·∫øt b·ªã."
},
en:{
  brand:"LightUnfold ‚Ä¢ UltraMaster V‚àû.2",
  tagline:"Your Wealth Web3 ‚Äì Top 3 Premium ‚Ä¢ Curated tokens realtime ‚Ä¢ 24/7 AI ‚Ä¢ On-page unlock",
  top3:"‚≠ê Top 3 Premium (unlock to view details)",
  curated:"üìä Curated Tokens ‚Äî realtime",
  academy:"üìö Academy",
  hot:"üî• Hot Opportunities",
  bundles:"üß∞ Premium Bundles",
  supergate:"üîì SuperGate (Unlock)",
  partners:"ü§ù Strategic Partners",
  cta_title:"üöÄ Opportunity won‚Äôt wait ‚Äî neither should you!",
  cta_body:"Unlock or create a free account today to enter the 24/7 Finance AI ‚Äî where every market beat is in your hands.",
  open_data:"Open data",
  details:"Details",
  open_chart:"Open details ‚Üó",
  ai_quick:"AI quick take",
  choose_bundle:"Choose bundle",
  enter_code_lbl:"Enter unlock code (after payment)",
  enter_code_ph:"Enter code‚Ä¶",
  saved:"Saved on device.",
  unlocked:"‚úî Unlocked",
  wrong:"Invalid code.",
  min:"Minimum",
  pay_copy:"Copy",
  scan_data:"scan: data",
  always_on:"Always-on 24/7",
  algos_btn:"Activate AlgosOne ‚Üó", binance_btn:"Open Binance ‚Üó",
  addr:"Address/ID", pay_pitch:"Small payment ‚Üí get unlock code right here.",
  unlock_hint:"After unlocking, premium appears instantly and is remembered on this device."
}};
function applyLang(){
  const L=I[LANG];
  $('#brand').textContent=L.brand; $('#tagline').textContent=L.tagline;
  $('#top3Title').textContent=L.top3; $('#curatedTitle').textContent=L.curated;
  $('#academyTitle').textContent=L.academy; $('#hotTitle').textContent=L.hot;
  $('#bundlesTitle').textContent=L.bundles; $('#supergateTitle').textContent=L.supergate;
  $('#partnersTitle').textContent=L.partners; $('#ctaTitle').textContent=L.cta_title;
  $('#ctaBody').textContent=L.cta_body; $('#autoLbl').textContent=L.always_on;
  $('#algosBtn').textContent=LANG==='vi'?'AlgosOne ‚Äì D√πng th·ª≠ ‚Üó':'AlgosOne ‚Äì Try now ‚Üó';
  $('#binanceBtn').textContent=L.binance_btn; $('#algosBtn2').textContent=L.algos_btn; $('#binanceBtn2').textContent=L.binance_btn;
  $('#ctaAlgos').textContent=LANG==='vi'?'D√πng th·ª≠ AlgosOne ‚Üó':'Try AlgosOne ‚Üó';
  $('#ctaBinance').textContent=L.binance_btn; $('#ctaUnlockBtn').textContent=LANG==='vi'?'M·ªü kho√° ngay':'Unlock now';
  $('#dataTitle').textContent=L.open_data; $('#scanMode').textContent=L.scan_data;
  $('#chooseBundleLbl').textContent=L.choose_bundle; $('#enterCodeLbl').textContent=L.enter_code_lbl;
  $('#unlockCode').placeholder=L.enter_code_ph; $('#unlockHint').textContent=L.unlock_hint;
  $('#addrLabel').textContent=L.addr; $('#copyTxt').textContent=L.pay_copy; $('#minLabel').textContent=L.min;
  $('#payPitch').textContent=L.pay_pitch;
  // re-render dynamic sections to localize inner texts
  paintBundles(); paintPremium(); renderAll(LAST_ITEMS); paintEdu();
}
$('#lang').onclick=()=>{LANG=LANG==='vi'?'en':'vi';localStorage.setItem('lang',LANG);applyLang();};

/* ===== Config ===== */
const CFG={
  site:{brand:"LightUnfold ‚Ä¢ UltraMaster V‚àû.2",ens:"lightunfold.eth",
    payments:{chains:[
      {name:"ETH (EVM)",address:"0x54E15A7b6d4213beE87800432A151d794638E3C2",explorer:"https://etherscan.io/address/0x54E15A7b6d4213beE87800432A151d794638E3C2",min:"ETH ‚â• 0.0005"},
      {name:"USDT (ERC20)",address:"0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",explorer:"https://etherscan.io/token/USDT?a=0x5da80d0f7e2df3cb0aa73d6a942bbe36b046b8f0",min:"USDT ‚â• $5"},
      {name:"MoMo",address:"0567892030",min:"T·ªëi thi·ªÉu 50,000ƒë"},
      {name:"Vietcombank",address:"9567892030",min:"T·ªëi thi·ªÉu 50,000ƒë"},
      {name:"PayPal",address:"vumumabada@gmail.com",min:"$5+"}
    ]},
  },
  secrets:{unlock_code:"23061988"},
  store:{
    bundles:[
      {id:"alpha",title:"Alpha Signals X",price:19,desc:"T√≠n hi·ªáu ng·∫Øn h·∫°n x√°c su·∫•t cao. ‚Ä¢ Entry r√µ ‚Ä¢ RR‚â•1:2 ‚Ä¢ K·ª∑ lu·∫≠t stop."},
      {id:"etfbtc",title:"ETF & BTC Flow",price:29,desc:"D√≤ng v·ªën ETF/BTC ‚Ä¢ V√πng cung-c·∫ßu ‚Ä¢ T√¢m l√Ω th·ªã tr∆∞·ªùng ‚Ä¢ K·ªãch b·∫£n macro."},
      {id:"alts",title:"Altseason Radar",price:10,desc:"Xoay v√≤ng v·ªën ‚Ä¢ C·∫∑p d·∫´n d·∫Øt ‚Ä¢ Nh·ªãp h·ªìi/ƒë·∫£o chi·ªÅu ‚Ä¢ Qu·∫£n tr·ªã r·ªßi ro."}
    ],
    premium:[
      {title:"Alpha Feed Pro",desc:"Ngu·ªìn alpha t·ªëc ƒë·ªô ms, l·ªçc nhi·ªÖu nhi·ªÅu t·∫ßng, t√≠n hi·ªáu b·∫•t th∆∞·ªùng d√≤ng ti·ªÅn.",bullets:["CEX/DEX flow ‚Ä¢ On-chain","News sentiment ‚Ä¢ Whale map","M·ª©c v√†o/ra g·ª£i √Ω an to√†n"]},
      {title:"Deal Flow Private",desc:"T·ªïng h·ª£p seed/private m·ªü ‚Ä¢ ƒëi·ªÅu ki·ªán ‚Ä¢ l·ªãch vest ‚Ä¢ r·ªßi ro/khuy·∫øn ngh·ªã.",bullets:["Whitelist/Allocation","Tokenomics c√¥ ƒë·ªçng","∆Øu ti√™n theo th·ªùi gian"]}
    ],
    edu:[
      {title:"Crypto 101",price:0,desc:"T·ª´ A‚ÜíZ cho ng∆∞·ªùi m·ªõi: V√≠ & b·∫£o m·∫≠t, chu k·ª≥ th·ªã tr∆∞·ªùng, on-chain c∆° b·∫£n, qu·∫£n tr·ªã v·ªën, mindset.",tag:"Mi·ªÖn ph√≠"},
      {title:"DeFi Mastery",price:10,desc:"AMM, Lending, Perp; chi·∫øn l∆∞·ª£c yield; ƒëo r·ªßi ro; case study l·ª£i nhu·∫≠n & sai l·∫ßm th·ª±c t·∫ø.",tag:"N√¢ng cao"},
      {title:"Risk & Psychology",price:19,desc:"H·ªá th·ªëng ho√° quy·∫øt ƒë·ªãnh, nh·∫≠t k√Ω trade, quy t·∫Øc drawdown, discipline stack, th√≥i quen hi·ªáu su·∫•t.",tag:"Chuy√™n s√¢u"}
    ]
  }
};

/* ===== ViralShare 2.1 ===== */
(function ViralShare(){
  const U=new URL(location.href);
  const refIn=U.searchParams.get('ref');
  const peer=localStorage.getItem('peer_id')||Math.random().toString(36).slice(2);
  if(!localStorage.getItem('peer_id')) localStorage.setItem('peer_id',peer);
  if(refIn) localStorage.setItem('ref_by',refIn);
  const base=location.origin+location.pathname;
  const myRef=`${base}?ref=${peer}&utm_source=share&utm_medium=viral&utm_campaign=ultramaster`;
  localStorage.setItem('my_ref',myRef);
  const t=encodeURIComponent(document.title), u=encodeURIComponent(myRef);
  $('#sh_tg').href=`https://t.me/share/url?url=${u}&text=${t}`;
  $('#sh_x').href =`https://twitter.com/intent/tweet?text=${t}&url=${u}`;
  $('#sh_fb').href=`https://www.facebook.com/sharer/sharer.php?u=${u}`;
  $('#sh_in').href=`https://www.linkedin.com/sharing/share-offsite/?url=${u}`;
  $('#shareMine').onclick=async()=>{try{if(navigator.share){await navigator.share({title:document.title,text:'Kh√°m ph√° UltraMaster V‚àû.2',url:myRef});}else{await navigator.clipboard.writeText(myRef);alert('ƒê√£ sao ch√©p li√™n k·∫øt c·ªßa b·∫°n!');}}catch(_){}}; 
  const refBy=localStorage.getItem('ref_by'); if(refBy){const badge=document.createElement('div');badge.className='pill';badge.style.marginTop='8px';badge.textContent='‚ú® B·∫°n truy c·∫≠p t·ª´ li√™n k·∫øt gi·ªõi thi·ªáu. Ch√†o m·ª´ng!'; $('#belowGlobe')?.appendChild(badge);}
})();

/* ===== BTC/ETH/USDT ticker ===== */
async function tick3(){
  try{
    const ids='bitcoin,ethereum,tether';
    const r=await j('https://api.coingecko.com/api/v3/simple/price?ids='+ids+'&vs_currencies=usd&include_24hr_change=true');
    if(!r) return;
    const m=[
      {k:'BTC',p:r.bitcoin?.usd, c:r.bitcoin?.usd_24h_change},
      {k:'ETH',p:r.ethereum?.usd, c:r.ethereum?.usd_24h_change},
      {k:'USDT',p:r.tether?.usd, c:r.tether?.usd_24h_change}
    ];
    $('#ticker3').innerHTML=m.map(o=>`<span class="chip">${o.k} $${fmt(o.p)} <b class="${(o.c||0)>=0?'ok':'bad'}">${(o.c||0).toFixed(2)}%</b></span>`).join('');
  }catch(_){}
}
setInterval(tick3, 8000); tick3();

/* ===== Market data ===== */
let LAST_ITEMS=[];
async function fetchLive(){
  const latest=await j('data/latest.json'); // optional
  if(latest && Array.isArray(latest.items)){ renderAll(latest.items); return; }
  try{
    const cg=await j('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=volume_desc&per_page=60&page=1&price_change_percentage=1h,24h,7d');
    const items=(cg||[]).map(c=>({source:"coingecko",symbol:(c.symbol||"").toUpperCase(),name:c.name,price:+c.current_price||0,
      ch24h:+c.price_change_percentage_24h_in_currency||0,vol24h:+c.total_volume||0,
      mcap:+c.market_cap||0, link:`https://www.coingecko.com/en/coins/${c.id}`,
      score:(+c.price_change_percentage_1h_in_currency||0)*0.4+(+c.price_change_percentage_24h_in_currency||0)*0.35+(+c.price_change_percentage_7d_in_currency||0)*0.25+Math.log10((+c.total_volume||1))}));
    const bestBySymbol={}; for(const it of items){const k=it.symbol; if(!bestBySymbol[k]||it.score>bestBySymbol[k].score) bestBySymbol[k]=it;}
    LAST_ITEMS=Object.values(bestBySymbol).sort((a,b)=>b.score-a.score).slice(0,20);
    renderAll(LAST_ITEMS);
  }catch(_){}
}
function renderAll(items){
  // KPI + ticker
  $('#kOpps').textContent=items.length;
  $('#ticker').innerHTML=items.slice(0,12).map(x=>`<span class="tag">${x.symbol}: $${fmt(x.price)} (${(x.ch24h||0).toFixed(2)}%)</span>`).join('')||'‚Äî';

  // Top3
  const L=I[LANG]; const top3=items.slice(0,3);
  $('#top3Mask').innerHTML=top3.map((x,i)=>`
    <div class="shop-card">
      <div class="shop-title"><h4>‚≠ê Premium #${i+1}</h4><span class="price">${LANG==='vi'?'M·ªü kho√°':'Unlock'}</span></div>
      <div class="note">${LANG==='vi'?'M·ªü kho√° ƒë·ªÉ xem':'Unlock to view'}: ${x.symbol} ‚Ä¢ Price/Vol/7d ‚Ä¢ Chi·∫øn l∆∞·ª£c v√†o/ra an to√†n.</div>
      <a class="btn" href="#supergate">${LANG==='vi'?'M·ªü kho√° ngay':'Unlock now'}</a>
    </div>`).join('');
  $('#top3Real').innerHTML=top3.map(x=>`
    <div class="shop-card">
      <div class="shop-title"><h4>‚≠ê ${x.symbol} ‚Äî ${x.name}</h4><span class="price">$${fmt(x.price)}</span></div>
      <div class="note">24h: <b class="${(x.ch24h||0)>=0?'ok':'bad'}">${(x.ch24h||0).toFixed(2)}%</b> ‚Ä¢ Vol: $${fmt(x.vol24h)}</div>
      <div class="row" style="margin-top:8px">
        <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${L.open_chart}</a>
        <button class="btn out" onclick="aiHint('${x.symbol}')">${L.ai_quick}</button>
      </div>
    </div>`).join('');

  // Curated 7
  const free=items.slice(3,10);
  $('#tokenFree').innerHTML=free.map(x=>{
    const c=x.ch24h||0, rr=c>=0?'ok':'bad';
    return `<div class="shop-card">
      <div class="shop-title"><h4>${x.symbol} ‚Äî ${x.name||''}</h4><span class="price">$${fmt(x.price)}</span></div>
      <div class="note">24h: <b class="${rr}">${c.toFixed(2)}%</b> ‚Ä¢ Vol: $${fmt(x.vol24h)}</div>
      <div class="row" style="margin-top:8px">
        <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${L.open_chart}</a>
        <button class="btn out" onclick="aiHint('${x.symbol}')">${L.ai_quick}</button>
      </div>
    </div>`;
  }).join('');

  // Hot list
  $('#opps').innerHTML=items.slice(0,10).map(x=>{
    const ch=x.ch24h||0,pct=`${ch>=0?'+':''}${ch.toFixed(2)}%`;
    return `<div class="item"><div class="score">+${(x.score||0).toFixed(2)}</div>
      <div style="flex:1;min-width:0">
        <div class="row" style="justify-content:space-between;gap:8px">
          <div><b>${x.symbol}</b> ¬∑ <span class="muted">${x.name||''}</span></div>
          <a class="btn out" target="_blank" rel="noopener" href="${x.link||'#'}">${L.details} ‚Üó</a></div>
        <div class="row" style="gap:8px">
          <span class="tag">Gi√°: $${fmt(x.price||0)}</span>
          <span class="tag ${ch>=0?'ok':'bad'}">24h: ${pct}</span>
          <span class="tag">Vol: $${fmt(x.vol24h||0)}</span>
        </div></div></div>`;
  }).join('');

  // Top3 visibility
  if(localStorage.getItem('unlocked_code')===String(CFG.secrets.unlock_code)){
    $('#top3Mask').classList.add('hidden'); $('#top3Real').classList.remove('hidden');
  }else{
    $('#top3Mask').classList.remove('hidden'); $('#top3Real').classList.add('hidden');
  }
}

/* ===== Payments: ch·ªçn ph∆∞∆°ng th·ª©c -> thay QR + min + tr·∫°ng th√°i + Sao ch√©p ===== */
let currentPay=0;
function setPay(i){
  currentPay=i;
  const p=CFG.site.payments.chains[i];
  $('#qr').src=qrlink(p.address);
  $('#payAddr').textContent=p.address;
  $('#minHint').textContent=p.min||'';
  $$('#payList .chipbtn').forEach((b,idx)=>b.classList.toggle('active',idx===i));
  // reset copy text
  $('#copyTxt').textContent=I[LANG].pay_copy;
}
(function paintPay(){
  $('#payList').innerHTML=CFG.site.payments.chains.map((c,i)=>`<button class="chipbtn" onclick="setPay(${i});navigator.clipboard.writeText('${c.address}');const t=document.getElementById('copyTxt');t.textContent=t.textContent+' ‚úì';">${c.name}</button>`).join('');
  setPay(0);
  $('#copyAddr').onclick=()=>{navigator.clipboard.writeText(CFG.site.payments.chains[currentPay].address); $('#copyTxt').textContent=I[LANG].pay_copy+' ‚úì';};
})();

/* ===== Bundles + Premium ===== */
function paintBundles(){
  const L=I[LANG];
  $('#bundleSel').innerHTML=CFG.store.bundles.map(b=>`<option value="${b.id}">${b.title} ‚Äî $${b.price}</option>`).join('');
  $('#bundles').innerHTML=CFG.store.bundles.map(b=>`
    <div class="shop-card">
      <div class="shop-title"><h4>${b.title}</h4><span class="price">$${b.price}</span></div>
      <div class="note">${b.desc||''}</div>
      <ul style="margin:6px 0 0 18px">
        ${b.id==='alpha'?'<li>ƒêi·ªÉm v√†o/ra g·ª£i √Ω + c·∫£nh b√°o vol b·∫•t th∆∞·ªùng</li><li>Khung M30‚ÄìH4 ‚Ä¢ tr√°nh nhi·ªÖu</li>':''}
        ${b.id==='etfbtc'?'<li>D√≤ng v·ªën ETF ‚Ä¢ miner ‚Ä¢ CEX/DEX</li><li>K·ªãch b·∫£n k·ª≥ v·ªçng theo v√πng</li>':''}
        ${b.id==='alts'?'<li>Ch·ªçn c·∫∑p d·∫´n d·∫Øt ‚Ä¢ rotation radar</li><li>Quy t·∫Øc r·ªßi ro t·ª´ng nh·ªãp</li>':''}
      </ul>
      <div class="row" style="margin-top:8px">
        <a class="btn" href="#supergate">${LANG==='vi'?'M·ªü kho√° t·∫°i ƒë√¢y':'Unlock here'}</a>
      </div>
    </div>`).join('');
}
function paintPremium(){
  const L=I[LANG];
  $('#premium').innerHTML=(CFG.store.premium||[]).map(p=>`<div class="shop-card"><h4>${p.title}</h4>
    <div class="note">${p.desc||''}</div>
    ${p.bullets?`<ul style="margin:6px 0 0 18px">${p.bullets.map(x=>`<li>${x}</li>`).join('')}</ul>`:""}
    <button class="btn out" onclick="openDataModal()">${L.open_data} ‚Üó</button>
  </div>`).join('');
}
paintBundles(); paintPremium();

/* ===== Edu (n√¢ng n·ªôi dung & b·ªè 'mua & nh·∫≠p m√£') ===== */
function paintEdu(){
  const L=I[LANG];
  $('#ebooks').innerHTML=CFG.store.edu.map(e=>`<div class="shop-card">
    <div class="shop-title"><h4>${e.title}</h4>${e.price?`<span class="price">$${e.price}</span>`:`<span class="badge">${e.tag||''}</span>`}</div>
    <div class="note">${e.desc}</div>
    <ul style="margin:6px 0 0 18px">
      ${e.title==='Crypto 101'?'<li>N·∫Øm ch·∫Øc b·∫£o m·∫≠t, qu·∫£n tr·ªã v·ªën, chu k·ª≥</li><li>Checklist kh·ªüi ƒë·ªông nhanh</li>':''}
      ${e.title==='DeFi Mastery'?'<li>Flow th·ª±c chi·∫øn: AMM ‚Ä¢ Lending ‚Ä¢ Perp</li><li>Case study th·∫Øng/thua minh b·∫°ch</li>':''}
      ${e.title==='Risk & Psychology'?'<li>H·ªá th·ªëng k·ª∑ lu·∫≠t, R:R, nh·∫≠t k√Ω</li><li>Quy t·∫Øc ch·ªëng FOMO & revenge</li>':''}
    </ul>
    <div class="row" style="margin-top:8px"><a class="btn out" href="#top3">${LANG==='vi'?'Xem ngay':'Explore now'}</a></div>
  </div>`).join('');
}
paintEdu();

/* ===== Paywall ===== */
const SECRET=String(CFG.secrets.unlock_code||'23061988');
function gate(open){
  $('#opened').classList.toggle('hidden',!open);
  if(open){ $('#top3Mask').classList.add('hidden'); $('#top3Real').classList.remove('hidden'); }
  else { $('#top3Mask').classList.remove('hidden'); $('#top3Real').classList.add('hidden'); }
}
(function bindPaywall(){
  const saved=localStorage.getItem('unlocked_code')||'';
  if(saved===SECRET){gate(true); paintPremium(); const th=localStorage.getItem('tx_hash'); if(th) $('#uMsg').innerHTML='<span class="ok">TX: '+th+'</span>';}
  $('#doUnlock').onclick=()=>{const code=$('#unlockCode').value.trim(),tx=$('#txhash').value.trim();
    if(code===SECRET){gate(true); paintPremium(); $('#uMsg').innerHTML=`<span class="ok">${I[LANG].unlocked}</span>`; if(tx) localStorage.setItem('tx_hash',tx); localStorage.setItem('unlocked_code',code);}
    else $('#uMsg').innerHTML=`<span class="bad">${I[LANG].wrong}</span>`;};
  $('#remember').onclick=()=>{const c=$('#unlockCode').value.trim(); if(c){localStorage.setItem('unlocked_code',c); $('#uMsg').textContent=I[LANG].saved;}};
  $('#relock').onclick=()=>{localStorage.removeItem('unlocked_code'); gate(false);};
})();

/* ===== AI Chat ===== */
function addBubble(txt, who='ai'){
  const b=document.createElement('div'); b.className='bubble '+(who==='me'?'me':'ai'); b.innerHTML=txt; $('#chatBody').appendChild(b); $('#chatBody').scrollTop=1e6;
}
function aiHint(sym){
  addBubble(`G·ª£i √Ω nhanh cho <b>${sym}</b>: ∆∞u ti√™n v√πng h·ªó tr·ª£ g·∫ßn nh·∫•t, ch·ªù x√°c nh·∫≠n kh·ªëi l∆∞·ª£ng, RR‚â•1:2. Mu·ªën xem l·ªô tr√¨nh v√†o/ra an to√†n?`, 'ai');
}
function smartReply(q){
  const s=q.toLowerCase();
  if(/m·ªü kh√≥a|unlock|thanh to√°n|premium/.test(s))
    return 'B1: Ch·ªçn ph∆∞∆°ng th·ª©c & qu√©t/copy ‚Ä¢ B2: Nh·∫≠n m√£ ‚Ä¢ B3: Nh·∫≠p t·∫°i SuperGate ƒë·ªÉ m·ªü Top 3 & kho ki·∫øn th·ª©c.';
  if(/token|ti·ªÅm nƒÉng|coin/.test(s)){
    const top=(LAST_ITEMS||[]).slice(0,5).map(x=>`${x.symbol} $${fmt(x.price)} (${(x.ch24h||0).toFixed(1)}%)`).join(' ‚Ä¢ ');
    return `Theo bi·∫øn ƒë·ªông & kh·ªëi l∆∞·ª£ng hi·ªán t·∫°i: ${top}. M·ªü Top 3 ƒë·ªÉ xem chi·∫øn l∆∞·ª£c c·ª• th·ªÉ?`;
  }
  if(/an to√†n|risk|stop|k·∫ø ho·∫°ch|dca/.test(s))
    return 'K·∫ø ho·∫°ch an to√†n: r·ªßi ro 1‚Äì2%/l·ªánh ‚Ä¢ DCA 2‚Äì3 nh·ªãp ‚Ä¢ Stop-loss c·ª©ng ‚Ä¢ Kh√¥ng all-in ‚Ä¢ RR‚â•1:2 ‚Ä¢ Nh·∫≠t k√Ω giao d·ªãch.';
  if(/algosone|algo/.test(s))
    return 'AlgosOne: t√≠n hi·ªáu t·ª´ m√°y h·ªçc, c·∫£nh b√°o realtime, backtest nhanh. K√≠ch ho·∫°t: <a target="_blank" rel="noopener" href="https://algosone.page.link/MbtR">link ‚Üó</a>';
  if(/binance|bnb/.test(s))
    return 'Binance: thanh kho·∫£n s√¢u, s·∫£n ph·∫©m ƒëa d·∫°ng. M·ªü t√†i kho·∫£n: <a target="_blank" rel="noopener" href="https://www.binance.com/vi/register?ref=GRO_20338_9V44N">link ‚Üó</a>';
  if(/share|chia s·∫ª|ref/.test(s)){
    const myRef=localStorage.getItem('my_ref')||location.href; return `Li√™n k·∫øt gi·ªõi thi·ªáu c·ªßa b·∫°n:<br><span class="mono">${myRef}</span>`;
  }
  return 'M√¨nh s·∫µn s√†ng: h·ªèi token, g√≥i h·ªçc, m·ªü kho√°, an to√†n giao d·ªãch ho·∫∑c g√µ ‚Äúshare‚Äù ƒë·ªÉ l·∫•y link gi·ªõi thi·ªáu.';
}
(function chatInit(){
  const chips=['T√≥m t·∫Øt th·ªã tr∆∞·ªùng','Token ti·ªÅm nƒÉng h√¥m nay','K·∫ø ho·∫°ch l·ªánh an to√†n','C√°ch m·ªü kho√°','L·∫•y link chia s·∫ª'];
  const bar=$('#chipBar'); chips.forEach(t=>{const b=document.createElement('button'); b.className='btn out'; b.textContent=t; b.onclick=()=>{$('#chatIn').value=t; $('#chatSend').click();}; bar.appendChild(b);});
  $('#openChat').onclick=()=>{$('#chat').style.display='flex'; if(!$('#chatBody').dataset.hi){addBubble('Ch√†o b·∫°n! M√¨nh l√† AI t√†i ch√≠nh 24/7. Top 3 Premium ·ªü tr√™n c√πng; Token ch·ªçn l·ªçc ngay d∆∞·ªõi.', 'ai'); $('#chatBody').dataset.hi=1;}};
  $('#closeChat').onclick=()=>{$('#chat').style.display='none'};
  $('#chatSend').onclick=()=>{const v=$('#chatIn').value.trim(); if(!v) return; addBubble(v,'me'); $('#chatIn').value=''; addBubble(smartReply(v),'ai');};
})();

/* ===== Modal data (close to√†n di·ªán) ===== */
const PREMIUM_DATA={
  updated_at:new Date().toISOString(),
  alpha_feed:[
    {type:"flow", text:"D√≤ng ti·ªÅn BTC v√†o CEX tƒÉng d·∫ßn ‚Äî theo d√µi breakout v√πng kh√°ng c·ª± g·∫ßn."},
    {type:"onchain", text:"V√≠ c√° voi gom alt mid-cap h·ªá ETH, kh·ªëi l∆∞·ª£ng gia tƒÉng theo gi·ªù."},
    {type:"macro", text:"ETF spot ghi nh·∫≠n inflow tu·∫ßn th·ª© 3 li√™n ti·∫øp."}
  ],
  deals:[{name:"Seed/Private-DeFiX", note:"Allocation nh·ªè, vesting 12m ‚Äì c√¢n ƒë·ªëi r·ªßi ro."}]
};
function openDataModal(){ $('#dataPre').textContent=JSON.stringify(PREMIUM_DATA,null,2); $('#dataModal').style.display='flex'; }
$('#openData').onclick=openDataModal;
$('#closeData').onclick=()=>$('#dataModal').style.display='none';
$('#dataModal').addEventListener('click',e=>{ if(e.target.id==='dataModal'){ $('#dataModal').style.display='none'; } });

/* ===== Live counters ===== */
(function peers(){
  const k='umv_infty_peers'; const now=Date.now(), ttl=25e3; const id=localStorage.getItem('peer_id')||Math.random().toString(36).slice(2); localStorage.setItem('peer_id',id);
  const raw=localStorage.getItem(k); let list=raw?JSON.parse(raw):[]; list=list.filter(x=>now-x.t<ttl); const me=list.find(x=>x.id===id); if(me) me.t=now; else list.push({id,t:now});
  localStorage.setItem(k,JSON.stringify(list)); $('#kLive').textContent=list.length; setTimeout(peers,4000);
})();

/* ===== Loops ===== */
$('#refreshNow').onclick=()=>fetchLive();
async function boot(){ applyLang(); await fetchLive(); setInterval(fetchLive, 60*1000); }
boot();
</script>
</body>
</html>
